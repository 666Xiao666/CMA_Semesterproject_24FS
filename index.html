<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Xiao Cui">

<title>Trip detection from daily GPS data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="index_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="index_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="index_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="index_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">

<script src="index_files/libs/leaflet-1.3.1/leaflet.js"></script>

<link href="index_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">

<script src="index_files/libs/proj4-2.6.2/proj4.min.js"></script>

<script src="index_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>

<link href="index_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">

<script src="index_files/libs/leaflet-binding-2.2.2/leaflet.js"></script>

<script src="index_files/libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>

<script src="index_files/libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>

<link href="index_files/libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">

<script src="index_files/libs/HomeButton-0.0.1/home-button.js"></script>

<script src="index_files/libs/HomeButton-0.0.1/easy-button-src.min.js"></script>

<script src="index_files/libs/clipboard-0.0.1/setClipboardText.js"></script>

<link href="index_files/libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">

<link href="index_files/libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">



</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Trip detection from daily GPS data</h1>
<p class="subtitle lead">a review and framework of generating walking trajectories</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Xiao Cui </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>load packages, import data</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check packages: ------------------------------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Default repository</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({r <span class="ot">&lt;-</span> <span class="fu">getOption</span>(<span class="st">"repos"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>r[<span class="st">"CRAN"</span>] <span class="ot">&lt;-</span> <span class="st">"http://cran.r-project.org"</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repos=</span>r)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>check_pkg <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(x, <span class="at">character.only =</span> <span class="cn">TRUE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(x, <span class="at">dep =</span> <span class="cn">TRUE</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(x, <span class="at">character.only =</span> <span class="cn">TRUE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) <span class="fu">stop</span>(<span class="st">"Package not found"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"geosphere"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"sf"</span>) <span class="co"># </span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"purrr"</span>) <span class="co"># package for precise calculation</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"readr"</span>) <span class="co"># a better way to read data than basic R</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"rnaturalearth"</span>) <span class="co"># package for requiring DEM data</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"raster"</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"elevatr"</span>) <span class="co"># package for handling DEM</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"terra"</span>) <span class="co"># package for raster data handling</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"skimr"</span>) <span class="co"># a better package to summarize data</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"ggplot2"</span>) <span class="co"># package for plots</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"smplot2"</span>) <span class="co"># package for more functions based on ggplot</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"mapview"</span>) <span class="co"># package for interactive maps</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"randomForest"</span>) <span class="co"># package for random forest</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"caret"</span>) <span class="co"># package for random forest</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"e1071"</span>) <span class="co"># package for random forest</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># import data ------------------------------------------------------------------------------</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>posmo_df <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"posmo_2024-03-23_2024-06-15.csv"</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">user_id =</span> <span class="fu">col_character</span>(),</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">datetime =</span> <span class="fu">col_datetime</span>(),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weekday =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Sun"</span>, <span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>)), <span class="co"># read daytime as a factor</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                   <span class="at">place_name =</span> <span class="fu">col_character</span>(),</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transport_mode =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Walk"</span>, <span class="st">"Tram"</span>, <span class="st">"Bus"</span>, <span class="st">"Bike"</span>, <span class="st">"Train"</span>, <span class="st">"Car"</span>)),</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lon_x =</span> <span class="fu">col_double</span>(),</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lat_y =</span> <span class="fu">col_double</span>()</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                 ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="abstract" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="abstract"><span class="header-section-number">1</span> Abstract</h2>
<p>Daily GPS trajectories have a huge potential in understanding people’s daily mobility patterns. However, there is still uncertainty in how to detect travel modes from abundant GPS point data accurately. We review and summarize recent studies about GPS data reprocessing, combining geographic context with trajectories, and travel mode detection. Then we detect walking travel mode from daily GPS data generated by POSMO application under this framework. We focus on walking trip identification and rebuild two rule-based algorithms for raw point data and utilize random forest with labeled GPS coordinates. Result shows random forest has the best performance among three detection methods with the accuracy of 93.8%. However, rule-based algorithms are more understandable and doable with around 85% accuracy with the optimal parameters. Speed is the primary factor for identifying walking travel mode compared with other parameters, but acceleration can enhance the precision in the model. Our study provides a framework of identifying walking trajectories and supplementing them by combining other geospatial contexts and map matching.</p>
</section>
<section id="introduction" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2</span> Introduction</h2>
<p>With the advancement of technologies such as mobile devices and Internet, Global Positioning System (GPS) trajectory data generated by users, vehicles, and other mobile objects has experienced explosive growth. Massive trajectory data can depict the spatiotemporal movement patterns, which have enormous value in travel strategy <span class="citation" data-cites="jiaqi2018transport">Jiaqi (<a href="#ref-jiaqi2018transport" role="doc-biblioref">2018</a>)</span>, environmental planning, and policy making <span class="citation" data-cites="yun2018spatiotemporal">Yun, Kang, and Lee (<a href="#ref-yun2018spatiotemporal" role="doc-biblioref">2018</a>)</span>. extract travel information, and thus analyze travel purposes, preferences in travel modes, and travel distribution <span class="citation" data-cites="montini2014trip">Montini et al. (<a href="#ref-montini2014trip" role="doc-biblioref">2014</a>)</span>. However, it is still challenging to detect travel modes from daily GPS data. Daily GPS data contains mixed travel modes <span class="citation" data-cites="s18113741">Yang et al. (<a href="#ref-s18113741" role="doc-biblioref">2018</a>)</span>. <span class="citation" data-cites="HUANG2019297">Huang, Cheng, and Weibel (<a href="#ref-HUANG2019297" role="doc-biblioref">2019</a>)</span> summarize how to from complex by mobile data. Walking is not only a common travel mode in daily life, but also a low-cost physical activity which can contribute to . <span class="citation" data-cites="cho2011identifying">Cho, Rodriguez, and Evenson (<a href="#ref-cho2011identifying" role="doc-biblioref">2011</a>)</span> define. <span class="citation" data-cites="yun2018spatiotemporal">Yun, Kang, and Lee (<a href="#ref-yun2018spatiotemporal" role="doc-biblioref">2018</a>)</span> use kernel density to generate walking trajectories. Travel mode detection. <span class="citation" data-cites="XIAO201514">Xiao, Juan, and Zhang (<a href="#ref-XIAO201514" role="doc-biblioref">2015</a>)</span> identify travel modes by Bayesian network from smartphone-based travel surveys. <span class="citation" data-cites="s18113741">Yang et al. (<a href="#ref-s18113741" role="doc-biblioref">2018</a>)</span> review how to detect travel modes from with complex travel modes. Later efforts incorporated machine learning (ML) to derive classification “rules” directly from input features, enhancing decision-making flexibility and robustness against real-world noise. Examples of ML-based techniques include decision trees, random forests (RF), support vector machines, and artificial neural networks. Among these, RF has gained significant popularity due to its capability to manage high feature dimensionality and multicollinearity effectively. Studies comparing various mode detection methods consistently show that RF outperforms other classical ML algorithms in terms of performance <span class="citation" data-cites="hong_evaluating_2023">Hong, Stüdeli, and Raubal (<a href="#ref-hong_evaluating_2023" role="doc-biblioref">2023</a>)</span>. <span class="citation" data-cites="SADEGHIAN2022159">Sadeghian et al. (<a href="#ref-SADEGHIAN2022159" role="doc-biblioref">2022</a>)</span> mentioned random forest performs best among supervised machine learning. Walking is a low cost and low carbon physical activities, which can benefit carbon emission. We define walking as ““. In our study, we tend to answer following research questions: Q1: How can we rebuild (heuristic) rule-based walking detection methods under point-based segmentation in R? Q2: How do we evaluate the performance of walking detection methods? Q3: How do we match GPS points to a complex road network by topological method? Q4: Does supervised classification (random forest) perform better than rule-based (heuristic) method in walking detection? Q5: How to combine other semantic contexts on trajectories?</p>
</section>
<section id="material-and-methods" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="material-and-methods"><span class="header-section-number">3</span> Material and Methods</h2>
<section id="data" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="data"><span class="header-section-number">3.1</span> Data</h3>
<section id="data-collection" class="level4" data-number="3.1.1">
<h4 data-number="3.1.1" class="anchored" data-anchor-id="data-collection"><span class="header-section-number">3.1.1</span> Data collection</h4>
<p>The smartphone for data collection is iPhone Xs Max with iOS Version 17.5.1. We refer to the documents about data protection under <a href="https://posmo.coop/about-us/datenschutzerklaerung">POSMO application</a>. GPS coordinates here are collected via anonymized IP addresses by removing the last 2 bytes (i.e.&nbsp;198.51.0.0 instead of 198.51.100.54). However, the algorithm here is still ambiguous. We assume POSMO application has similar functions with a GPS logger (i.e., do not record data while stationary). Trip endpoints are typically identified when the dwell time between two consecutive moving data points exceeds a certain threshold. When the GPS loggers resume movement, they require a few seconds to a few minutes to warm start, leading to missing GPS points at the beginning of the trip <span class="citation" data-cites="gong2012gps">Gong et al. (<a href="#ref-gong2012gps" role="doc-biblioref">2012</a>)</span>. From the repetitive points statistics below, we find there are 804 endpoints in our raw data. The repeated count of endpoints is between 2 to 4, i.e., when POSMO application detects a “stop”, it will acquire the place name of current anonymized IP address by geocoding (retrieving place names by coordinates), then store this name in the column <code>place_name</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>a review of stop detection in POSMO</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by datetime and count the number of occurrences</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>repeated_counts <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(datetime) <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the repeated_counts partly</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Stop points detection:"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="st">"Total count of stops:"</span>, <span class="fu">nrow</span>(repeated_counts), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="st">"Possible point count of each stop:"</span>, <span class="fu">unique</span>(repeated_counts<span class="sc">$</span>count), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Stop points detection: 
 Total count of stops: 804 
 Possible point count of each stop: 2 3 4 </code></pre>
</div>
<details class="code-fold">
<summary>a review of stop detection in POSMO</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the temporary dataframe</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(repeated_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The first step is to distinguish trip and activities from GPS points.</p>
<p>Here we find when.</p>
<div class="cell">
<details class="code-fold">
<summary>speed based detection</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function to compute performance metrics for different lag values</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>compute_metrics_for_lag <span class="ot">&lt;-</span> <span class="cf">function</span>(posmo_df, lag_values) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define helper functions</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now) {</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert dataframe to sf object</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  posmo_sf <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="dv">2056</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize results list</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate over each lag value</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (lag_value <span class="cf">in</span> lag_values) {</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    posmo_sf <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">stepMean =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lag</span>(geometry, lag_value))</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">timeMean =</span> <span class="fu">difftime_secs</span>(datetime, <span class="fu">lag</span>(datetime, lag_value))</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">speedMean =</span> stepMean <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span> </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">acc =</span> (<span class="fu">lead</span>(speedMean) <span class="sc">-</span> speedMean) <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk =</span> (speedMean <span class="sc">&lt;=</span> <span class="fl">1.7</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk_s_a =</span> (speedMean <span class="sc">&lt;=</span> <span class="fl">1.7</span>) <span class="sc">&amp;</span> (<span class="fu">abs</span>(acc) <span class="sc">&lt;=</span> <span class="fl">0.009</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation of speed and acceleration based detection</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    walk_tp <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    walk_fp <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    walk_fn <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    walk_tn <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    tp <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tp)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    fp <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fp)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fn)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    tn <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tn)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="ot">&lt;-</span> (tp <span class="sc">+</span> tn) <span class="sc">/</span> (tp <span class="sc">+</span> tn <span class="sc">+</span> fp <span class="sc">+</span> fn)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    precision <span class="ot">&lt;-</span> tp<span class="sc">/</span> (tp <span class="sc">+</span> fp)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    specificity <span class="ot">&lt;-</span> tn <span class="sc">/</span> (tn <span class="sc">+</span> fp)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    sensitivity <span class="ot">&lt;-</span> tp <span class="sc">/</span> (tp <span class="sc">+</span> fn)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    recall <span class="ot">&lt;-</span> tp <span class="sc">/</span> (tp <span class="sc">+</span> fn)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    balance_accuracy <span class="ot">&lt;-</span> (specificity <span class="sc">+</span> sensitivity) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    f1 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results for the current lag value</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    results[[<span class="fu">as.character</span>(lag_value)]] <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy =</span> accuracy,</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">precision =</span> precision,</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">specificity =</span> specificity,</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">sensitivity =</span> sensitivity,</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">recall =</span> recall,</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">balance_accuracy =</span> balance_accuracy,</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">f1_score =</span> f1</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert results list to data frame</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>  results_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results)</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_df)</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Values here represent minutes</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>lag_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics for the given lag values</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="ot">&lt;-</span> <span class="fu">compute_metrics_for_lag</span>(posmo_df, lag_values)</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   accuracy precision specificity sensitivity    recall balance_accuracy
1 0.7564043 0.6725058   0.7414480   0.7783298 0.7783298        0.7598889
2 0.7815826 0.6931160   0.7499542   0.8279519 0.8279519        0.7889531
3 0.8018619 0.7104958   0.7601758   0.8629834 0.8629834        0.8115796
4 0.8169098 0.7242383   0.7700197   0.8856663 0.8856663        0.8278430
5 0.8286103 0.7350979   0.7782153   0.9025111 0.9025111        0.8403632
   f1_score
1 0.7215584
2 0.7545577
3 0.7793507
4 0.7968590
5 0.8102471</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>speed-acceleration based detection</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function to compute performance metrics for different lag values</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>compute_metrics_for_lag <span class="ot">&lt;-</span> <span class="cf">function</span>(posmo_df, lag_values) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define helper functions</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now) {</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert dataframe to sf object</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  posmo_sf <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="dv">2056</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize results list</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate over each lag value</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (lag_value <span class="cf">in</span> lag_values) {</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    posmo_sf <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">stepMean =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lag</span>(geometry, lag_value))</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">timeMean =</span> <span class="fu">difftime_secs</span>(datetime, <span class="fu">lag</span>(datetime, lag_value))</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">speedMean =</span> stepMean <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span> </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">acc =</span> (<span class="fu">lead</span>(speedMean) <span class="sc">-</span> speedMean) <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk =</span> (speedMean <span class="sc">&lt;=</span> <span class="fl">1.7</span>)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk_s_a =</span> (speedMean <span class="sc">&lt;=</span> <span class="fl">1.7</span>) <span class="sc">&amp;</span> (<span class="fu">abs</span>(acc) <span class="sc">&lt;=</span> <span class="fl">0.009</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation of speed and acceleration based detection</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    walk_tp_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    walk_fp_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    walk_fn_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    walk_tn_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    tp_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tp_s_a)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    fp_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fp_s_a)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    fn_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fn_s_a)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    tn_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tn_s_a)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    accuracy_s_a <span class="ot">&lt;-</span> (tp_s_a <span class="sc">+</span> tn_s_a) <span class="sc">/</span> (tp_s_a <span class="sc">+</span> tn_s_a <span class="sc">+</span> fp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    precision_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fp_s_a)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    specificity_s_a <span class="ot">&lt;-</span> tn_s_a <span class="sc">/</span> (tn_s_a <span class="sc">+</span> fp_s_a)</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    sensitivity_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    recall_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    balance_accuracy_s_a <span class="ot">&lt;-</span> (specificity_s_a <span class="sc">+</span> sensitivity_s_a) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    f1_s_a <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (precision_s_a <span class="sc">*</span> recall_s_a) <span class="sc">/</span> (precision_s_a <span class="sc">+</span> recall_s_a)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results for the current lag value</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    results[[<span class="fu">as.character</span>(lag_value)]] <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy =</span> accuracy_s_a,</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">precision =</span> precision_s_a,</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">specificity =</span> specificity_s_a,</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">sensitivity =</span> sensitivity_s_a,</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">recall =</span> recall_s_a,</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">balance_accuracy =</span> balance_accuracy_s_a,</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">f1_score =</span> f1_s_a</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert results list to data frame</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>  results_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results)</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_df)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>lag_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics for the given lag values</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="ot">&lt;-</span> <span class="fu">compute_metrics_for_lag</span>(posmo_df, lag_values)</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   accuracy precision specificity sensitivity    recall balance_accuracy
1 0.6268344 0.7198372   0.9653309   0.1305895 0.1305895        0.5479602
2 0.6884612 0.7511641   0.9217033   0.3465127 0.3465127        0.6341080
3 0.7520211 0.7721543   0.8891076   0.5510204 0.5510204        0.7200640
4 0.7985355 0.7801286   0.8653450   0.7005707 0.7005707        0.7829578
5 0.8244726 0.7793359   0.8472597   0.7910568 0.7910568        0.8191583
   f1_score
1 0.2210730
2 0.4742524
3 0.6431090
4 0.7382123
5 0.7851526</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>define the function to compute performance metrics for different speedMean and abs(acc) threshold values</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>compute_metrics_for_thresholds <span class="ot">&lt;-</span> <span class="cf">function</span>(posmo_df, thresholds) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define helper functions</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now) {</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert dataframe to sf object</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  posmo_sf <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="dv">2056</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize results list</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate over each pair of thresholds</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (threshold <span class="cf">in</span> thresholds) {</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    speed_threshold <span class="ot">&lt;-</span> threshold[<span class="dv">1</span>]</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    acc_threshold <span class="ot">&lt;-</span> threshold[<span class="dv">2</span>]</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    posmo_sf <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">stepMean =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lag</span>(geometry, <span class="dv">6</span>))  <span class="co"># Keeping lag value fixed as 6</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">timeMean =</span> <span class="fu">difftime_secs</span>(datetime, <span class="fu">lag</span>(datetime, <span class="dv">6</span>))</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">speedMean =</span> stepMean <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span> </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">acc =</span> (<span class="fu">lead</span>(speedMean) <span class="sc">-</span> speedMean) <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk =</span> (speedMean <span class="sc">&lt;=</span> speed_threshold)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk_s_a =</span> (speedMean <span class="sc">&lt;=</span> speed_threshold) <span class="sc">&amp;</span> (<span class="fu">abs</span>(acc) <span class="sc">&lt;=</span> acc_threshold)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation of speed and acceleration based detection</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    walk_tp_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    walk_fp_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    walk_fn_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    walk_tn_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    tp_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tp_s_a)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    fp_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fp_s_a)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    fn_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fn_s_a)</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    tn_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tn_s_a)</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    accuracy_s_a <span class="ot">&lt;-</span> (tp_s_a <span class="sc">+</span> tn_s_a) <span class="sc">/</span> (tp_s_a <span class="sc">+</span> tn_s_a <span class="sc">+</span> fp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    precision_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fp_s_a)</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    specificity_s_a <span class="ot">&lt;-</span> tn_s_a <span class="sc">/</span> (tn_s_a <span class="sc">+</span> fp_s_a)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    sensitivity_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    recall_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    balance_accuracy_s_a <span class="ot">&lt;-</span> (specificity_s_a <span class="sc">+</span> sensitivity_s_a) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    f1_s_a <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (precision_s_a <span class="sc">*</span> recall_s_a) <span class="sc">/</span> (precision_s_a <span class="sc">+</span> recall_s_a)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a row name based on the current thresholds</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    row_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"speed="</span>, speed_threshold, <span class="st">",acc="</span>, acc_threshold)</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results for the current pair of thresholds</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    results[[row_name]] <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy =</span> accuracy_s_a,</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">precision =</span> precision_s_a,</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">specificity =</span> specificity_s_a,</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">sensitivity =</span> sensitivity_s_a,</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">recall =</span> recall_s_a,</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">balance_accuracy =</span> balance_accuracy_s_a,</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">f1_score =</span> f1_s_a</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert results list to data frame</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>  results_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results)</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_df)</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>thresholds <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">0.001</span>),</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.7</span>, <span class="fl">0.001</span>),</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.9</span>, <span class="fl">0.001</span>),</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">0.002</span>),</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.7</span>, <span class="fl">0.002</span>),</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.9</span>, <span class="fl">0.002</span>)</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics for the given thresholds</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="ot">&lt;-</span> <span class="fu">compute_metrics_for_thresholds</span>(posmo_df, thresholds)</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     accuracy precision specificity sensitivity    recall
speed=1.5,acc=0.001 0.6872652 0.7808016   0.9391511   0.3178675 0.3178675
speed=1.7,acc=0.001 0.6908314 0.7796583   0.9362209   0.3309609 0.3309609
speed=1.9,acc=0.001 0.6911853 0.7775692   0.9348931   0.3337810 0.3337810
speed=1.5,acc=0.002 0.7386345 0.7886126   0.9112678   0.4854630 0.4854630
speed=1.7,acc=0.002 0.7457124 0.7879668   0.9064145   0.5100383 0.5100383
speed=1.9,acc=0.002 0.7462024 0.7848813   0.9037132   0.5152085 0.5152085
                    balance_accuracy  f1_score
speed=1.5,acc=0.001        0.6285093 0.4518038
speed=1.7,acc=0.001        0.6335909 0.4646712
speed=1.9,acc=0.001        0.6343370 0.4670676
speed=1.5,acc=0.002        0.6983654 0.6009725
speed=1.7,acc=0.002        0.7082264 0.6192475
speed=1.9,acc=0.002        0.7094608 0.6220763</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>generate raw walking trajectories</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert coordinates to LV95 (Swiss coordinate system)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(posmo_df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>coordinates_lv95 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(coordinates, <span class="dv">2056</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>posmo_df<span class="sc">$</span>lv95_x <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">1</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>posmo_df<span class="sc">$</span>lv95_y <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">2</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign transport_mode_id based on transport_mode</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>posmo_df <span class="ot">&lt;-</span> posmo_df <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">transport_mode_id =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(transport_mode), <span class="dv">0</span>, <span class="cn">NA_integer_</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the id counter</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>current_id <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the rows to assign ids</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(posmo_df))) {</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(posmo_df<span class="sc">$</span>transport_mode[i])) {</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">||</span> <span class="fu">is.na</span>(posmo_df<span class="sc">$</span>transport_mode[i<span class="dv">-1</span>]) <span class="sc">||</span> posmo_df<span class="sc">$</span>transport_mode[i] <span class="sc">!=</span> posmo_df<span class="sc">$</span>transport_mode[i<span class="dv">-1</span>]) {</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>      posmo_df<span class="sc">$</span>transport_mode_id[i] <span class="ot">&lt;-</span> current_id</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>      current_id <span class="ot">&lt;-</span> current_id <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>      posmo_df<span class="sc">$</span>transport_mode_id[i] <span class="ot">&lt;-</span> posmo_df<span class="sc">$</span>transport_mode_id[i<span class="dv">-1</span>]</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>walk <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>walk_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(walk,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lv95_x"</span>, <span class="st">"lv95_y"</span>),</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">2056</span>, <span class="at">remove =</span> <span class="cn">FALSE</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create LINESTRING by grouping by transport_mode_id</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>walk_line <span class="ot">&lt;-</span> walk_sf <span class="sc">%&gt;%</span> </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span> </span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">st_length</span>(geometry))</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Group points by transport_mode_id and calculate the time duration for each group</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>time_durations <span class="ot">&lt;-</span> walk_sf <span class="sc">%&gt;%</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_time =</span> <span class="fu">min</span>(datetime),</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_time =</span> <span class="fu">max</span>(datetime),</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_duration =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">max</span>(datetime), <span class="fu">min</span>(datetime)), <span class="at">units =</span> <span class="st">"secs"</span>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">st_drop_geometry</span>()</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Create LINESTRING by grouping by transport_mode_id</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>walk_line <span class="ot">&lt;-</span> walk_sf <span class="sc">%&gt;%</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">st_length</span>(geometry))</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the time durations back to walk_line</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>walk_line <span class="ot">&lt;-</span> walk_line <span class="sc">%&gt;%</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(time_durations <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(transport_mode_id, time_duration), <span class="at">by =</span> <span class="st">"transport_mode_id"</span>)</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean speed</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>walk_line <span class="ot">&lt;-</span> walk_line <span class="sc">%&gt;%</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speed_m_s =</span> <span class="fu">as.numeric</span>(length <span class="sc">/</span> time_duration))<span class="sc">|&gt;</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>()</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(walk_line, <span class="fu">aes</span>(<span class="at">y =</span> speed_m_s))<span class="sc">+</span> </span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outliers =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/raw%20segment-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>generate raw walking trajectories</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the number of lines to sample</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>number_of_lines_to_sample <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Change this to the desired number of samples</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample the walk_line data</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>sampled_walk_line <span class="ot">&lt;-</span> walk_line <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(number_of_lines_to_sample)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(sampled_walk_line, <span class="at">zcol =</span> <span class="st">"transport_mode_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-f0f84980fffad9a53c33" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f0f84980fffad9a53c33">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["line",430]},{"method":"addPolylines","args":[[[[{"lng":[8.517405008373608,8.51727600837348,8.517170008373375,8.517014008373225,8.516878008373086,8.516779008372986,8.516695008372897,8.516638008372825,8.516664008372825,8.516687008372832,8.516709008372818,8.516692008372768,8.516623008372679,8.516501008372547,8.516446008372498,8.516391008372441,8.516372008372411,8.516349008372359,8.516347008372328,8.51637400837234,8.516378008372325,8.516385008372305,8.516411008372328,8.516440008372344,8.516431008372306,8.516443008372285,8.51646000837227,8.516550008372342,8.516557008372336,8.516520008372288,8.516472008372229,8.51642200837218,8.516452008372177,8.516492008372168,8.5165440083722,8.516603008372229,8.516738008372334,8.51685000837241,8.516932008372461,8.517005008372513,8.517079008372574,8.51715500837264,8.517218008372708,8.517302008372802,8.517369008372892,8.517521008373057,8.517666008373217,8.517730008373276,8.517718008373272,8.517739008373292,8.517749008373274,8.51775700837328,8.51777200837328,8.517891008373452,8.51764200837324,8.517756008373341],"lat":[47.35884401016534,47.35885801016539,47.35884901016541,47.35885101016548,47.35885801016546,47.35888201016556,47.35892101016556,47.35896101016564,47.35903901016565,47.35909301016564,47.35919601016566,47.3593120101657,47.35937101016578,47.3594270101658,47.35941301016583,47.35942301016581,47.35946901016586,47.35955501016587,47.35964101016591,47.35970001016588,47.35975801016596,47.35983201016596,47.35985401016597,47.35988301016598,47.36000101016602,47.36010101016604,47.36018801016607,47.36025101016602,47.36028601016606,47.3603290101661,47.36036201016614,47.36038101016612,47.36047501016617,47.36062901016618,47.36068801016616,47.36078501016621,47.3608750101662,47.3609730101662,47.36106801016619,47.36112301016618,47.36115701016622,47.36119901016619,47.3611710101661,47.3611310101661,47.36105701016607,47.360992010166,47.36093801016595,47.36094401016593,47.36091201016589,47.36093301016592,47.36101201016594,47.36102201016593,47.36107301016597,47.36088601016588,47.36078101016592,47.36081101016588]}]]],null,"sampled_walk_line - transport_mode_id",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"line","stroke":true,"color":"#6666FF","weight":2,"opacity":0.9,"fill":false,"fillColor":"#6666FF","fillOpacity":1,"smoothFactor":1,"noClip":false},"<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>transport_mode_id&emsp;<\/th><td>219&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>length&emsp;<\/th><td>486.2493 [m]&emsp;<\/td><\/tr><tr><td>4<\/td><th>time_duration&emsp;<\/th><td>345&emsp;<\/td><\/tr><tr><td>5<\/td><th>speed_m_s&emsp;<\/th><td>1.409418&emsp;<\/td><\/tr><\/table><\/div>",{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"219",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":3,"opacity":1,"fill":false,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[8.516347008372328,47.35884401016534,8.517891008373452,47.36119901016619,true,"sampled_walk_line - transport_mode_id","Zoom to sampled_walk_line - transport_mode_id","<strong> sampled_walk_line - transport_mode_id <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"sampled_walk_line - transport_mode_id",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["219"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"sampled_walk_line - transport_mode_id"}]}],"limits":{"lat":[47.35884401016534,47.36119901016619],"lng":[8.516347008372328,8.517891008373452]},"fitBounds":[47.35884401016534,8.516347008372328,47.36119901016619,8.517891008373452,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<p>After detecting such activity episodes, the application will mark the pseudo-anonymized location as a stop <span class="citation" data-cites="s18113741">Yang et al. (<a href="#ref-s18113741" role="doc-biblioref">2018</a>)</span>. The smartphone for data collection is iPhone Xs Max with iOS Version 17.5.1.</p>
</section>
<section id="data-attributes" class="level4" data-number="3.1.2">
<h4 data-number="3.1.2" class="anchored" data-anchor-id="data-attributes"><span class="header-section-number">3.1.2</span> Data attributes</h4>
<p>We used daily GPS data collected by POSMO application with the following attributes:</p>
<table class="table-striped table-hover caption-top table">
<caption>Table 1: attributes in POSMO GPS data</caption>
<thead>
<tr class="header">
<th>Variable</th>
<th>Label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>user_id</td>
<td>the user id of POSMO account</td>
</tr>
<tr class="even">
<td>datetime</td>
<td>timestamp of a GPS point</td>
</tr>
<tr class="odd">
<td>weekday</td>
<td>weekday of timestamp (from Sunday to Saturday)</td>
</tr>
<tr class="even">
<td>place_name</td>
<td>the place name where the user is detected as “stop”</td>
</tr>
<tr class="odd">
<td><strong>transport_mode</strong></td>
<td>travel mode detected by POSMO application</td>
</tr>
<tr class="even">
<td>lon_x</td>
<td>longitude of GPS point</td>
</tr>
<tr class="odd">
<td>lat_x</td>
<td>latitude of GPS point</td>
</tr>
</tbody>
</table>
<div class="cell">
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># have a breif view of our data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Check structure of dataset</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(posmo_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">posmo_df</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">37174</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">POSIXct</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">user_id</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">place_name</td>
<td style="text-align: right;">36739</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">weekday</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Fri: 13075, Tue: 5754, Thu: 4947, Mon: 4614</td>
</tr>
<tr class="even">
<td style="text-align: left;">transport_mode</td>
<td style="text-align: right;">435</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Wal: 14898, Tra: 9781, Tra: 7165, Bus: 2684</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lon_x</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.55</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">8.50</td>
<td style="text-align: right;">8.52</td>
<td style="text-align: right;">8.54</td>
<td style="text-align: right;">8.55</td>
<td style="text-align: right;">8.69</td>
<td style="text-align: left;">▇▆▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">lat_y</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">47.36</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">47.22</td>
<td style="text-align: right;">47.36</td>
<td style="text-align: right;">47.37</td>
<td style="text-align: right;">47.38</td>
<td style="text-align: right;">47.41</td>
<td style="text-align: left;">▁▁▁▆▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lv95_x</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2683645.15</td>
<td style="text-align: right;">2785.72</td>
<td style="text-align: right;">2680484.10</td>
<td style="text-align: right;">2681762.50</td>
<td style="text-align: right;">2683220.97</td>
<td style="text-align: right;">2683821.76</td>
<td style="text-align: right;">2694409.11</td>
<td style="text-align: left;">▇▆▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">lv95_y</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1245826.19</td>
<td style="text-align: right;">4774.74</td>
<td style="text-align: right;">1230328.41</td>
<td style="text-align: right;">1246054.07</td>
<td style="text-align: right;">1247014.06</td>
<td style="text-align: right;">1248161.29</td>
<td style="text-align: right;">1251483.66</td>
<td style="text-align: left;">▁▁▁▆▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">transport_mode_id</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">240.72</td>
<td style="text-align: right;">121.70</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">144.00</td>
<td style="text-align: right;">254.00</td>
<td style="text-align: right;">343.00</td>
<td style="text-align: right;">435.00</td>
<td style="text-align: left;">▅▅▇▇▇</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: POSIXct</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">min</th>
<th style="text-align: left;">max</th>
<th style="text-align: left;">median</th>
<th style="text-align: right;">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">datetime</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2024-03-23 10:35:10</td>
<td style="text-align: left;">2024-06-15 13:00:40</td>
<td style="text-align: left;">2024-04-29 21:19:28</td>
<td style="text-align: right;">36071</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(posmo_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  user_id      datetime            weekday place_name transport_mode lon_x lat_y
  &lt;chr&gt;        &lt;dttm&gt;              &lt;fct&gt;   &lt;chr&gt;      &lt;fct&gt;          &lt;dbl&gt; &lt;dbl&gt;
1 0f84c8f2-20… 2024-03-23 10:35:10 Sat     Careum Bi… &lt;NA&gt;            8.55  47.4
2 0f84c8f2-20… 2024-03-23 11:55:38 Sat     &lt;NA&gt;       Walk            8.55  47.4
3 0f84c8f2-20… 2024-03-23 11:55:38 Sat     &lt;NA&gt;       Walk            8.55  47.4
4 0f84c8f2-20… 2024-03-23 11:55:49 Sat     &lt;NA&gt;       Walk            8.55  47.4
5 0f84c8f2-20… 2024-03-23 11:56:00 Sat     &lt;NA&gt;       Walk            8.55  47.4
6 0f84c8f2-20… 2024-03-23 11:56:11 Sat     &lt;NA&gt;       Walk            8.55  47.4
# ℹ 3 more variables: lv95_x &lt;dbl&gt;, lv95_y &lt;dbl&gt;, transport_mode_id &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(posmo_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  user_id      datetime            weekday place_name transport_mode lon_x lat_y
  &lt;chr&gt;        &lt;dttm&gt;              &lt;fct&gt;   &lt;chr&gt;      &lt;fct&gt;          &lt;dbl&gt; &lt;dbl&gt;
1 0f84c8f2-20… 2024-06-15 13:00:18 Sat     &lt;NA&gt;       Walk            8.52  47.4
2 0f84c8f2-20… 2024-06-15 13:00:25 Sat     &lt;NA&gt;       Walk            8.52  47.4
3 0f84c8f2-20… 2024-06-15 13:00:34 Sat     &lt;NA&gt;       Walk            8.52  47.4
4 0f84c8f2-20… 2024-06-15 13:00:40 Sat     &lt;NA&gt;       Walk            8.52  47.4
5 0f84c8f2-20… 2024-06-15 13:00:40 Sat     &lt;NA&gt;       Walk            8.52  47.4
6 0f84c8f2-20… 2024-06-15 13:00:40 Sat     Uetliberg… &lt;NA&gt;            8.52  47.4
# ℹ 3 more variables: lv95_x &lt;dbl&gt;, lv95_y &lt;dbl&gt;, transport_mode_id &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the date from the datetime column</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>posmo_df <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as_date</span>(datetime))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Count of days with records</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(posmo_df<span class="sc">$</span>date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 78</code></pre>
</div>
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># date records from</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(posmo_df<span class="sc">$</span>date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-03-23"</code></pre>
</div>
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># date records from</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(posmo_df<span class="sc">$</span>date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-06-15"</code></pre>
</div>
</div>
<p>GPS data are recorded by 5-10 second intervals and labeled with transform mode. Users can fix this attribute by adjusting transfer mode manually then validate and export data as a csv document. There are 37174 GPS points in the raw data set with 78 days (from 2024-03-23 to 2024-06-15).</p>
<div class="cell">
<details class="code-fold">
<summary>remove data with duplicated timestamps</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posmo_df &lt;- distinct(posmo_df,datetime,.keep_all=TRUE)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># skimr::skim(posmo_df$datetime)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If there is no movement within one day, there will be only one location (<code>place_name</code> in the attribute table) recorded. Here we define “valid trip day” as “the day with at least three GPS records”. Based on that rule, we generate 37151 GPS points, with 55 valid trip information. Figure 1 below shows the among different dates.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the date from the datetime column</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude the data if the record of the day is less than three</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>posmo_df <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as_date</span>(datetime)) <span class="sc">|&gt;</span> <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(posmo_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37151</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(posmo_df<span class="sc">$</span>date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 55</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of data points per date</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column for the month</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>date_counts <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(datetime),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">month</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, month) <span class="sc">|&gt;</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the result with points colored by month</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(date_counts, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> count, <span class="at">color =</span> month)) <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Count of GPS Points"</span>, <span class="at">title =</span> <span class="st">"Figure 1: Count of GPS Points per Date"</span>, <span class="at">color =</span> <span class="st">"Month"</span>) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove this temporary dataframe after plotting the result</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(date_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Although POSMO application can identify the stay point as the end of a trip, we still need to validate whether there are drifted points in our data. ### Detection</p>
</section>
</section>
<section id="reprocessing" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="reprocessing"><span class="header-section-number">3.2</span> Reprocessing</h3>
<p>Dbscan is widely applied in detecting noise in GPS data. This method is easily conducted with two parameters: min</p>
<section id="heuristic-approach" class="level4" data-number="3.2.1">
<h4 data-number="3.2.1" class="anchored" data-anchor-id="heuristic-approach"><span class="header-section-number">3.2.1</span> Heuristic approach</h4>
<p>Heuristic trip identification algorithms utilize a set of analyst-designed rules to identify trips within GPS trajectories. These rules establish thresholds that distinguish trip records from activity records by examining data features such as time differences between records, speed, and record density.</p>
<p>For instance, many heuristic algorithms apply low-speed thresholds, typically in the range of 0 to 0.15 m/s, to identify activity records (Dalumpines and Scott, 2017; Rewa, 2012; Schuessler and Axhausen, 2009; Stopher et al., 2008; Tsui and Shalaby, 2006; Wolf et al., 2001).</p>
<p>Another common method involves using thresholds for dwell time or time differences between consecutive records, sometimes in conjunction with a speed threshold, to identify activities. Typically, a threshold of 120 seconds is used, corresponding to traffic signal cycle lengths (Dalumpines and Scott, 2017; Rewa, 2012; Shen and Stopher, 2013; Stopher et al., 2008; Wolf et al., 2001) 1.</p>
<p>The standard procedure for processing GPS data to identify travel modes involves three steps. First, the data collected from GPS-enabled smartphones is transferred to computers, where output files suitable for further statistical analysis are created. Second, trips or segments are identified. Finally, travel modes are detected based on the previously processed data.</p>
<p>The median speed, percentile speed, average speed, steady speed, and average dwell time were selected as the basic features for the travel mode identification algorithm. The focus was on extracting features related to speed, and the percentile speed was used instead of the maximum speed because the latter might not reflect the actual speed, which could be a sudden and fluctuating value.</p>
</section>
<section id="outdoor-walking-trip-detection" class="level4" data-number="3.2.2">
<h4 data-number="3.2.2" class="anchored" data-anchor-id="outdoor-walking-trip-detection"><span class="header-section-number">3.2.2</span> outdoor walking trip detection</h4>
<p>The following are the characteristics of pedestrian trajectories in contrast to vehicle trajectories: they have a high degree of freedom and are not constrained by the existing road network, thereby reaching places where vehicle GPS cannot; they are highly directional with arbitrary direction at the next moment; they have a relatively slow speed with small change, usually ranging from 0.5 to 6 km/h; and the data quality is uncertain due to factors such as the data collector, collection process, and collection devices.</p>
<p><span class="citation" data-cites="cho2011identifying">Cho, Rodriguez, and Evenson (<a href="#ref-cho2011identifying" role="doc-biblioref">2011</a>)</span> define criteria for identifying outdoor walking trips from GPS data. We adjust the algorithm slightly to interval in our data (5-10 seconds). consecutive track points</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'posmo_2024-03-23_2024-06-15.csv'</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the datetime column is in POSIXct format</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>datetime <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(data<span class="sc">$</span>datetime)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert coordinates to LV95 (Swiss coordinate system)</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(data, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>coordinates_lv95 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(coordinates, <span class="dv">2056</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>lv95_x <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">1</span>]</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>lv95_y <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">2</span>]</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances and speeds between consecutive points</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(datetime) <span class="sc">%&gt;%</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_lv95_x =</span> <span class="fu">lead</span>(lv95_x),</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_lv95_y =</span> <span class="fu">lead</span>(lv95_y),</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_datetime =</span> <span class="fu">lead</span>(datetime),</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_m =</span> <span class="fu">sqrt</span>((next_lv95_x <span class="sc">-</span> lv95_x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (next_lv95_y <span class="sc">-</span> lv95_y)<span class="sc">^</span><span class="dv">2</span>),  <span class="co"># Distance in meters</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_diff_secs =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(next_datetime, datetime, <span class="at">units =</span> <span class="st">"secs"</span>)),  <span class="co"># Time difference in seconds</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed_m_per_s =</span> distance_m <span class="sc">/</span> time_diff_secs  <span class="co"># Speed in meters per second</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify points into trips based on time gaps</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>time_gap_threshold <span class="ot">&lt;-</span> <span class="dv">180</span>  <span class="co"># 3 minutes</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">trip_id =</span> <span class="fu">cumsum</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="fu">lag</span>(time_diff_secs)) <span class="sc">|</span> time_diff_secs <span class="sc">&gt;</span> time_gap_threshold, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the criteria</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>min_consecutive_points <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>min_speed_m_per_s <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">/</span> <span class="fl">3.6</span>  <span class="co"># Convert km/h to m/s</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>max_speed_m_per_s <span class="ot">&lt;-</span> <span class="dv">8</span> <span class="sc">/</span> <span class="fl">3.6</span>  <span class="co"># Convert km/h to m/s</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>min_displacement_m <span class="ot">&lt;-</span> <span class="dv">30</span>  <span class="co"># 30 meters</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>min_trip_gap_secs <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">60</span>  <span class="co"># 3 minutes</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply criteria to identify walking trips</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(trip_id) <span class="sc">%&gt;%</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;=</span> min_consecutive_points) <span class="sc">%&gt;%</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(trip_id) <span class="sc">%&gt;%</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_walking_speed =</span> ((speed_m_per_s <span class="sc">&gt;=</span> min_speed_m_per_s) <span class="sc">&amp;</span> (speed_m_per_s <span class="sc">&lt;=</span> max_speed_m_per_s)),</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_lv95_x =</span> <span class="fu">first</span>(lv95_x),</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_lv95_y =</span> <span class="fu">first</span>(lv95_y),</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_lv95_x =</span> <span class="fu">last</span>(lv95_x),</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_lv95_y =</span> <span class="fu">last</span>(lv95_y),</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">displacement_m =</span> <span class="fu">sqrt</span>((end_lv95_x <span class="sc">-</span> start_lv95_x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (end_lv95_y <span class="sc">-</span> start_lv95_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_walking_speed <span class="sc">&amp;</span> displacement_m <span class="sc">&gt;</span> min_displacement_m)</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge preliminary trips if they are close in time</span></span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id) <span class="sc">%&gt;%</span></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_trip_start =</span> <span class="fu">lead</span>(datetime),</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">trip_gap_secs =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(next_trip_start, datetime, <span class="at">units =</span> <span class="st">"secs"</span>)),</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">merged_trip_id =</span> <span class="fu">cumsum</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="fu">lag</span>(trip_gap_secs)) <span class="sc">|</span> trip_gap_secs <span class="sc">&gt;</span> min_trip_gap_secs, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the trips to identify walking trips</span></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>walking_trips <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id, merged_trip_id) <span class="sc">%&gt;%</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_time =</span> <span class="fu">min</span>(datetime),</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_time =</span> <span class="fu">max</span>(datetime),</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_distance_m =</span> <span class="fu">sum</span>(distance_m, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">duration_mins =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">max</span>(datetime), <span class="fu">min</span>(datetime), <span class="at">units =</span> <span class="st">"mins"</span>))</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(duration_mins <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a><span class="co"># View the identified walking trips</span></span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(walking_trips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 338 × 6
# Groups:   user_id [1]
   user_id                merged_trip_id start_time          end_time           
   &lt;chr&gt;                           &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;             
 1 0f84c8f2-20e1-4f1e-b9…              1 2024-03-23 15:51:50 2024-03-23 16:00:34
 2 0f84c8f2-20e1-4f1e-b9…              2 2024-03-23 16:00:44 2024-03-23 17:50:11
 3 0f84c8f2-20e1-4f1e-b9…              3 2024-03-23 17:50:22 2024-03-23 21:48:39
 4 0f84c8f2-20e1-4f1e-b9…              4 2024-03-23 21:48:50 2024-03-23 22:14:48
 5 0f84c8f2-20e1-4f1e-b9…              5 2024-03-23 22:14:59 2024-03-23 22:26:56
 6 0f84c8f2-20e1-4f1e-b9…              6 2024-03-23 22:27:08 2024-03-24 07:56:40
 7 0f84c8f2-20e1-4f1e-b9…              7 2024-03-24 07:56:51 2024-03-24 08:14:37
 8 0f84c8f2-20e1-4f1e-b9…              8 2024-03-24 08:14:52 2024-03-24 20:01:06
 9 0f84c8f2-20e1-4f1e-b9…              9 2024-03-24 20:01:17 2024-03-24 20:26:49
10 0f84c8f2-20e1-4f1e-b9…             10 2024-03-24 20:27:00 2024-03-25 06:10:54
# ℹ 328 more rows
# ℹ 2 more variables: total_distance_m &lt;dbl&gt;, duration_mins &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The threshold of walking speed is from 0 to 0.15 m/s. We rebuild the walking detection method from <span class="citation" data-cites="gong2012gps">Gong et al. (<a href="#ref-gong2012gps" role="doc-biblioref">2012</a>)</span>, with the process and rules as follow: - 1. * Prepare GPS table<br>
* 1a. Stops if speed &lt; 1.6 km/h; gaps if time interval &gt; 120 s and distance &gt; 250 m</p>
<ul>
<li><ol start="2" type="1">
<li>Divide GPS data into trips</li>
</ol></li>
<li><p>2a. Activity node if a cluster of points &lt; 50 m of each other for &gt; 200 s</p></li>
<li><ol start="3" type="1">
<li>Divide trips into trip segments</li>
</ol></li>
<li><p>3a. first and last points of a gap or of a walk segment &gt; 60 s</p></li>
<li><p>3b. Walk segment:</p>
<ul>
<li><ol type="1">
<li>First point if speed ⩾ 1.6 km/h and &lt; 10 km/h;</li>
</ol></li>
<li><ol start="2" type="1">
<li>Speed of each subsequent point ⩽ 15 km/h;</li>
</ol></li>
<li><ol start="3" type="1">
<li>Duration &gt; 60 s;</li>
</ol></li>
<li><ol start="4" type="1">
<li>85th percentile of speed of all points ⩽ 10 km/h;</li>
</ol></li>
<li><ol start="5" type="1">
<li>Average speed of all points ⩽ 6 km/h;</li>
</ol></li>
</ul></li>
</ul>
<p>A study from <span class="citation" data-cites="20.500.11850/36083">Carrasco (<a href="#ref-20.500.11850/36083" role="doc-biblioref">2011</a>)</span> indicates the average speed of trams in Zurich is between 45 and 50 Km/h. Thus, we define 167 meters (approximate result from 60*10/3.6) as a threshold of drift points for 10-second interval, i.e., it is impossible for ordinary people to move 167 meters per 10 seconds if they use transit (i.e., except airplane here) or other travel modes “slower” than transit in average speed.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"posmo_2024-03-23_2024-06-15.csv"</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the data has appropriate column names and types</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timestamp =</span> <span class="fu">ymd_hms</span>(datetime))</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate speed (m/s) and convert to km/h</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_diff =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(timestamp, <span class="fu">lag</span>(timestamp), <span class="at">units =</span> <span class="st">"secs"</span>)),</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist_diff =</span> <span class="fu">distHaversine</span>(<span class="fu">cbind</span>(lon_x, lat_y), <span class="fu">cbind</span>(<span class="fu">lag</span>(lon_x), <span class="fu">lag</span>(lat_y))),</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed =</span> dist_diff <span class="sc">/</span> time_diff, <span class="co"># Speed in m/s</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed_kmh =</span> speed <span class="sc">*</span> <span class="fl">3.6</span>, <span class="co"># Speed in km/h</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">accel =</span> (speed <span class="sc">-</span> <span class="fu">lag</span>(speed)) <span class="sc">/</span> time_diff <span class="co"># Acceleration in m/s^2</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify stops: speed &lt; 1.6 km/h</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_stop =</span> <span class="fu">ifelse</span>(speed_kmh <span class="sc">&lt;</span> <span class="fl">1.6</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify gaps: time interval &gt; 120 s or distance &gt; 250 m</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_gap =</span> <span class="fu">ifelse</span>(time_diff <span class="sc">&gt;</span> <span class="dv">120</span> <span class="sc">|</span> dist_diff <span class="sc">&gt;</span> <span class="dv">250</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide GPS data into trips</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster_id =</span> (is_gap <span class="sc">&amp;</span> is_stop))</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide GPS data into trips</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify gaps: time interval &gt; 120 s or distance &gt; 250 m</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_gap =</span> <span class="fu">ifelse</span>(time_diff <span class="sc">&gt;</span> <span class="dv">120</span> <span class="sc">|</span> dist_diff <span class="sc">&gt;</span> <span class="dv">250</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> (is_gap <span class="sc">&amp;</span> is_stop))</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to assign cluster IDs</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>assign_cluster_id <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>  cluster_id <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>cluster_id <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(data))) {</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>cluster[i]) <span class="sc">&amp;&amp;</span> data<span class="sc">$</span>cluster[i]) {</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>      cluster_id <span class="ot">&lt;-</span> cluster_id <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>    data<span class="sc">$</span>cluster_id[i] <span class="ot">&lt;-</span> cluster_id</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the is_gap and cluster columns</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_gap =</span> time_diff <span class="sc">&gt;</span> <span class="dv">120</span> <span class="sc">|</span> dist_diff <span class="sc">&gt;</span> <span class="dv">250</span>,</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster =</span> is_gap <span class="sc">|</span> is_stop</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign cluster IDs</span></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> <span class="fu">assign_cluster_id</span>(gps_data)</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate duration of each cluster</span></span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a>cluster_duration <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_id) <span class="sc">%&gt;%</span></span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">cluster_duration =</span> <span class="fu">sum</span>(time_diff, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cluster_duration <span class="sc">&gt;</span> <span class="dv">200</span>)</span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark activity nodes</span></span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_activity_node =</span> <span class="fu">ifelse</span>(cluster_id <span class="sc">%in%</span> cluster_duration<span class="sc">$</span>cluster_id, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide trips into trip segments</span></span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_id) <span class="sc">%&gt;%</span></span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment_id =</span> <span class="fu">cumsum</span>(is_gap <span class="sc">|</span> (speed_kmh <span class="sc">&gt;=</span> <span class="fl">1.6</span> <span class="sc">&amp;</span> speed_kmh <span class="sc">&lt;</span> <span class="dv">10</span>) <span class="sc">&amp;</span> <span class="fu">lead</span>(is_gap, <span class="at">default =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify walk segments</span></span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a>gps_data <span class="ot">&lt;-</span> gps_data <span class="sc">%&gt;%</span></span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(segment_id) <span class="sc">%&gt;%</span></span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment_duration =</span> <span class="fu">sum</span>(time_diff, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a>         <span class="at">segment_85th_percentile_speed =</span> <span class="fu">quantile</span>(speed_kmh, <span class="fl">0.85</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a>         <span class="at">segment_avg_speed =</span> <span class="fu">mean</span>(speed_kmh, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_walk_segment =</span> <span class="fu">ifelse</span>(segment_duration <span class="sc">&gt;</span> <span class="dv">60</span> <span class="sc">&amp;</span></span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a>                                  segment_85th_percentile_speed <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span></span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true" tabindex="-1"></a>                                  segment_avg_speed <span class="sc">&lt;=</span> <span class="dv">6</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We refer to the tutorial from <span class="citation" data-cites="muller2022analyzing">Müller et al. (<a href="#ref-muller2022analyzing" role="doc-biblioref">2022</a>)</span> to split time into minutes.</p>
<p>Detecting <span class="citation" data-cites="jiaqi2018transport">Jiaqi (<a href="#ref-jiaqi2018transport" role="doc-biblioref">2018</a>)</span>.</p>
</section>
</section>
<section id="random-forest" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">3.3</span> Random forest</h3>
<p>The Random Forest algorithm is an improvement over decision trees and consists of multiple decision trees. For an individual tree, nodes are created by randomly selecting data and features during the training model. The node value is determined by the threshold that best splits the data, i.e., the situation where a particular label of travel mode accounts for the highest proportion of the segmented data. The growth stops when the label type becomes unique. During model recognition, the test data is compared with the node values and falls into a specific sub-node accordingly. This comparison of features is repetitive until the data falls into a leaf node. The label of the leaf node represents the recognition result of the trajectory data segment. All the decision trees’ recognition results are then put to a vote, and the travel mode label with the highest votes is determined to be the identification result of the Random Forest.</p>
<p>The essence of the Random Forest algorithm lies in its use of a dichotomous method based on thresholds, which is more suited to solving classification problems. Therefore, we convert the problem of identifying travel modes from a segment of trajectory data into a classification problem, utilizing the random Forest algorithm to complete the travel mode identification.</p>
<p>Machine learning is also a primary approach for travel mode detection. <span class="citation" data-cites="Roy2020Classifying">Roy et al. (<a href="#ref-Roy2020Classifying" role="doc-biblioref">2020</a>)</span> investigate the performance of machine learning.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check rows where datetime is out of order</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>disordered_df <span class="ot">&lt;-</span> posmo_df <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_ordered =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="fu">diff</span>(datetime) <span class="sc">&gt;=</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="at">is_ordered =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here we find there is no systematic error about temporal disorder in our data, potentially because we use application based GPS data here (i.e., such errors have been fixed before exportation).</p>
</section>
<section id="spatial-context" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="spatial-context"><span class="header-section-number">3.4</span> Spatial context</h3>
<p><span class="citation" data-cites="hong_evaluating_2023">Hong, Stüdeli, and Raubal (<a href="#ref-hong_evaluating_2023" role="doc-biblioref">2023</a>)</span> combine labeled GPS trajectories with geospatial context features (road network, water, green space, residential areas) for a preciser travel mode detection by machine learning. Here we utilize walkway network and digital elevation model to.</p>
<div class="cell">
<details class="code-fold">
<summary>load gpkg and show foot way with attribute table, and review on map</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>walkway_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"foot_zurich.gpkg"</span>, <span class="at">layer =</span> <span class="st">"taz_mm.tbl_routennetz"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>walkway_sf <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(walkway_sf)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>walkway_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(walkway_sf, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the CRS matches between walkway_sf and walk_sf</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>walkway_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(walkway_sf, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert walk points to sf object</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>walk_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(walk,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lv95_x"</span>, <span class="st">"lv95_y"</span>),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">crs =</span> <span class="dv">2056</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out rows with null values in the transport_mode column</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> posmo_df <span class="sc">%&gt;%</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(transport_mode))</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign trip identifiers based on changes in transport_mode</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tra_id =</span> <span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">as.numeric</span>(transport_mode[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">!=</span> transport_mode[<span class="sc">-</span><span class="fu">n</span>()]))))</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to snap a single point to the nearest linestring</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>snap_to_nearest <span class="ot">&lt;-</span> <span class="cf">function</span>(point, lines) {</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  nearest_line_idx <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(point, lines)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  nearest_line <span class="ot">&lt;-</span> lines[nearest_line_idx, ]</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  nearest_point <span class="ot">&lt;-</span> <span class="fu">st_nearest_points</span>(point, nearest_line)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(nearest_point, <span class="st">"POINT"</span>)[<span class="dv">2</span>, ] <span class="co"># Take the second point which is on the linestring</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both walk_sf and walkway_sf have the same CRS</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">st_crs</span>(walk_sf) <span class="sc">!=</span> <span class="fu">st_crs</span>(walkway_sf)) {</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  walk_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(walk_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(walkway_sf))</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Snap each point to the nearest linestring, considering each transport_mode_id separately</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>walk_snapped <span class="ot">&lt;-</span> walk_sf <span class="sc">%&gt;%</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(datetime) <span class="sc">%&gt;%</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">geometry =</span> <span class="fu">map</span>(geometry, snap_to_nearest, <span class="at">lines =</span> walkway_sf)</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the snapped points back to sf object with updated geometry</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>walk_snapped_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(walk_snapped, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the snapped points on the map</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(walkway_sf) <span class="sc">+</span> <span class="fu">mapview</span>(walk_snapped_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Raw GPS coordinates complexity of urban road network <span class="citation" data-cites="HE2019122318">He et al. (<a href="#ref-HE2019122318" role="doc-biblioref">2019</a>)</span>. The objective is to accurately align GPS points collected during walks with the corresponding walkways on a map, ensuring spatial accuracy and continuity.</p>
<p>Data and Preprocessing Data Sources Walkway Network (walkway_sf): A GeoPackage file containing the linestrings representing the walkways in Zurich. The data is projected in the CH1903+ / LV95 coordinate reference system (CRS). GPS Points (walk_sf): A dataset containing GPS points collected during walks, also projected in the CH1903+ / LV95 CRS. Data Loading Both datasets are loaded and transformed to ensure they share the same CRS. This step is crucial to avoid any spatial discrepancies during the map matching process.</p>
<p>A 10-meter buffer is created around each GPS point to identify intersecting line strings within a reasonable proximity (i.e., the width of walking streets in reality). This buffer helps in reducing the search space for potential matches. Using spatial joins, linestrings that intersect with each buffer are identified. This step narrows down the linestrings that are potential matches for each GPS point. For each GPS point, the nearest intersecting linestring is determined based on the shortest distance. The snapping function ensures that each point is aligned to the closest point on the nearest linestring. The snapped points are converted into a single geometry column and integrated into a new sf object.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the walkway network</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>walkway_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"foot_zurich.gpkg"</span>, <span class="at">layer =</span> <span class="st">"taz_mm.tbl_routennetz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `taz_mm.tbl_routennetz' from data source 
  `D:\UZH\GEO880_Modul_CMA\semester_project\CMA_Semesterproject_24FS\foot_zurich.gpkg' 
  using driver `GPKG'
Simple feature collection with 40292 features and 11 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 2676247 ymin: 1241672 xmax: 2689662 ymax: 1254307
Projected CRS: CH1903+ / LV95</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert walk points to sf object</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>walk_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(walk, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lv95_x"</span>, <span class="st">"lv95_y"</span>), <span class="at">crs =</span> <span class="dv">2056</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both sf objects have the same CRS</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>walkway_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(walkway_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(walk_sf))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a buffer around each point</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>buffered_points <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(walk_sf, <span class="at">dist =</span> <span class="dv">10</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Find intersecting lines for each point</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>intersections <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(buffered_points, walkway_sf)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to find the nearest linestring for each point within the buffer</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>find_nearest_line <span class="ot">&lt;-</span> <span class="cf">function</span>(point, lines) {</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure CRS match</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">st_crs</span>(point) <span class="sc">!=</span> <span class="fu">st_crs</span>(lines)) {</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    lines <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(lines, <span class="at">crs =</span> <span class="fu">st_crs</span>(point))</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(lines) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">st_geometry</span>(point))</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(point, lines)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  nearest_line_idx <span class="ot">&lt;-</span> <span class="fu">which.min</span>(distances)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  nearest_line <span class="ot">&lt;-</span> lines[nearest_line_idx, ]</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  nearest_point <span class="ot">&lt;-</span> <span class="fu">st_nearest_points</span>(point, nearest_line)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(nearest_point, <span class="st">"POINT"</span>)[<span class="dv">2</span>]  <span class="co"># Take the second point which is on the linestring</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to each point in walk_sf</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>walk_snapped <span class="ot">&lt;-</span> walk_sf <span class="sc">%&gt;%</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">snapped_geometry =</span> <span class="fu">list</span>(<span class="fu">find_nearest_line</span>(geometry, walkway_sf[intersections[[<span class="fu">cur_group_id</span>()]], ]))</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert snapped_geometry to a single geometry column</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>snapped_geometries <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">do.call</span>(c, <span class="fu">lapply</span>(walk_snapped<span class="sc">$</span>snapped_geometry, st_geometry)), <span class="at">crs =</span> <span class="fu">st_crs</span>(walk_sf))</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new sf object with the snapped geometries</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>walk_snapped_sf <span class="ot">&lt;-</span> walk_snapped <span class="sc">%&gt;%</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> snapped_geometries) <span class="sc">%&gt;%</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>snapped_geometry)</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Create LINESTRING by grouping by transport_mode_id</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>walk_snapped_line <span class="ot">&lt;-</span> walk_snapped_sf <span class="sc">%&gt;%</span> </span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span> </span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>)</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of lines to sample</span></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>number_of_lines_to_sample <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample lines with the same transport_mode_id from both collections</span></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>sampled_walk_line <span class="ot">&lt;-</span> walk_line <span class="sc">%&gt;%</span></span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(number_of_lines_to_sample) <span class="sc">%&gt;%</span></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">"original"</span>)</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>sampled_walk_snapped_line <span class="ot">&lt;-</span> walk_snapped_line <span class="sc">%&gt;%</span></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(number_of_lines_to_sample) <span class="sc">%&gt;%</span></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">"snapped"</span>)</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the sampled lines into a single sf object</span></span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>combined_lines <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sampled_walk_line, sampled_walk_snapped_line)</span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>sample_combine <span class="ot">&lt;-</span> combined_lines <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode_id <span class="sc">==</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">262</span>, <span class="dv">1</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the lines on the same map with different colors</span></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(sample_combine, <span class="at">zcol =</span> <span class="st">"source"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-6fb8e4092cac07cca959" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6fb8e4092cac07cca959">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["line",430]},{"method":"addPolylines","args":[[[[{"lng":[8.51791100837322,8.517824008373157,8.517691008373049,8.517516008372889,8.517412008372816,8.517304008372763,8.517440008372951,8.517433008372988,8.517851008373347,8.51791300837341,8.517629008373158,8.517867008373438,8.517756008373341],"lat":[47.36170201016616,47.36161401016613,47.36156401016613,47.36151401016617,47.36143801016617,47.3612540101661,47.36108201016605,47.36093601016601,47.36109101016595,47.36108301016593,47.36102201016599,47.36085201016587,47.36081101016588]}]],[[{"lng":[8.517902466191702,8.517804067881944,8.517717638779432,8.517511904752228,8.517422331515338,8.517288470886715,8.517349007816854,8.517433008372988,8.517851008373347,8.51791300837341,8.517629008373158,8.517867008373438,8.517756008373341],"lat":[47.3617067622483,47.36162510320805,47.36155054897887,47.36151605048536,47.36143287750791,47.36125744264587,47.36113014440243,47.36093601016601,47.36109101016595,47.36108301016593,47.36102201016599,47.36085201016587,47.36081101016588]}]]],null,"sample_combine - source",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"line","stroke":true,"color":["#4B0055","#FDE333"],"weight":2,"opacity":[0.9,0.9],"fill":false,"fillColor":["#4B0055","#FDE333"],"fillOpacity":[1,1],"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>transport_mode_id&emsp;<\/th><td>186&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>length&emsp;<\/th><td>207.9962 [m]&emsp;<\/td><\/tr><tr><td>4<\/td><th>time_duration&emsp;<\/th><td>125&emsp;<\/td><\/tr><tr><td>5<\/td><th>speed_m_s&emsp;<\/th><td>1.663969&emsp;<\/td><\/tr><tr><td>6<\/td><th>source&emsp;<\/th><td>original&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>transport_mode_id&emsp;<\/th><td>186&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>length&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>time_duration&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>5<\/td><th>speed_m_s&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>6<\/td><th>source&emsp;<\/th><td>snapped&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["original","snapped"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":3,"opacity":1,"fill":false,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[8.517288470886715,47.36081101016588,8.51791300837341,47.3617067622483,true,"sample_combine - source","Zoom to sample_combine - source","<strong> sample_combine - source <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"sample_combine - source",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#FDE333"],"labels":["original","snapped"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"sample_combine - source","extra":null,"layerId":null,"className":"info legend","group":"sample_combine - source"}]}],"limits":{"lat":[47.36081101016588,47.3617067622483],"lng":[8.517288470886715,8.51791300837341]},"fitBounds":[47.36081101016588,8.517288470886715,47.3617067622483,8.51791300837341,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
</section>
</section>
<section id="results" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="results"><span class="header-section-number">4</span> Results</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'posmo_2024-03-23_2024-06-15.csv'</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the datetime column is in POSIXct format</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>datetime <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(data<span class="sc">$</span>datetime)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the datetime column is in POSIXct format</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>datetime <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(data<span class="sc">$</span>datetime)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert coordinates to LV95 (Swiss coordinate system)</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(data, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>coordinates_lv95 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(coordinates, <span class="dv">2056</span>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>lv95_x <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">1</span>]</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>lv95_y <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">2</span>]</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances and speeds between consecutive points</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(datetime) <span class="sc">%&gt;%</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_lv95_x =</span> <span class="fu">lead</span>(lv95_x),</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_lv95_y =</span> <span class="fu">lead</span>(lv95_y),</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_datetime =</span> <span class="fu">lead</span>(datetime),</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_m =</span> <span class="fu">sqrt</span>((next_lv95_x <span class="sc">-</span> lv95_x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (next_lv95_y <span class="sc">-</span> lv95_y)<span class="sc">^</span><span class="dv">2</span>),  <span class="co"># Distance in meters</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_diff_secs =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(next_datetime, datetime, <span class="at">units =</span> <span class="st">"secs"</span>)),  <span class="co"># Time difference in seconds</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed_m_per_s =</span> distance_m <span class="sc">/</span> time_diff_secs  <span class="co"># Speed in meters per second</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify points into trips based on time gaps</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>time_gap_threshold <span class="ot">&lt;-</span> <span class="dv">180</span>  <span class="co"># 3 minutes</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">trip_id =</span> <span class="fu">cumsum</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="fu">lag</span>(time_diff_secs)) <span class="sc">|</span> time_diff_secs <span class="sc">&gt;</span> time_gap_threshold, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the criteria</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>min_consecutive_points <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>min_speed_m_per_s <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fl">3.6</span>  <span class="co"># Convert km/h to m/s</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>max_speed_m_per_s <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">/</span> <span class="fl">3.6</span>  <span class="co"># Convert km/h to m/s</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>min_displacement_m <span class="ot">&lt;-</span> <span class="dv">20</span>  <span class="co"># 30 meters</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>min_trip_gap_secs <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">60</span>  <span class="co"># 3 minutes</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply criteria to identify walking trips</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>data_walk <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(trip_id) <span class="sc">%&gt;%</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;=</span> min_consecutive_points) <span class="sc">|&gt;</span> </span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">seg_dis =</span> <span class="fu">sum</span>(distance_m)) <span class="sc">%&gt;%</span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_walking_speed =</span> speed_m_per_s <span class="sc">&gt;=</span> min_speed_m_per_s <span class="sc">&amp;</span> speed_m_per_s <span class="sc">&lt;=</span> max_speed_m_per_s) <span class="sc">%&gt;%</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_walking_speed <span class="sc">&amp;</span> seg_dis <span class="sc">&gt;</span> min_displacement_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We apply the algorithm <span class="citation" data-cites="gong2012gps">Gong et al. (<a href="#ref-gong2012gps" role="doc-biblioref">2012</a>)</span> to detect walking travel.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>posmo_simple <span class="ot">&lt;-</span> posmo_df <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transport_mode =</span> <span class="fu">case_when</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    transport_mode <span class="sc">==</span> <span class="st">"Tram"</span> <span class="sc">~</span> <span class="st">"Vehicle"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    transport_mode <span class="sc">==</span> <span class="st">"Train"</span> <span class="sc">~</span> <span class="st">"Vehicle"</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    transport_mode <span class="sc">==</span> <span class="st">"Bus"</span> <span class="sc">~</span> <span class="st">"Vehicle"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    transport_mode <span class="sc">==</span> <span class="st">"Car"</span> <span class="sc">~</span> <span class="st">"Vehicle"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    transport_mode <span class="sc">==</span> <span class="st">"Bike"</span> <span class="sc">~</span> <span class="st">"Walk"</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> transport_mode  <span class="co"># Keep all other values unchanged</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>trajectories_all_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(posmo_simple,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lv95_x"</span>, <span class="st">"lv95_y"</span>),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">2056</span>, <span class="at">remove =</span> <span class="cn">FALSE</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Group points by transport_mode_id and get the unique transport_mode for each group</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>mode_mapping <span class="ot">&lt;-</span> posmo_simple <span class="sc">%&gt;%</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">transport_mode =</span> <span class="fu">first</span>(transport_mode)) <span class="sc">%&gt;%</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create LINESTRING by grouping by transport_mode_id</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>trajectories_all_line <span class="ot">&lt;-</span> trajectories_all_sf <span class="sc">%&gt;%</span> </span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span> </span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">st_length</span>(geometry))</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Join transport_mode to trajectories_all_line</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>trajectories_all_line <span class="ot">&lt;-</span> trajectories_all_line <span class="sc">%&gt;%</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mode_mapping, <span class="at">by =</span> <span class="st">"transport_mode_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transport_mode =</span> <span class="fu">as.factor</span>(transport_mode))</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Group points by transport_mode_id and calculate the time duration for each group</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>time_duration_all <span class="ot">&lt;-</span> trajectories_all_sf <span class="sc">%&gt;%</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_time =</span> <span class="fu">min</span>(datetime),</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_time =</span> <span class="fu">max</span>(datetime),</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_duration =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">max</span>(datetime), <span class="fu">min</span>(datetime)), <span class="at">units =</span> <span class="st">"secs"</span>)</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">st_drop_geometry</span>()</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the time durations back to walk_line</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>trajectories_all_line <span class="ot">&lt;-</span> trajectories_all_line <span class="sc">%&gt;%</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(time_duration_all <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(transport_mode_id, time_duration), <span class="at">by =</span> <span class="st">"transport_mode_id"</span>)</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean speed</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>trajectories_all_line <span class="ot">&lt;-</span> trajectories_all_line <span class="sc">%&gt;%</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speed_m_s =</span> <span class="fu">as.numeric</span>(length <span class="sc">/</span> time_duration)) <span class="sc">|&gt;</span>   <span class="fu">mutate</span>(<span class="at">acc_m2_s =</span> <span class="fu">as.numeric</span>(speed_m_s <span class="sc">/</span> time_duration))</span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest Model</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with NA values</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>trajectories_all_line <span class="ot">&lt;-</span> trajectories_all_line <span class="sc">%&gt;%</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing datasets</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># For reproducibility</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(trajectories_all_line<span class="sc">$</span>transport_mode, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>train_set <span class="ot">&lt;-</span> trajectories_all_line[train_index, ]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>test_set <span class="ot">&lt;-</span> trajectories_all_line[<span class="sc">-</span>train_index, ]</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the control parameters for cross-validation</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>trControl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">search =</span> <span class="st">"grid"</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model with default settings</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>rf_default <span class="ot">&lt;-</span> <span class="fu">train</span>(transport_mode <span class="sc">~</span> length <span class="sc">+</span> time_duration <span class="sc">+</span> speed_m_s <span class="sc">+</span> acc_m2_s, </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> train_set,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">metric =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">trControl =</span> trControl)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_default)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

306 samples
  5 predictor
  2 classes: 'Vehicle', 'Walk' 

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 275, 275, 276, 276, 274, 276, ... 
Resampling results across tuning parameters:

  mtry  Accuracy   Kappa    
  2     0.9507460  0.8971535
  3     0.9474126  0.8901112
  4     0.9474126  0.8901112

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was mtry = 2.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune mtry</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>tuneGrid_mtry <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">.mtry =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>rf_mtry <span class="ot">&lt;-</span> <span class="fu">train</span>(transport_mode <span class="sc">~</span> length <span class="sc">+</span> time_duration <span class="sc">+</span> speed_m_s <span class="sc">+</span> acc_m2_s, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> train_set,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">metric =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tuneGrid =</span> tuneGrid_mtry,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trControl =</span> trControl)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_mtry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

306 samples
  5 predictor
  2 classes: 'Vehicle', 'Walk' 

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 275, 275, 276, 276, 274, 276, ... 
Resampling results across tuning parameters:

  mtry  Accuracy   Kappa    
   1    0.9640793  0.9243546
   2    0.9507460  0.8971535
   3    0.9474126  0.8901112
   4    0.9474126  0.8901112
   5    0.9474126  0.8901112
   6    0.9474126  0.8901112
   7    0.9474126  0.8901112
   8    0.9474126  0.8901112
   9    0.9474126  0.8901112
  10    0.9474126  0.8901112

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was mtry = 1.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>best_mtry <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(best_mtry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a custom RF method that can handle maxnodes</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>customRF <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"Classification"</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">library =</span> <span class="st">"randomForest"</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">loop =</span> <span class="cn">NULL</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parameters =</span> <span class="fu">data.frame</span>(<span class="at">parameter =</span> <span class="fu">c</span>(<span class="st">"mtry"</span>, <span class="st">"maxnodes"</span>),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">class =</span> <span class="fu">rep</span>(<span class="st">"numeric"</span>, <span class="dv">2</span>),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"mtry"</span>, <span class="st">"maxnodes"</span>)),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">grid =</span> <span class="cf">function</span>(x, y, <span class="at">len =</span> <span class="cn">NULL</span>, <span class="at">search =</span> <span class="st">"grid"</span>) {</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expand.grid</span>(<span class="at">mtry =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>len), <span class="at">maxnodes =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">15</span>))</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>                 },</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fit =</span> <span class="cf">function</span>(x, y, wts, param, lev, last, classProbs, ...) {</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">randomForest</span>(x, y, <span class="at">mtry =</span> param<span class="sc">$</span>mtry, <span class="at">maxnodes =</span> param<span class="sc">$</span>maxnodes, ...)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>                 },</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">predict =</span> <span class="cf">function</span>(modelFit, newdata, <span class="at">submodels =</span> <span class="cn">NULL</span>) {</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">predict</span>(modelFit, newdata)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>                 },</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prob =</span> <span class="cf">function</span>(modelFit, newdata, <span class="at">submodels =</span> <span class="cn">NULL</span>) {</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">predict</span>(modelFit, newdata, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>                 },</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">levels =</span> <span class="cf">function</span>(x) x<span class="sc">$</span>classes)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune maxnodes</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>store_maxnode <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>tuneGrid_maxnode <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">mtry =</span> best_mtry, <span class="at">maxnodes =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">15</span>))</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (maxnodes <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">15</span>)) {</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>  rf_maxnode <span class="ot">&lt;-</span> <span class="fu">train</span>(transport_mode <span class="sc">~</span> length <span class="sc">+</span> time_duration <span class="sc">+</span> speed_m_s <span class="sc">+</span> acc_m2_s, </span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> train_set,</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> customRF,</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">metric =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tuneGrid =</span> tuneGrid_maxnode,</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trControl =</span> trControl,</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nodesize =</span> <span class="dv">14</span>,</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>                      <span class="at">importance =</span> <span class="cn">TRUE</span>,</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ntree =</span> <span class="dv">100</span>)</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>  key <span class="ot">&lt;-</span> <span class="fu">toString</span>(maxnodes)</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>  store_maxnode[[key]] <span class="ot">&lt;-</span> rf_maxnode</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results</span></span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>results_maxnode <span class="ot">&lt;-</span> <span class="fu">resamples</span>(store_maxnode)</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(results_maxnode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
summary.resamples(object = results_maxnode)

Models: 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 
Number of resamples: 10 

Accuracy 
        Min.  1st Qu.    Median      Mean   3rd Qu. Max. NA's
5  0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0
6  0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0
7  0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0
8  0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0
9  0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0
10 0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0
11 0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0
12 0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0
13 0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0
14 0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0
15 0.8666667 0.933871 0.9510753 0.9474126 0.9674731    1    0

Kappa 
        Min.   1st Qu.    Median      Mean   3rd Qu. Max. NA's
5  0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0
6  0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0
7  0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0
8  0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0
9  0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0
10 0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0
11 0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0
12 0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0
13 0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0
14 0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0
15 0.7235023 0.8602342 0.8974572 0.8888434 0.9308599    1    0</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the best maxnodes</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>best_maxnodes <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">sapply</span>(store_maxnode, <span class="cf">function</span>(x) x<span class="sc">$</span>results<span class="sc">$</span>Accuracy))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune ntrees</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>store_ntree <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ntrees <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>)) {</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  rf_ntree <span class="ot">&lt;-</span> <span class="fu">train</span>(transport_mode <span class="sc">~</span> length <span class="sc">+</span> time_duration <span class="sc">+</span> speed_m_s <span class="sc">+</span> acc_m2_s, </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> train_set,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> customRF,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">metric =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">mtry =</span> best_mtry, <span class="at">maxnodes =</span> best_maxnodes),</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">trControl =</span> trControl,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nodesize =</span> <span class="dv">14</span>,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">importance =</span> <span class="cn">TRUE</span>,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ntree =</span> ntrees)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  key <span class="ot">&lt;-</span> <span class="fu">toString</span>(ntrees)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  store_ntree[[key]] <span class="ot">&lt;-</span> rf_ntree</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>results_ntree <span class="ot">&lt;-</span> <span class="fu">resamples</span>(store_ntree)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(results_ntree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
summary.resamples(object = results_ntree)

Models: 100, 200, 300, 400, 500 
Number of resamples: 10 

Accuracy 
         Min.   1st Qu.    Median      Mean   3rd Qu.    Max. NA's
100 0.8666667 0.9107527 0.9510753 0.9376277 0.9674731 0.96875    0
200 0.8666667 0.9107527 0.9510753 0.9376277 0.9674731 0.96875    0
300 0.8666667 0.9107527 0.9510753 0.9376277 0.9674731 0.96875    0
400 0.8666667 0.9107527 0.9510753 0.9376277 0.9674731 0.96875    0
500 0.8666667 0.9107527 0.9510753 0.9376277 0.9674731 0.96875    0

Kappa 
         Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA's
100 0.7235023 0.8178884 0.8932789 0.8693054 0.9308599 0.9330454    0
200 0.7235023 0.8164602 0.8932789 0.8690089 0.9315469 0.9330454    0
300 0.7235023 0.8164602 0.8932789 0.8690089 0.9315469 0.9330454    0
400 0.7235023 0.8164602 0.8932789 0.8690089 0.9315469 0.9330454    0
500 0.7235023 0.8164602 0.8932789 0.8690089 0.9315469 0.9330454    0</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the best ntrees</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>best_ntrees <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">sapply</span>(store_ntree, <span class="cf">function</span>(x) x<span class="sc">$</span>results<span class="sc">$</span>Accuracy))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the final model on the test set</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>best_rf_model <span class="ot">&lt;-</span> store_ntree[[best_ntrees]]<span class="sc">$</span>finalModel</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(best_rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/random%20forest%20with%20parameters-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the test set has the same columns and format as the training set</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>test_set_matrix <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(transport_mode <span class="sc">~</span> length <span class="sc">+</span> time_duration <span class="sc">+</span> speed_m_s <span class="sc">+</span> acc_m2_s, <span class="at">data =</span> test_set)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the test set</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_rf_model, <span class="at">newdata =</span> test_set_matrix)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate model performance</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(test_predictions, test_set<span class="sc">$</span>transport_mode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction Vehicle Walk
   Vehicle      45    5
   Walk          3   76
                                          
               Accuracy : 0.938           
                 95% CI : (0.8815, 0.9728)
    No Information Rate : 0.6279          
    P-Value [Acc &gt; NIR] : &lt;2e-16          
                                          
                  Kappa : 0.8684          
                                          
 Mcnemar's Test P-Value : 0.7237          
                                          
            Sensitivity : 0.9375          
            Specificity : 0.9383          
         Pos Pred Value : 0.9000          
         Neg Pred Value : 0.9620          
             Prevalence : 0.3721          
         Detection Rate : 0.3488          
   Detection Prevalence : 0.3876          
      Balanced Accuracy : 0.9379          
                                          
       'Positive' Class : Vehicle         
                                          </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable Importance Plot</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(best_rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/random%20forest%20with%20parameters-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Data Loading and Cleaning The dataset containing GPS points (posmo_simple) and trajectory information (trajectories_all_sf) was loaded. Each GPS point was associated with a specific transport mode (transport_mode). Additional features were engineered, including the length of trajectories, duration of trips, mean speed, and acceleration. Points were grouped by transport_mode_id, and trajectories were converted into LINESTRING geometries to facilitate analysis.</p>
<p>Cross-Validation and Initial Model A 10-fold cross-validation setup was used to ensure robust model training and evaluation. Initially, a Random Forest model was trained with default parameters to establish a baseline for comparison. This preliminary model provided insight into the classification capabilities and highlighted areas for further refinement.</p>
<p>Hyperparameter Tuning To optimize the model’s performance, several hyperparameters were tuned:</p>
<p>mtry: The number of variables randomly sampled as candidates at each split was adjusted. maxnodes: The maximum number of terminal nodes was fine-tuned using a custom Random Forest function. ntree: The number of trees in the forest was also optimized. Using the optimal parameters identified during this tuning process, the final Random Forest model was trained, resulting in improved classification performance.</p>
<p>Model Evaluation The model was evaluated on the test set, and the results were summarized using a confusion matrix and associated statistics. The confusion matrix provided a detailed breakdown of the model’s predictions:</p>
<p>True Positives (Vehicle): 45 instances False Positives (Vehicle): 5 instances True Negatives (Walk): 76 instances False Negatives (Walk): 3 instances The model achieved an accuracy of 93.8%, indicating that it correctly classified 93.8% of the instances. The 95% confidence interval for accuracy ranged from 88.15% to 97.28%, demonstrating high reliability. The No Information Rate (NIR) was 62.79%, significantly lower than the model’s accuracy, highlighting its effectiveness. The p-value for accuracy greater than NIR was less than 2e-16, indicating statistical significance.</p>
<p>Other performance metrics included a Kappa value of 0.8684, reflecting strong agreement between predicted and actual classifications, and a McNemar’s Test p-value of 0.7237, suggesting no significant difference in marginal proportions. The sensitivity (recall) was 93.75%, and the specificity was 93.83%. The Positive Predictive Value (PPV) was 90.00%, and the Negative Predictive Value (NPV) was 96.20%. The model exhibited balanced performance, with a balanced accuracy of 93.79%.</p>
<p>Variable Importance The Random Forest model’s variable importance plot revealed the following insights:</p>
<p>Mean Decrease in Accuracy: This metric indicated how much the model’s accuracy decreased when each variable was excluded. The most influential features were:</p>
<p>speed_m_s: Speed in meters per second length: Length of the trajectory acc_m2_s: Acceleration time_duration: Duration of the trip Mean Decrease in Gini: This metric showed the total decrease in node impurity (Gini impurity) when a variable was used for splitting. The ranking was similar to the Mean Decrease in Accuracy, with speed_m_s and length being the most critical features, followed by acc_m2_s and time_duration.</p>
<p>These plots indicated that speed_m_s and length were the most crucial features for classifying the transport mode, while acc_m2_s and time_duration also contributed but to a lesser extent.</p>
<p>The Random Forest model shows strong performance in classifying transport modes between “Vehicle” and “Walk”. The high accuracy, Kappa, sensitivity, and specificity values indicate that the model is robust and reliable for this classification task. The variable importance plots highlight that speed and length (distance) are the most influential features, followed by acceleration and trip duration.</p>
<ol class="example" type="1">
<li></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>require DEM (example, not run)</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the boundary of Switzerland</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">type =</span> <span class="st">"countries"</span>, <span class="at">country =</span> <span class="st">"Switzerland"</span>,<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get elevation, zoom here means 30 meter resolution</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">get_elev_raster</span>(<span class="at">locations =</span> map, <span class="at">z =</span> <span class="dv">12</span>, <span class="at">clip =</span> <span class="st">"locations"</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the raster DEM to a TIFF file</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(d, <span class="at">filename =</span> <span class="st">"switzerland_dem_30m.tif"</span>, <span class="at">format =</span> <span class="st">"GTiff"</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>posmo_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(posmo_df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the TIFF file back later</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>dem_raster <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">raster</span>(<span class="st">"switzerland_dem_30m.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>posmo_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(posmo_df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the TIFF file back later</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>dem_raster <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">raster</span>(<span class="st">"switzerland_dem_30m.tif"</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>dem_df <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(dem_raster, <span class="fu">st_coordinates</span>(posmo_sf))</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>walk_trip_dem <span class="ot">&lt;-</span> <span class="fu">cbind</span>(posmo_sf, dem_df)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert coordinates to LV95 (Swiss coordinate system)</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(walk_trip_dem, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>coordinates_lv95 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(coordinates, <span class="dv">2056</span>)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>walk_trip_dem<span class="sc">$</span>lv95_x <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">1</span>]</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>walk_trip_dem<span class="sc">$</span>lv95_y <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">2</span>]</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances and speeds between consecutive points</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now) {</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>diff_ele <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>walk_trip_dem <span class="ot">&lt;-</span> walk_trip_dem <span class="sc">|&gt;</span></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">stepMean =</span> </span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">distance_by_element</span>(geometry, <span class="fu">lag</span>(geometry, <span class="dv">6</span>))</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">timeMean =</span> </span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">difftime_secs</span>(datetime, <span class="fu">lag</span>(datetime, <span class="dv">6</span>))</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">speedMean =</span> stepMean<span class="sc">/</span>timeMean) <span class="sc">|&gt;</span> </span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">acc =</span> (speedMean <span class="sc">-</span> <span class="fu">lag</span>(speedMean, <span class="dv">6</span>))<span class="sc">/</span>timeMean)<span class="sc">|&gt;</span> </span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">gradient =</span> (dem_df <span class="sc">-</span> <span class="fu">lag</span>(dem_df, <span class="dv">6</span>))<span class="sc">/</span>stepMean)</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>walk_trip_dem_filterd <span class="ot">&lt;-</span> walk_trip_dem <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span>)</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(walk_trip_dem_filterd<span class="sc">$</span>speedMean, walk_trip_dem_filterd<span class="sc">$</span>gradient, <span class="at">method =</span> <span class="st">"spearman"</span>, <span class="at">exact =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  walk_trip_dem_filterd$speedMean and walk_trip_dem_filterd$gradient
S = 5.6844e+11, p-value = 4.262e-13
alternative hypothesis: true rho is not equal to 0
sample estimates:
        rho 
-0.05959225 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> walk_trip_dem_filterd, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> gradient, <span class="at">y =</span> speedMean)) <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"#0f993d"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  smplot2<span class="sc">::</span><span class="fu">sm_statCorr</span>(<span class="at">corr_method =</span> <span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/read%20DEM-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="discussion" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="discussion"><span class="header-section-number">5</span> Discussion</h2>
<p>We argue speed and acceleration are two main factors of walking detection, which accords with from 1.</p>
<p>Our study also has several limitations. Our raw GPS data lack an attribute in signal accuracy, which is a primary factor in evaluating data quality and detecting outdoor trips <span class="citation" data-cites="muller2022analyzing">Müller et al. (<a href="#ref-muller2022analyzing" role="doc-biblioref">2022</a>)</span>. We only utilized GPS data generated from one participant, so our framework of walking detection could not apply for big data contributed by a mixed group.</p>
<p>We simplify potential travel modes into two types (i.e, walking and vehicle), so our framework is not applicable for cycling and transit (i.e., tram, train, and bus etc.) detection. We do not resample data set because the counts of walking and vehicle trajectories are close, but in that case our workflow does not apply to an unbalanced dataset. For map matching, we only consider geometrical relations (i.e., points to segments) and ignore temporal magnitude <span class="citation" data-cites="HE2019122318">He et al. (<a href="#ref-HE2019122318" role="doc-biblioref">2019</a>)</span>. The complexity of our algorithm here is not optimal and we also lack quantitative validation for map matching, which needs more explorations in the future.</p>
</section>
<section id="conclusion" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">6</span> Conclusion</h2>
<p>We conclude our study by answering following research questions:</p>
<p>Q1: How can we rebuild (heuristic) rule-based walking detection methods under point-based segmentation in R?</p>
<p>Q2: How do we evaluate the performance of walking detection methods?</p>
<p>Q3: How do we match GPS points to a complex road network by topological method?</p>
<p>Q4: Does supervised classification (random forest) perform better than rule-based (heuristic) method in walking detection?</p>
<p>Q5: How to combine other semantic contexts on trajectories?</p>
<p>Our study provide a reproducible framework of detecting walking trips from daily GPS data generated by smartphone application. This procedure can conduce to an accurate walking identification and a better understanding of pedestrian behavior.</p>
<section id="wordcount" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="wordcount"><span class="header-section-number">6.1</span> Wordcount</h3>
<!-- after installing the wordcountadding, remove the line "#| eval: false" -->
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>wordcountaddin<span class="sc">::</span><span class="fu">word_count</span>(<span class="st">"index.qmd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3017</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>wordcountaddin<span class="sc">::</span><span class="fu">text_stats</span>(<span class="st">"index.qmd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">koRpus</th>
<th style="text-align: left;">stringi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Word count</td>
<td style="text-align: left;">3017</td>
<td style="text-align: left;">2891</td>
</tr>
<tr class="even">
<td style="text-align: left;">Character count</td>
<td style="text-align: left;">19548</td>
<td style="text-align: left;">19605</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sentence count</td>
<td style="text-align: left;">256</td>
<td style="text-align: left;">Not available</td>
</tr>
<tr class="even">
<td style="text-align: left;">Reading time</td>
<td style="text-align: left;">15.1 minutes</td>
<td style="text-align: left;">14.5 minutes</td>
</tr>
</tbody>
</table>
</div>
</div>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-20.500.11850/36083" class="csl-entry" role="listitem">
Carrasco, Nelson. 2011. <span>“Quantifying Public Transport Reliability in Zurich.”</span> Other Conference Item. Zürich: 11th Swiss Transport Research Conference. <a href="https://doi.org/10.3929/ethz-a-006481882">https://doi.org/10.3929/ethz-a-006481882</a>.
</div>
<div id="ref-cho2011identifying" class="csl-entry" role="listitem">
Cho, Gi-Hyoug, Daniel A Rodriguez, and Kelly R Evenson. 2011. <span>“Identifying Walking Trips Using GPS Data.”</span> <em>Med Sci Sports Exerc</em> 43 (2): 365–72.
</div>
<div id="ref-gong2012gps" class="csl-entry" role="listitem">
Gong, Hongmian, Cynthia Chen, Evan Bialostozky, and Catherine T Lawson. 2012. <span>“A GPS/GIS Method for Travel Mode Detection in New York City.”</span> <em>Computers, Environment and Urban Systems</em> 36 (2): 131–39.
</div>
<div id="ref-HE2019122318" class="csl-entry" role="listitem">
He, Mujun, Linjiang Zheng, Wei Cao, Jing Huang, Xu Liu, and Weining Liu. 2019. <span>“An Enhanced Weight-Based Real-Time Map Matching Algorithm for Complex Urban Networks.”</span> <em>Physica A: Statistical Mechanics and Its Applications</em> 534: 122318. https://doi.org/<a href="https://doi.org/10.1016/j.physa.2019.122318">https://doi.org/10.1016/j.physa.2019.122318</a>.
</div>
<div id="ref-hong_evaluating_2023" class="csl-entry" role="listitem">
Hong, Ye, Emanuel Stüdeli, and Martin Raubal. 2023. <span>“Evaluating Geospatial Context Information for Travel Mode Detection.”</span> <em>Journal of Transport Geography</em> 113: 103736. <a href="https://doi.org/10.1016/j.jtrangeo.2023.103736">https://doi.org/10.1016/j.jtrangeo.2023.103736</a>.
</div>
<div id="ref-HUANG2019297" class="csl-entry" role="listitem">
Huang, Haosheng, Yi Cheng, and Robert Weibel. 2019. <span>“Transport Mode Detection Based on Mobile Phone Network Data: A Systematic Review.”</span> <em>Transportation Research Part C: Emerging Technologies</em> 101: 297–312. https://doi.org/<a href="https://doi.org/10.1016/j.trc.2019.02.008">https://doi.org/10.1016/j.trc.2019.02.008</a>.
</div>
<div id="ref-jiaqi2018transport" class="csl-entry" role="listitem">
Jiaqi, Kimberley Chin. 2018. <span>“Transport Mode Detection Using Cellular Signaling Data (Case Study of Graz and Vienna, Austria).”</span> Geographisches Institut der Universit<span>ä</span>t Z<span>ü</span>rich.
</div>
<div id="ref-montini2014trip" class="csl-entry" role="listitem">
Montini, Lara, Nadine Rieser-Schüssler, Andreas Horni, and Kay W Axhausen. 2014. <span>“Trip Purpose Identification from GPS Tracks.”</span> <em>Transportation Research Record</em> 2405 (1): 16–23.
</div>
<div id="ref-muller2022analyzing" class="csl-entry" role="listitem">
Müller, Sandrine R, Joseph B Bayer, Morgan Quinn Ross, Jerry Mount, Clemens Stachl, Gabriella M Harari, Yung-Ju Chang, and Huyen TK Le. 2022. <span>“Analyzing GPS Data for Psychological Research: A Tutorial.”</span> <em>Advances in Methods and Practices in Psychological Science</em> 5 (2): 25152459221082680.
</div>
<div id="ref-Roy2020Classifying" class="csl-entry" role="listitem">
Roy, Avipsa, Daniel Fuller, Kevin Stanley, and Trisalyn Nelson. 2020. <span>“Classifying Transport Mode from Global Positioning Systems and Accelerometer Data: A Machine Learning Approach.”</span> <em>Findings</em>, September. <a href="https://doi.org/10.32866/001c.14520">https://doi.org/10.32866/001c.14520</a>.
</div>
<div id="ref-SADEGHIAN2022159" class="csl-entry" role="listitem">
Sadeghian, Paria, Xiaoyun Zhao, Arman Golshan, and Johan Håkansson. 2022. <span>“A Stepwise Methodology for Transport Mode Detection in GPS Tracking Data.”</span> <em>Travel Behaviour and Society</em> 26: 159–67. https://doi.org/<a href="https://doi.org/10.1016/j.tbs.2021.10.004">https://doi.org/10.1016/j.tbs.2021.10.004</a>.
</div>
<div id="ref-XIAO201514" class="csl-entry" role="listitem">
Xiao, Guangnian, Zhicai Juan, and Chunqin Zhang. 2015. <span>“Travel Mode Detection Based on GPS Track Data and Bayesian Networks.”</span> <em>Computers, Environment and Urban Systems</em> 54: 14–22. https://doi.org/<a href="https://doi.org/10.1016/j.compenvurbsys.2015.05.005">https://doi.org/10.1016/j.compenvurbsys.2015.05.005</a>.
</div>
<div id="ref-s18113741" class="csl-entry" role="listitem">
Yang, Xue, Kathleen Stewart, Luliang Tang, Zhong Xie, and Qingquan Li. 2018. <span>“A Review of GPS Trajectories Classification Based on Transportation Mode.”</span> <em>Sensors</em> 18 (11). <a href="https://doi.org/10.3390/s18113741">https://doi.org/10.3390/s18113741</a>.
</div>
<div id="ref-yun2018spatiotemporal" class="csl-entry" role="listitem">
Yun, Hee Jeong, Dong Jin Kang, and Myong Jae Lee. 2018. <span>“Spatiotemporal Distribution of Urban Walking Tourists by Season Using GPS-Based Smartphone Application.”</span> <em>Asia Pacific Journal of Tourism Research</em> 23 (11): 1047–61.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
