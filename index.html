<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Xiao Cui">

<title>Trip detection from daily GPS data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="index_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="index_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="index_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="index_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">

<script src="index_files/libs/leaflet-1.3.1/leaflet.js"></script>

<link href="index_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">

<script src="index_files/libs/proj4-2.6.2/proj4.min.js"></script>

<script src="index_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>

<link href="index_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">

<script src="index_files/libs/leaflet-binding-2.2.2/leaflet.js"></script>

<script src="index_files/libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>

<script src="index_files/libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>

<link href="index_files/libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">

<script src="index_files/libs/HomeButton-0.0.1/home-button.js"></script>

<script src="index_files/libs/HomeButton-0.0.1/easy-button-src.min.js"></script>

<script src="index_files/libs/clipboard-0.0.1/setClipboardText.js"></script>

<link href="index_files/libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">

<link href="index_files/libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">



</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Trip detection from daily GPS data</h1>
<p class="subtitle lead">a review and framework of generating walking trajectories</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Xiao Cui </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>load packages, import data</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check packages: ------------------------------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Default repository</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({r <span class="ot">&lt;-</span> <span class="fu">getOption</span>(<span class="st">"repos"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>r[<span class="st">"CRAN"</span>] <span class="ot">&lt;-</span> <span class="st">"http://cran.r-project.org"</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repos=</span>r)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>check_pkg <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(x, <span class="at">character.only =</span> <span class="cn">TRUE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(x, <span class="at">dep =</span> <span class="cn">TRUE</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(x, <span class="at">character.only =</span> <span class="cn">TRUE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) <span class="fu">stop</span>(<span class="st">"Package not found"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"geosphere"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"sf"</span>) <span class="co"># </span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"purrr"</span>) <span class="co"># package for precise calculation</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"readr"</span>) <span class="co"># a better way to read data than basic R</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"rnaturalearth"</span>) <span class="co"># package for requiring DEM data</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"raster"</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"elevatr"</span>) <span class="co"># package for handling DEM</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"terra"</span>) <span class="co"># package for raster data handling</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"skimr"</span>) <span class="co"># a better package to summarize data</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"ggplot2"</span>) <span class="co"># package for plots</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"smplot2"</span>) <span class="co"># package for more functions based on ggplot</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"mapview"</span>) <span class="co"># package for interactive maps</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"randomForest"</span>) <span class="co"># package for random forest</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"caret"</span>) <span class="co"># package for random forest</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">check_pkg</span>(<span class="st">"e1071"</span>) <span class="co"># package for random forest</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># import data ------------------------------------------------------------------------------</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>posmo_df <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"posmo_2024-03-23_2024-06-15.csv"</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">user_id =</span> <span class="fu">col_character</span>(),</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">datetime =</span> <span class="fu">col_datetime</span>(),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weekday =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Sun"</span>, <span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>)), <span class="co"># read daytime as a factor</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                   <span class="at">place_name =</span> <span class="fu">col_character</span>(),</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transport_mode =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Walk"</span>, <span class="st">"Tram"</span>, <span class="st">"Bus"</span>, <span class="st">"Bike"</span>, <span class="st">"Train"</span>, <span class="st">"Car"</span>)),</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lon_x =</span> <span class="fu">col_double</span>(),</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lat_y =</span> <span class="fu">col_double</span>()</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                 )) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>user_id) <span class="co"># remove user_id because we only have one user here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="abstract" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="abstract"><span class="header-section-number">1</span> Abstract</h2>
<p>Daily GPS trajectories have a huge potential in understanding people’s daily mobility patterns. However, there is still uncertainty in how to detect travel modes from abundant GPS point data accurately. We review and summarize recent studies about GPS data reprocessing, combining geographic context with trajectories, and travel mode detection. Then we detect walking travel mode from daily GPS data generated by POSMO application under this framework. We focus on walking trip identification and rebuild two rule-based algorithms for raw point data and utilize random forest with labeled GPS coordinates. Result shows random forest has the best performance among three detection methods with the accuracy of 93.8%. However, rule-based algorithms are more understandable and doable with around 85% accuracy with the optimal parameters. Speed is the primary factor for identifying walking travel mode compared with other parameters, but acceleration can enhance the precision in the model. Our study provides a framework of identifying walking trajectories and supplementing them by combining other geospatial contexts and map matching.</p>
</section>
<section id="introduction" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2</span> Introduction</h2>
<p>With the advancement of technologies such as mobile devices and Internet, Global Positioning System (GPS) trajectory data generated by users, vehicles, and other mobile objects has experienced explosive growth. Massive trajectory data can depict the spatiotemporal movement patterns, which have enormous value in travel strategy <span class="citation" data-cites="jiaqi2018transport">Jiaqi (<a href="#ref-jiaqi2018transport" role="doc-biblioref">2018</a>)</span>, environmental planning, and policy making <span class="citation" data-cites="yun2018spatiotemporal">Yun, Kang, and Lee (<a href="#ref-yun2018spatiotemporal" role="doc-biblioref">2018</a>)</span>. Travel mode detection is a core field in trajectory data mining, providing the reference of optimizing traffic flow, tourist management, and travel purpose identification <span class="citation" data-cites="montini2014trip">Montini et al. (<a href="#ref-montini2014trip" role="doc-biblioref">2014</a>)</span>. However, it is still challenging to detect travel modes from daily GPS data because such data contain mixed travel modes <span class="citation" data-cites="s18113741">Yang et al. (<a href="#ref-s18113741" role="doc-biblioref">2018</a>)</span>. <span class="citation" data-cites="HUANG2019297">Huang, Cheng, and Weibel (<a href="#ref-HUANG2019297" role="doc-biblioref">2019</a>)</span> summarize how to from complex by mobile network data. There are three main methods for travel mode detection: rule based, unsupervised machine learning, and supervised machine learning. <span class="citation" data-cites="XIAO201514">Xiao, Juan, and Zhang (<a href="#ref-XIAO201514" role="doc-biblioref">2015</a>)</span> identify travel modes by Bayesian network from smartphone-based travel surveys. <span class="citation" data-cites="SADEGHIAN2022159">Sadeghian et al. (<a href="#ref-SADEGHIAN2022159" role="doc-biblioref">2022</a>)</span> mentioned random forest performs best among supervised machine learning. Moreover, combining geographic context with GPS data is also a primary component in travel mode detection to handle raw data effectively and supplement more semantic information for trajectories <span class="citation" data-cites="hong_evaluating_2023">Hong, Stüdeli, and Raubal (<a href="#ref-hong_evaluating_2023" role="doc-biblioref">2023</a>)</span>. Among different travel methods in daily life, walking is not only a common travel mode in daily life, but also a low-cost physical activity which can contribute to health wellbeing <span class="citation" data-cites="yun2018spatiotemporal">Yun, Kang, and Lee (<a href="#ref-yun2018spatiotemporal" role="doc-biblioref">2018</a>)</span>. It is a low cost and low carbon physical activities, which can benefit carbon emission and contribute to psychological well-being. In our study, we focus on detecting walking trips from daily movement activities. We tend to answer following research questions:</p>
<p>Q1: How can we rebuild (heuristic) rule-based walking detection methods under point-based segmentation in R? Q2: How do we evaluate the performance of walking detection methods? Q3: How do we match GPS points to a complex road network by topological method? Q4: Does supervised classification (random forest) perform better than rule-based (heuristic) method in walking detection? Q5: How to combine other semantic contexts on trajectories?</p>
</section>
<section id="material-and-methods" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="material-and-methods"><span class="header-section-number">3</span> Material and Methods</h2>
<section id="data-attributes" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="data-attributes"><span class="header-section-number">3.1</span> Data attributes</h3>
<p>We used daily GPS data collected by POSMO application with the following attributes:</p>
<table class="table-striped table-hover caption-top table">
<caption>Table 1: attributes in POSMO GPS data</caption>
<thead>
<tr class="header">
<th>Variable</th>
<th>Label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>user_id</td>
<td>the user id of POSMO account</td>
</tr>
<tr class="even">
<td>datetime</td>
<td>timestamp of a GPS point</td>
</tr>
<tr class="odd">
<td>weekday</td>
<td>weekday of timestamp (from Sunday to Saturday)</td>
</tr>
<tr class="even">
<td>place_name</td>
<td>the place name where the user is detected as “stop”</td>
</tr>
<tr class="odd">
<td><strong>transport_mode</strong></td>
<td>travel mode detected by POSMO application</td>
</tr>
<tr class="even">
<td>lon_x</td>
<td>longitude of GPS point</td>
</tr>
<tr class="odd">
<td>lat_x</td>
<td>latitude of GPS point</td>
</tr>
</tbody>
</table>
<div class="cell">
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># have a breif view of our data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Check structure of dataset</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(posmo_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">posmo_df</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">37174</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">POSIXct</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">place_name</td>
<td style="text-align: right;">36739</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">weekday</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Fri: 13075, Tue: 5754, Thu: 4947, Mon: 4614</td>
</tr>
<tr class="even">
<td style="text-align: left;">transport_mode</td>
<td style="text-align: right;">435</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Wal: 14898, Tra: 9781, Tra: 7165, Bus: 2684</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lon_x</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.55</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">8.50</td>
<td style="text-align: right;">8.52</td>
<td style="text-align: right;">8.54</td>
<td style="text-align: right;">8.55</td>
<td style="text-align: right;">8.69</td>
<td style="text-align: left;">▇▆▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">lat_y</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">47.36</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">47.22</td>
<td style="text-align: right;">47.36</td>
<td style="text-align: right;">47.37</td>
<td style="text-align: right;">47.38</td>
<td style="text-align: right;">47.41</td>
<td style="text-align: left;">▁▁▁▆▇</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: POSIXct</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">min</th>
<th style="text-align: left;">max</th>
<th style="text-align: left;">median</th>
<th style="text-align: right;">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">datetime</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2024-03-23 10:35:10</td>
<td style="text-align: left;">2024-06-15 13:00:40</td>
<td style="text-align: left;">2024-04-29 21:19:28</td>
<td style="text-align: right;">36071</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(posmo_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  datetime            weekday place_name             transport_mode lon_x lat_y
  &lt;dttm&gt;              &lt;fct&gt;   &lt;chr&gt;                  &lt;fct&gt;          &lt;dbl&gt; &lt;dbl&gt;
1 2024-03-23 10:35:10 Sat     Careum Bildungszentrum &lt;NA&gt;            8.55  47.4
2 2024-03-23 11:55:38 Sat     &lt;NA&gt;                   Walk            8.55  47.4
3 2024-03-23 11:55:38 Sat     &lt;NA&gt;                   Walk            8.55  47.4
4 2024-03-23 11:55:49 Sat     &lt;NA&gt;                   Walk            8.55  47.4
5 2024-03-23 11:56:00 Sat     &lt;NA&gt;                   Walk            8.55  47.4
6 2024-03-23 11:56:11 Sat     &lt;NA&gt;                   Walk            8.55  47.4</code></pre>
</div>
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(posmo_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  datetime            weekday place_name            transport_mode lon_x lat_y
  &lt;dttm&gt;              &lt;fct&gt;   &lt;chr&gt;                 &lt;fct&gt;          &lt;dbl&gt; &lt;dbl&gt;
1 2024-06-15 13:00:18 Sat     &lt;NA&gt;                  Walk            8.52  47.4
2 2024-06-15 13:00:25 Sat     &lt;NA&gt;                  Walk            8.52  47.4
3 2024-06-15 13:00:34 Sat     &lt;NA&gt;                  Walk            8.52  47.4
4 2024-06-15 13:00:40 Sat     &lt;NA&gt;                  Walk            8.52  47.4
5 2024-06-15 13:00:40 Sat     &lt;NA&gt;                  Walk            8.52  47.4
6 2024-06-15 13:00:40 Sat     Uetlibergstrasse 129a &lt;NA&gt;            8.52  47.4</code></pre>
</div>
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the date from the datetime column</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>posmo_df <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as_date</span>(datetime))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Count of days with records</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(posmo_df<span class="sc">$</span>date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 78</code></pre>
</div>
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># date records from</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(posmo_df<span class="sc">$</span>date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-03-23"</code></pre>
</div>
<details class="code-fold">
<summary>have a review on the raw data</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># date records from</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(posmo_df<span class="sc">$</span>date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-06-15"</code></pre>
</div>
</div>
<p>GPS data are recorded by 5-15 second intervals and labeled with transform mode. Users can fix this attribute by adjusting transfer mode manually then validate and export data as a csv document. There are 37174 GPS points in the raw data set with 78 days (from 2024-03-23 to 2024-06-15).</p>
<p>A typical GPS (without supplementary sensors) can usually collect longitude, latitude, and timestamp during operation, but we have more attributes (<code>place_name</code>, <code>transport_mode</code>) here. We assume it combines with other sensors or algorithms for marking location and travel status. Thus, we refer to the project document to learn more about data collection.</p>
</section>
<section id="data-collection" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="data-collection"><span class="header-section-number">3.2</span> Data collection</h3>
<p>The smartphone for data collection is iPhone Xs Max with iOS Version 17.5.1.<br>
We assume POSMO application has similar functions with a GPS logger (i.e., do not record data while stationary). Trip endpoints are typically identified when the dwell time between two consecutive moving data points exceeds a certain threshold. When the GPS loggers resume movement, they require a few seconds to a few minutes to warm start, leading to missing GPS points at the beginning of the trip <span class="citation" data-cites="gong2012gps">Gong et al. (<a href="#ref-gong2012gps" role="doc-biblioref">2012</a>)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check rows where datetime is out of order</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>disordered_df <span class="ot">&lt;-</span> posmo_df <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_ordered =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="fu">diff</span>(datetime) <span class="sc">&gt;=</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="at">is_ordered =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here we find there is no systematic error about temporal disorder in our data, potentially because we use application based GPS data here (i.e., such errors have been fixed before exportation). However, the algorithm for gathering attribute information is still ambiguous. We first explore the data to know how POSMO application collects data. We refer to the documents about data protection under <a href="https://posmo.coop/about-us/datenschutzerklaerung">POSMO application</a>. GPS coordinates here are collected via anonymized IP addresses by removing the last 2 bytes (i.e.&nbsp;198.51.0.0 instead of 198.51.100.54). From the repetitive points statistics below, we find there are 804 endpoints in our raw data. The repeated count of endpoints is between 2 to 4, i.e., when POSMO application detects a “stop”, it will acquire the place name of current anonymized IP address by geocoding (retrieving place names by coordinates), then store this name in the column <code>place_name</code>. In next step, we assume these names are our real origins or destination.</p>
<div class="cell">
<details class="code-fold">
<summary>a review of stop detection in POSMO</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by datetime and count the number of occurrences</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>repeated_counts <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(datetime) <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the repeated_counts partly</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Stop points detection:"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="st">"Total count of stops:"</span>, <span class="fu">nrow</span>(repeated_counts), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="st">"Possible point count of each stop:"</span>, <span class="fu">unique</span>(repeated_counts<span class="sc">$</span>count), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Stop points detection: 
 Total count of stops: 804 
 Possible point count of each stop: 2 3 4 </code></pre>
</div>
<details class="code-fold">
<summary>a review of stop detection in POSMO</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the temporary dataframe</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(repeated_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the attributes in POSMO data, we can generate the raw walking segment data easily. We will use it for map matching in the next session.</p>
<div class="cell">
<details class="code-fold">
<summary>generate raw walking trajectories</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert coordinates to LV95 (Swiss coordinate system)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(posmo_df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>coordinates_lv95 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(coordinates, <span class="dv">2056</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>posmo_df<span class="sc">$</span>lv95_x <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">1</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>posmo_df<span class="sc">$</span>lv95_y <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">2</span>]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign transport_mode_id based on transport_mode</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out rows with null values in the transport_mode column</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>posmo_df <span class="ot">&lt;-</span> posmo_df <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(transport_mode))</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign trip identifiers based on changes in transport_mode</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>posmo_df <span class="ot">&lt;-</span> posmo_df <span class="sc">%&gt;%</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transport_mode_id =</span> <span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">as.numeric</span>(transport_mode[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">!=</span> transport_mode[<span class="sc">-</span><span class="fu">n</span>()]))))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>walk <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>walk_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(walk,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lv95_x"</span>, <span class="st">"lv95_y"</span>),</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">2056</span>, <span class="at">remove =</span> <span class="cn">FALSE</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create LINESTRING by grouping by transport_mode_id</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>walk_line <span class="ot">&lt;-</span> walk_sf <span class="sc">%&gt;%</span> </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span> </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">st_length</span>(geometry))</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Group points by transport_mode_id and calculate the time duration for each group</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>time_durations <span class="ot">&lt;-</span> walk_sf <span class="sc">%&gt;%</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_time =</span> <span class="fu">min</span>(datetime),</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_time =</span> <span class="fu">max</span>(datetime),</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_duration =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">max</span>(datetime), <span class="fu">min</span>(datetime)), <span class="at">units =</span> <span class="st">"secs"</span>)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">st_drop_geometry</span>()</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create LINESTRING by grouping by transport_mode_id</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>walk_line <span class="ot">&lt;-</span> walk_sf <span class="sc">%&gt;%</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">st_length</span>(geometry))</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the time durations back to walk_line</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>walk_line <span class="ot">&lt;-</span> walk_line <span class="sc">%&gt;%</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(time_durations <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(transport_mode_id, time_duration), <span class="at">by =</span> <span class="st">"transport_mode_id"</span>)</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean speed</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>walk_line <span class="ot">&lt;-</span> walk_line <span class="sc">%&gt;%</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speed_m_s =</span> <span class="fu">as.numeric</span>(length <span class="sc">/</span> time_duration))<span class="sc">|&gt;</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>()</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample the walk_line data</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>sampled_walk_line <span class="ot">&lt;-</span> walk_line <span class="sc">%&gt;%</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">1</span>)</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="co"># view the sample by map</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(sampled_walk_line, <span class="at">zcol =</span> <span class="st">"transport_mode_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-2ffb00432e68d674d847" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-2ffb00432e68d674d847">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["line",430]},{"method":"addPolylines","args":[[[[{"lng":[8.549940008393522,8.549070008392849,8.54911000839291,8.549120008392931,8.549107008392909,8.549107008392909,8.549107008392909,8.549107008392909,8.549107008392909,8.549107008392909,8.549107008392909,8.54908500839286,8.549147008392884,8.549186008392882,8.549004008392755,8.549325008393007,8.549789008393409,8.549243008392935,8.549098008392788,8.54895300839263,8.548613008392316,8.548483008392159,8.548629008392295,8.548653008392323,8.548664008392338,8.548653008392327,8.548641008392345,8.548699008392413,8.548699008392413,8.549496008393225,8.549338008393017,8.549552008393226,8.549774008393378,8.549602008393144,8.550258008393694,8.550558008393962,8.550649008394043,8.550289008393662,8.549695008393027,8.549073008392424,8.548664008392072,8.548499008391914,8.548392008391803,8.548210008391608,8.548106008391493,8.547957008391343,8.547712008391089,8.547489008390846,8.547337008390674,8.547124008390474,8.54687200839024,8.546659008390066,8.546638008390092,8.546682008390185,8.546736008390294,8.546687008390299,8.546535008390181,8.546438008390112,8.546185008389889,8.546059008389799,8.545964008389729,8.54580100838958,8.545629008389408,8.545490008389269,8.545324008389107,8.545183008388983,8.545099008388918,8.544985008388837,8.544953008388836,8.545096008388969],"lat":[47.3966690101681,47.39612501016821,47.39605001016815,47.39603101016812,47.39605001016811,47.39605001016811,47.39605001016811,47.39605001016811,47.39605001016811,47.39605001016811,47.39605001016811,47.39613401016819,47.3962540101682,47.39637701016822,47.3962130101682,47.39642501016822,47.39656701016807,47.3963880101682,47.39641801016826,47.39646501016836,47.39641401016843,47.39652301016849,47.39652601016844,47.39651101016842,47.39649801016842,47.39650301016844,47.39641301016839,47.39637901016838,47.39637901016838,47.39625201016807,47.39641501016821,47.39643001016817,47.39661901016816,47.39684401016827,47.3971140101682,47.39718601016808,47.39720001016808,47.3973270101682,47.39751701016843,47.39750301016863,47.39736001016868,47.39735301016875,47.39736401016879,47.39743701016884,47.39747001016887,47.39749201016895,47.39754101016899,47.39763201016913,47.39771401016918,47.39768901016927,47.39765501016934,47.39755501016935,47.39740901016932,47.39725701016923,47.39705301016916,47.39691101016911,47.39680401016914,47.39673401016915,47.39663701016917,47.3965440101692,47.39646701016918,47.39644701016923,47.39646001016926,47.3964610101693,47.39646501016939,47.39643901016942,47.39637401016941,47.39628401016941,47.39620001016939,47.39620401016934]}]]],null,"sampled_walk_line - transport_mode_id",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"line","stroke":true,"color":"#6666FF","weight":2,"opacity":0.9,"fill":false,"fillColor":"#6666FF","fillOpacity":1,"smoothFactor":1,"noClip":false},"<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>transport_mode_id&emsp;<\/th><td>59&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>length&emsp;<\/th><td>1199.999 [m]&emsp;<\/td><\/tr><tr><td>4<\/td><th>time_duration&emsp;<\/th><td>9941&emsp;<\/td><\/tr><tr><td>5<\/td><th>speed_m_s&emsp;<\/th><td>0.1207121&emsp;<\/td><\/tr><\/table><\/div>",{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"59",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":3,"opacity":1,"fill":false,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[8.544953008388836,47.39603101016812,8.550649008394043,47.39771401016918,true,"sampled_walk_line - transport_mode_id","Zoom to sampled_walk_line - transport_mode_id","<strong> sampled_walk_line - transport_mode_id <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"sampled_walk_line - transport_mode_id",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["59"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"sampled_walk_line - transport_mode_id"}]}],"limits":{"lat":[47.39603101016812,47.39771401016918],"lng":[8.544953008388836,8.550649008394043]},"fitBounds":[47.39603101016812,8.544953008388836,47.39771401016918,8.550649008394043,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>remove data with duplicated timestamps</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>posmo_df <span class="ot">&lt;-</span> <span class="fu">distinct</span>(posmo_df,datetime,<span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If there is no movement within one day, there will be only one location (<code>place_name</code> in the attribute table) recorded. Here we define “valid trip day” as “the day with at least three GPS records”. Based on that rule, we generate 35931 GPS points, with 55 valid trip information. Figure 1 below shows the among different dates.</p>
<div class="cell">
<details class="code-fold">
<summary>date distribution</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the date from the datetime column</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude the data if the record of the day is less than three</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>posmo_df <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as_date</span>(datetime)) <span class="sc">|&gt;</span> <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of data points per date</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column for the month</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>date_counts <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(datetime),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">month</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, month) <span class="sc">|&gt;</span> </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the result with points colored by month</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(date_counts, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> count, <span class="at">color =</span> month)) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Count of GPS Points"</span>, <span class="at">title =</span> <span class="st">"Figure 1: Count of GPS Points per Date"</span>, <span class="at">color =</span> <span class="st">"Month"</span>) <span class="sc">+</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>date distribution</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove this temporary dataframe after plotting the result</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(date_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The standard procedure for processing GPS data to identify travel modes involves three steps. First, the data collected from GPS-enabled smartphones is transferred to computers, where output files suitable for further statistical analysis are created. Second, trips or segments are identified. Finally, travel modes are detected based on the previously processed data.</p>
<p>POSMO application can identify the stay point as the end of a trip, so we assume the signal here is more stable than raw GPS and skip the step of detecting drifted points. We focus on how to detect walking trips in the next session.</p>
</section>
<section id="heuristic-rule-based-approach" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="heuristic-rule-based-approach"><span class="header-section-number">3.3</span> Heuristic (rule-based) approach</h3>
<p>Heuristic trip identification algorithms utilize a set of analyst-designed rules to identify trips within GPS trajectories. These rules establish thresholds that distinguish trip records from activity records by examining data features such as time differences between records, speed, and record density. For instance, many heuristic algorithms apply low-speed thresholds, typically in the range of 0 to 0.15 m/s, or 2 to 8 km/h to identify activity records <span class="citation" data-cites="berjisian2022evaluation">Berjisian and Bigazzi (<a href="#ref-berjisian2022evaluation" role="doc-biblioref">2022</a>)</span>.</p>
<p>Another common method involves using thresholds for dwell time or time differences between consecutive records, sometimes in conjunction with a speed threshold, to identify activities. Typically, a threshold of 40, 60, 90, 120 seconds are used for temporal length <span class="citation" data-cites="berjisian2022evaluation">Berjisian and Bigazzi (<a href="#ref-berjisian2022evaluation" role="doc-biblioref">2022</a>)</span>.</p>
</section>
</section>
<section id="result" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="result"><span class="header-section-number">4</span> Result</h2>
<section id="walking-detection" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="walking-detection"><span class="header-section-number">4.1</span> Walking detection</h3>
<section id="walking-trip-detection-chong" class="level4" data-number="4.1.1">
<h4 data-number="4.1.1" class="anchored" data-anchor-id="walking-trip-detection-chong"><span class="header-section-number">4.1.1</span> Walking trip detection: chong</h4>
<p><span class="citation" data-cites="cho2011identifying">Cho, Rodriguez, and Evenson (<a href="#ref-cho2011identifying" role="doc-biblioref">2011</a>)</span> define criteria for identifying outdoor walking trips from GPS data. The threshold here is consecutive track points. We adjust the algorithm slightly to interval in our data (5-15 seconds). - 1. speed should be more than 2 km/h (0.56 m/s)and less than 8 km/h (2.22 m/s); - 2. generate gaps if there are more than five consecutive points; - 3. divide GPS data into trips by gaps; - 4. average speed should be no more than 6 km/h (1.67 m/s).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define helper functions</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now) {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>posmo_sf <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="dv">2056</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># rebuilding algorithm</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>posmo_sf_chong <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">stepMean =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lag</span>(geometry, <span class="dv">6</span>))</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">timeMean =</span> <span class="fu">difftime_secs</span>(datetime, <span class="fu">lag</span>(datetime, <span class="dv">6</span>))</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">speedMean =</span> stepMean <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">walk =</span> <span class="fu">ifelse</span>(speedMean <span class="sc">&gt;</span> <span class="fl">0.56</span> <span class="sc">&amp;</span> speedMean <span class="sc">&lt;</span> <span class="fl">2.22</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign trip IDs based on gaps</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>posmo_sf_chong <span class="ot">&lt;-</span> posmo_sf_chong <span class="sc">|&gt;</span> </span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gap_id =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(walk), <span class="dv">0</span>, walk), <span class="co"># Replace NA values with 0</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">walk_id =</span> <span class="fu">cumsum</span>(<span class="fu">ifelse</span>(gap_id <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">lag</span>(gap_id, <span class="at">default =</span> <span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">|&gt;</span> <span class="fu">filter</span>(gap_id <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co"># filter walk and consecutive group</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>walk_chong <span class="ot">&lt;-</span> posmo_sf_chong <span class="sc">|&gt;</span> <span class="fu">filter</span>(gap_id <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(walk_id) <span class="sc">|&gt;</span> </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;=</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="co"># have an overview</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>walk_chong <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,612 × 17
   datetime            weekday place_name transport_mode lon_x lat_y date      
   &lt;dttm&gt;              &lt;fct&gt;   &lt;chr&gt;      &lt;fct&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    
 1 2024-03-23 11:59:32 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 2 2024-03-23 11:59:43 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 3 2024-03-23 11:59:54 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 4 2024-03-23 12:00:05 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 5 2024-03-23 12:00:16 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 6 2024-03-23 12:00:27 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 7 2024-03-23 12:00:37 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 8 2024-03-23 12:00:48 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 9 2024-03-23 12:00:59 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
10 2024-03-23 12:01:09 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
# ℹ 11,602 more rows
# ℹ 10 more variables: lv95_x &lt;dbl&gt;, lv95_y &lt;dbl&gt;, transport_mode_id &lt;dbl&gt;,
#   geometry &lt;POINT [m]&gt;, stepMean &lt;dbl&gt;, timeMean &lt;dbl&gt;, speedMean &lt;dbl&gt;,
#   walk &lt;lgl&gt;, gap_id &lt;dbl&gt;, walk_id &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Here we find chong’s algorithm can detect 77.9% walking records compared with our original walk data. We will provide a frame work of detection evaluation in the next session.</p>
</section>
<section id="walking-trip-detection-gong" class="level4" data-number="4.1.2">
<h4 data-number="4.1.2" class="anchored" data-anchor-id="walking-trip-detection-gong"><span class="header-section-number">4.1.2</span> Walking trip detection: gong</h4>
<p>The common threshold of walking speed is from 0 to 0.15 m/s. We refer to the walking detection method from <span class="citation" data-cites="gong2012gps">Gong et al. (<a href="#ref-gong2012gps" role="doc-biblioref">2012</a>)</span>, with the process and rules after adjustment as follow: (1) divide trips by time interval more than 150 seconds or distance step more than 250 meters per step; (2) duration is large than 60 s; (3) an average speed is more than 1.67 m/s.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define helper functions</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now) {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>posmo_sf <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="dv">2056</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># rebuilding algorithm</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>posmo_sf_gong <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">stepMean =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lag</span>(geometry, <span class="dv">6</span>))</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">timeMean =</span> <span class="fu">difftime_secs</span>(datetime, <span class="fu">lag</span>(datetime, <span class="dv">6</span>))</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">speedMean =</span> stepMean <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">gap =</span> <span class="fu">ifelse</span>(stepMean <span class="sc">&gt;</span> <span class="dv">250</span> <span class="sc">|</span> timeMean <span class="sc">&gt;</span> <span class="dv">150</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign trip IDs based on gaps</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>posmo_sf_gong <span class="ot">&lt;-</span> posmo_sf_gong <span class="sc">|&gt;</span> </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gap_id =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(gap), <span class="dv">0</span>, gap), <span class="co"># Replace NA values with 0</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">tra_id =</span> <span class="fu">cumsum</span>(gap_id) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to check and adjust trip IDs based on average speed</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>adjust_trip_ids <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">arrange</span>(datetime)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">group_by</span>(tra_id) <span class="sc">|&gt;</span> </span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">avg_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">tra_id =</span> <span class="fu">cumsum</span>(<span class="fu">lag</span>(<span class="fu">cumsum</span>(gap), <span class="at">default =</span> <span class="dv">0</span>)) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">new_gap =</span> <span class="fu">ifelse</span>(avg_speed <span class="sc">&gt;</span> <span class="fl">1.67</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">tra_id =</span> <span class="fu">cumsum</span>(new_gap) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>avg_speed, <span class="sc">-</span>new_gap)</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the adjustment function</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>walk_gong <span class="ot">&lt;-</span> <span class="fu">adjust_trip_ids</span>(posmo_sf_gong) <span class="sc">|&gt;</span>   <span class="fu">group_by</span>(tra_id) <span class="sc">|&gt;</span> </span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>walk_gong <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15,279 × 17
   datetime            weekday place_name transport_mode lon_x lat_y date      
   &lt;dttm&gt;              &lt;fct&gt;   &lt;chr&gt;      &lt;fct&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    
 1 2024-03-23 11:55:38 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 2 2024-03-23 11:55:49 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 3 2024-03-23 11:56:00 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 4 2024-03-23 11:56:11 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 5 2024-03-23 11:56:22 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 6 2024-03-23 11:56:33 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 7 2024-03-23 11:56:44 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 8 2024-03-23 11:56:55 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
 9 2024-03-23 11:57:05 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
10 2024-03-23 11:57:16 Sat     &lt;NA&gt;       Walk            8.55  47.4 2024-03-23
# ℹ 15,269 more rows
# ℹ 10 more variables: lv95_x &lt;dbl&gt;, lv95_y &lt;dbl&gt;, transport_mode_id &lt;dbl&gt;,
#   geometry &lt;POINT [m]&gt;, stepMean &lt;dbl&gt;, timeMean &lt;dbl&gt;, speedMean &lt;dbl&gt;,
#   gap &lt;lgl&gt;, gap_id &lt;dbl&gt;, tra_id &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Here we find gong’s algorithm is not suitable for walking detection: it only sets the threshold of average speed per segment. We also find the selection of parameter is vital for rule-based walking detection. We will use speed and acceleration as an example to conduct a sensitivity analysis.</p>
</section>
<section id="sensitivity-analysis" class="level4" data-number="4.1.3">
<h4 data-number="4.1.3" class="anchored" data-anchor-id="sensitivity-analysis"><span class="header-section-number">4.1.3</span> Sensitivity analysis</h4>
<div class="cell">
<details class="code-fold">
<summary>speed based detection</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function to compute performance metrics for different lag values</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>compute_metrics_for_lag <span class="ot">&lt;-</span> <span class="cf">function</span>(posmo_df, lag_values) {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define helper functions</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now) {</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert dataframe to sf object</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  posmo_sf <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="dv">2056</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize results list</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate over each lag value</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (lag_value <span class="cf">in</span> lag_values) {</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    posmo_sf <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">stepMean =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lag</span>(geometry, lag_value))</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">timeMean =</span> <span class="fu">difftime_secs</span>(datetime, <span class="fu">lag</span>(datetime, lag_value))</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">speedMean =</span> stepMean <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span> </span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">acc =</span> (<span class="fu">lead</span>(speedMean) <span class="sc">-</span> speedMean) <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk =</span> (speedMean <span class="sc">&lt;=</span> <span class="fl">1.7</span>)</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk_s_a =</span> (speedMean <span class="sc">&lt;=</span> <span class="fl">1.7</span>) <span class="sc">&amp;</span> (<span class="fu">abs</span>(acc) <span class="sc">&lt;=</span> <span class="fl">0.009</span>)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation of speed and acceleration based detection</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    walk_tp <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    walk_fp <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>    walk_fn <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>    walk_tn <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>    tp <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tp)</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    fp <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fp)</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fn)</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>    tn <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tn)</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="ot">&lt;-</span> (tp <span class="sc">+</span> tn) <span class="sc">/</span> (tp <span class="sc">+</span> tn <span class="sc">+</span> fp <span class="sc">+</span> fn)</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>    precision <span class="ot">&lt;-</span> tp<span class="sc">/</span> (tp <span class="sc">+</span> fp)</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    specificity <span class="ot">&lt;-</span> tn <span class="sc">/</span> (tn <span class="sc">+</span> fp)</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>    sensitivity <span class="ot">&lt;-</span> tp <span class="sc">/</span> (tp <span class="sc">+</span> fn)</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    recall <span class="ot">&lt;-</span> tp <span class="sc">/</span> (tp <span class="sc">+</span> fn)</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>    balance_accuracy <span class="ot">&lt;-</span> (specificity <span class="sc">+</span> sensitivity) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>    f1 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall)</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results for the current lag value</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>    results[[<span class="fu">as.character</span>(lag_value)]] <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy =</span> accuracy,</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">precision =</span> precision,</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">specificity =</span> specificity,</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">sensitivity =</span> sensitivity,</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">recall =</span> recall,</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">balance_accuracy =</span> balance_accuracy,</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">f1_score =</span> f1</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert results list to data frame</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>  results_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results)</span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_df)</span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Values here represent minutes</span></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>lag_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics for the given lag values</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="ot">&lt;-</span> <span class="fu">compute_metrics_for_lag</span>(posmo_df, lag_values)</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   accuracy precision specificity sensitivity    recall balance_accuracy
1 0.7601726 0.6715632   0.7383683   0.7924724 0.7924724        0.7654203
2 0.7847143 0.6919180   0.7476457   0.8396298 0.8396298        0.7936377
3 0.8036350 0.7086871   0.7584615   0.8705622 0.8705622        0.8145119
4 0.8180477 0.7224090   0.7689977   0.8907232 0.8907232        0.8298604
5 0.8287870 0.7331019   0.7778089   0.9043244 0.9043244        0.8410666
   f1_score
1 0.7270251
2 0.7586508
3 0.7813285
4 0.7977851
5 0.8097609</code></pre>
</div>
</div>
<p>We change the steps of speed to examine their effects on walking detection. For our own trajectory data, lag = 5 (1.5 min interval) can perform best in walking detection.</p>
<div class="cell">
<details class="code-fold">
<summary>speed-acceleration based detection</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function to compute performance metrics for different lag values</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>compute_metrics_for_lag <span class="ot">&lt;-</span> <span class="cf">function</span>(posmo_df, lag_values) {</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define helper functions</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now) {</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert dataframe to sf object</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  posmo_sf <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="dv">2056</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize results list</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate over each lag value</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (lag_value <span class="cf">in</span> lag_values) {</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    posmo_sf <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">stepMean =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lag</span>(geometry, lag_value))</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">timeMean =</span> <span class="fu">difftime_secs</span>(datetime, <span class="fu">lag</span>(datetime, lag_value))</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">speedMean =</span> stepMean <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span> </span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">acc =</span> (<span class="fu">lead</span>(speedMean) <span class="sc">-</span> speedMean) <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk =</span> (speedMean <span class="sc">&lt;=</span> <span class="fl">1.7</span>)</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk_s_a =</span> (speedMean <span class="sc">&lt;=</span> <span class="fl">1.7</span>) <span class="sc">&amp;</span> (<span class="fu">abs</span>(acc) <span class="sc">&lt;=</span> <span class="fl">0.009</span>)</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation of speed and acceleration based detection</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    walk_tp_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    walk_fp_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    walk_fn_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    walk_tn_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>    tp_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tp_s_a)</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    fp_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fp_s_a)</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    fn_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fn_s_a)</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    tn_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tn_s_a)</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    accuracy_s_a <span class="ot">&lt;-</span> (tp_s_a <span class="sc">+</span> tn_s_a) <span class="sc">/</span> (tp_s_a <span class="sc">+</span> tn_s_a <span class="sc">+</span> fp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>    precision_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fp_s_a)</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    specificity_s_a <span class="ot">&lt;-</span> tn_s_a <span class="sc">/</span> (tn_s_a <span class="sc">+</span> fp_s_a)</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>    sensitivity_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>    recall_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>    balance_accuracy_s_a <span class="ot">&lt;-</span> (specificity_s_a <span class="sc">+</span> sensitivity_s_a) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>    f1_s_a <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (precision_s_a <span class="sc">*</span> recall_s_a) <span class="sc">/</span> (precision_s_a <span class="sc">+</span> recall_s_a)</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results for the current lag value</span></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>    results[[<span class="fu">as.character</span>(lag_value)]] <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy =</span> accuracy_s_a,</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">precision =</span> precision_s_a,</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">specificity =</span> specificity_s_a,</span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">sensitivity =</span> sensitivity_s_a,</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">recall =</span> recall_s_a,</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">balance_accuracy =</span> balance_accuracy_s_a,</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">f1_score =</span> f1_s_a</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert results list to data frame</span></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>  results_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results)</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_df)</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>lag_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics for the given lag values</span></span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="ot">&lt;-</span> <span class="fu">compute_metrics_for_lag</span>(posmo_df, lag_values)</span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   accuracy precision specificity sensitivity    recall balance_accuracy
1 0.6327581 0.7245718   0.9632634   0.1431630 0.1431630        0.5532132
2 0.6923655 0.7500000   0.9201399   0.3549278 0.3549278        0.6375338
3 0.7551770 0.7711395   0.8882051   0.5580881 0.5580881        0.7231466
4 0.8008183 0.7788527   0.8646620   0.7062237 0.7062237        0.7854428
5 0.8251079 0.7776196   0.8470396   0.7926079 0.7926079        0.8198238
   f1_score
1 0.2390866
2 0.4818340
3 0.6475397
4 0.7407622
5 0.7850423</code></pre>
</div>
</div>
<p>We change the steps of speed and acceleration to examine their effects on walking detection. For our own trajectory data, lag = 4 (1 min interval) can perform best in walking detection.</p>
<div class="cell">
<details class="code-fold">
<summary>define the function to compute performance metrics for different speedMean and abs(acc) threshold values</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>compute_metrics_for_thresholds <span class="ot">&lt;-</span> <span class="cf">function</span>(posmo_df, thresholds) {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define helper functions</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now) {</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert dataframe to sf object</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  posmo_sf <span class="ot">&lt;-</span> posmo_df <span class="sc">|&gt;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="dv">2056</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize results list</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate over each pair of thresholds</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (threshold <span class="cf">in</span> thresholds) {</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    speed_threshold <span class="ot">&lt;-</span> threshold[<span class="dv">1</span>]</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    acc_threshold <span class="ot">&lt;-</span> threshold[<span class="dv">2</span>]</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    posmo_sf <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">stepMean =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lag</span>(geometry, <span class="dv">6</span>))  <span class="co"># Keeping lag value fixed as 6</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">timeMean =</span> <span class="fu">difftime_secs</span>(datetime, <span class="fu">lag</span>(datetime, <span class="dv">6</span>))</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">speedMean =</span> stepMean <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span> </span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span> (<span class="at">acc =</span> (<span class="fu">lead</span>(speedMean) <span class="sc">-</span> speedMean) <span class="sc">/</span> timeMean) <span class="sc">|&gt;</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk =</span> (speedMean <span class="sc">&lt;=</span> speed_threshold)</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">walk_s_a =</span> (speedMean <span class="sc">&lt;=</span> speed_threshold) <span class="sc">&amp;</span> (<span class="fu">abs</span>(acc) <span class="sc">&lt;=</span> acc_threshold)</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation of speed and acceleration based detection</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    walk_tp_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    walk_fp_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    walk_fn_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    walk_tn_s_a <span class="ot">&lt;-</span> posmo_sf <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Walk"</span> <span class="sc">&amp;</span> walk_s_a <span class="sc">!=</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>    tp_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tp_s_a)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>    fp_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fp_s_a)</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>    fn_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_fn_s_a)</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>    tn_s_a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(walk_tn_s_a)</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>    accuracy_s_a <span class="ot">&lt;-</span> (tp_s_a <span class="sc">+</span> tn_s_a) <span class="sc">/</span> (tp_s_a <span class="sc">+</span> tn_s_a <span class="sc">+</span> fp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>    precision_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fp_s_a)</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>    specificity_s_a <span class="ot">&lt;-</span> tn_s_a <span class="sc">/</span> (tn_s_a <span class="sc">+</span> fp_s_a)</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>    sensitivity_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>    recall_s_a <span class="ot">&lt;-</span> tp_s_a <span class="sc">/</span> (tp_s_a <span class="sc">+</span> fn_s_a)</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>    balance_accuracy_s_a <span class="ot">&lt;-</span> (specificity_s_a <span class="sc">+</span> sensitivity_s_a) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>    f1_s_a <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (precision_s_a <span class="sc">*</span> recall_s_a) <span class="sc">/</span> (precision_s_a <span class="sc">+</span> recall_s_a)</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a row name based on the current thresholds</span></span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>    row_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"speed="</span>, speed_threshold, <span class="st">",acc="</span>, acc_threshold)</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results for the current pair of thresholds</span></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>    results[[row_name]] <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy =</span> accuracy_s_a,</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">precision =</span> precision_s_a,</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">specificity =</span> specificity_s_a,</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">sensitivity =</span> sensitivity_s_a,</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">recall =</span> recall_s_a,</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">balance_accuracy =</span> balance_accuracy_s_a,</span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">f1_score =</span> f1_s_a</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert results list to data frame</span></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>  results_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results)</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_df)</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>thresholds <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">0.001</span>),</span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.7</span>, <span class="fl">0.001</span>),</span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.9</span>, <span class="fl">0.001</span>),</span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">0.002</span>),</span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.7</span>, <span class="fl">0.002</span>),</span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.9</span>, <span class="fl">0.002</span>)</span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics for the given thresholds</span></span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="ot">&lt;-</span> <span class="fu">compute_metrics_for_thresholds</span>(posmo_df, thresholds)</span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     accuracy precision specificity sensitivity    recall
speed=1.5,acc=0.001 0.6895112 0.7806899   0.9395338   0.3189858 0.3189858
speed=1.7,acc=0.001 0.6929351 0.7789661   0.9364103   0.3321128 0.3321128
speed=1.9,acc=0.001 0.6932970 0.7768343   0.9350583   0.3350145 0.3350145
speed=1.5,acc=0.002 0.7395335 0.7867952   0.9113287   0.4849385 0.4849385
speed=1.7,acc=0.002 0.7464926 0.7858741   0.9062937   0.5096725 0.5096725
speed=1.9,acc=0.002 0.7469937 0.7827959   0.9035897   0.5149233 0.5149233
                    balance_accuracy  f1_score
speed=1.5,acc=0.001        0.6292598 0.4529135
speed=1.7,acc=0.001        0.6342615 0.4656818
speed=1.9,acc=0.001        0.6350364 0.4681406
speed=1.5,acc=0.002        0.6981336 0.6000427
speed=1.7,acc=0.002        0.7079831 0.6183312
speed=1.9,acc=0.002        0.7092565 0.6212128</code></pre>
</div>
</div>
<p>Similarly, we change the threshold of speed and acceleration to examine their effects on walking detection. For our own trajectory data, speed=1.9,acc=0.002 can perform best in walking detection.</p>
</section>
</section>
<section id="classification-random-forest" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="classification-random-forest"><span class="header-section-number">4.2</span> Classification: random forest</h3>
<p>The Random Forest algorithm is an improvement over decision trees and consists of multiple decision trees <span class="citation" data-cites="Roy2020Classifying">Roy et al. (<a href="#ref-Roy2020Classifying" role="doc-biblioref">2020</a>)</span>. For an individual tree, nodes are created by randomly selecting data and features during the training model. The node value is determined by the threshold that best splits the data, i.e., the situation where a particular label of travel mode accounts for the highest proportion of the segmented data. The growth stops when the label type becomes unique.</p>
<p>The essence of the Random Forest algorithm lies in its use of a dichotomous method based on thresholds, which is more suited to solving classification problems. Therefore, we convert the problem of identifying travel modes from a segment of trajectory data into a classification problem, utilizing the random Forest algorithm to complete the travel mode identification. Here we return to the trajectories (segment based), and use length, speed, acceleration as attributes for classification. We also simplify the classes into `<code>walk</code> and <code>vehicle</code>.</p>
<p>During model recognition, the test data is compared with the node values and falls into a specific sub-node accordingly. This comparison of features is repetitive until the data falls into a leaf node. The label of the leaf node represents the recognition result of the trajectory data segment. All the decision trees’ recognition results are then put to a vote, and the travel mode label with the highest votes is determined to be the identification result of the Random Forest.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>posmo_simple <span class="ot">&lt;-</span> posmo_df <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transport_mode =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    transport_mode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Tram"</span>, <span class="st">"Train"</span>, <span class="st">"Bus"</span>, <span class="st">"Car"</span>) <span class="sc">~</span> <span class="st">"Vehicle"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    transport_mode <span class="sc">==</span> <span class="st">"Bike"</span> <span class="sc">~</span> <span class="st">"Walk"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> transport_mode</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>trajectories_all_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(posmo_simple,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lv95_x"</span>, <span class="st">"lv95_y"</span>),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">2056</span>, <span class="at">remove =</span> <span class="cn">FALSE</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Group points by transport_mode_id and get the unique transport_mode for each group</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>mode_mapping <span class="ot">&lt;-</span> posmo_simple <span class="sc">%&gt;%</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">transport_mode =</span> <span class="fu">first</span>(transport_mode)) <span class="sc">%&gt;%</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create LINESTRING by grouping by transport_mode_id</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>trajectories_all_line <span class="ot">&lt;-</span> trajectories_all_sf <span class="sc">%&gt;%</span> </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span> </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">st_length</span>(geometry))</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Join transport_mode to trajectories_all_line</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>trajectories_all_line <span class="ot">&lt;-</span> trajectories_all_line <span class="sc">%&gt;%</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mode_mapping, <span class="at">by =</span> <span class="st">"transport_mode_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transport_mode =</span> <span class="fu">as.factor</span>(transport_mode))</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Group points by transport_mode_id and calculate the time duration for each group</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>time_duration_all <span class="ot">&lt;-</span> trajectories_all_sf <span class="sc">%&gt;%</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_time =</span> <span class="fu">min</span>(datetime),</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_time =</span> <span class="fu">max</span>(datetime),</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_duration =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">max</span>(datetime), <span class="fu">min</span>(datetime)), <span class="at">units =</span> <span class="st">"secs"</span>)</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>()</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the time durations back to walk_line</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>trajectories_all_line <span class="ot">&lt;-</span> trajectories_all_line <span class="sc">%&gt;%</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(time_duration_all <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(transport_mode_id, time_duration), <span class="at">by =</span> <span class="st">"transport_mode_id"</span>)</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean speed and acceleration</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>trajectories_all_line <span class="ot">&lt;-</span> trajectories_all_line <span class="sc">%&gt;%</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed_m_s =</span> <span class="fu">as.numeric</span>(length <span class="sc">/</span> time_duration),</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">acc_m2_s =</span> <span class="fu">as.numeric</span>(speed_m_s <span class="sc">/</span> time_duration)</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with NA values</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>trajectories_all_line <span class="ot">&lt;-</span> trajectories_all_line <span class="sc">%&gt;%</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing datasets</span></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(trajectories_all_line<span class="sc">$</span>transport_mode, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>train_set <span class="ot">&lt;-</span> trajectories_all_line[train_index, ]</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>test_set <span class="ot">&lt;-</span> trajectories_all_line[<span class="sc">-</span>train_index, ]</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the control parameters for cross-validation</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>trControl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">search =</span> <span class="st">"grid"</span>)</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune mtry, maxnodes, and ntree</span></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>tuneGrid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxnodes =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">15</span>,</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>)</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>customRF <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"Classification"</span>,</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>                 <span class="at">library =</span> <span class="st">"randomForest"</span>,</span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>                 <span class="at">loop =</span> <span class="cn">NULL</span>,</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parameters =</span> <span class="fu">data.frame</span>(<span class="at">parameter =</span> <span class="fu">c</span>(<span class="st">"mtry"</span>, <span class="st">"maxnodes"</span>, <span class="st">"ntree"</span>),</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">class =</span> <span class="fu">rep</span>(<span class="st">"numeric"</span>, <span class="dv">3</span>),</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"mtry"</span>, <span class="st">"maxnodes"</span>, <span class="st">"ntree"</span>)),</span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>                 <span class="at">grid =</span> <span class="cf">function</span>(x, y, <span class="at">len =</span> <span class="cn">NULL</span>, <span class="at">search =</span> <span class="st">"grid"</span>) {</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expand.grid</span>(<span class="at">mtry =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">maxnodes =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">15</span>, <span class="at">ntree =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>))</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>                 },</span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fit =</span> <span class="cf">function</span>(x, y, wts, param, lev, last, classProbs, ...) {</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">randomForest</span>(x, y, <span class="at">mtry =</span> param<span class="sc">$</span>mtry, <span class="at">maxnodes =</span> param<span class="sc">$</span>maxnodes, <span class="at">ntree =</span> param<span class="sc">$</span>ntree, ...)</span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>                 },</span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>                 <span class="at">predict =</span> <span class="cf">function</span>(modelFit, newdata, <span class="at">submodels =</span> <span class="cn">NULL</span>) {</span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">predict</span>(modelFit, newdata)</span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>                 },</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prob =</span> <span class="cf">function</span>(modelFit, newdata, <span class="at">submodels =</span> <span class="cn">NULL</span>) {</span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">predict</span>(modelFit, newdata, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a>                 },</span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>                 <span class="at">levels =</span> <span class="cf">function</span>(x) x<span class="sc">$</span>classes)</span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>  transport_mode <span class="sc">~</span> length <span class="sc">+</span> time_duration <span class="sc">+</span> speed_m_s <span class="sc">+</span> acc_m2_s, </span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_set,</span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> customRF,</span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> tuneGrid,</span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> trControl,</span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">nodesize =</span> <span class="dv">14</span>,</span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span></span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>192 samples
  5 predictor
  2 classes: 'Vehicle', 'Walk' 

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 172, 173, 173, 172, 173, 173, ... 
Resampling results across tuning parameters:

  mtry  maxnodes  ntree  Accuracy   Kappa    
   1     5        100    0.9165789  0.8326732
   1     5        200    0.9165789  0.8319738
   1     5        300    0.9271053  0.8533235
   1     5        400    0.9165789  0.8326732
   1     5        500    0.9218421  0.8430550
   1     6        100    0.9165789  0.8322078
   1     6        200    0.9063158  0.8115451
   1     6        300    0.9113158  0.8219394
   1     6        400    0.9218421  0.8425897
   1     6        500    0.9113158  0.8219394
   1     7        100    0.9165789  0.8326732
   1     7        200    0.9060526  0.8114428
   1     7        300    0.9060526  0.8114428
   1     7        400    0.9060526  0.8114428
   1     7        500    0.9165789  0.8323212
   1     8        100    0.9165789  0.8325539
   1     8        200    0.9165789  0.8325539
   1     8        300    0.9113158  0.8220567
   1     8        400    0.9113158  0.8220567
   1     8        500    0.9113158  0.8220567
   1     9        100    0.9113158  0.8220567
   1     9        200    0.9165789  0.8325539
   1     9        300    0.9113158  0.8219394
   1     9        400    0.9165789  0.8326718
   1     9        500    0.9113158  0.8220567
   1    10        100    0.9165789  0.8323212
   1    10        200    0.9165789  0.8325539
   1    10        300    0.9165789  0.8325539
   1    10        400    0.9165789  0.8327891
   1    10        500    0.9165789  0.8325539
   1    11        100    0.9218421  0.8428223
   1    11        200    0.9165789  0.8325539
   1    11        300    0.9165789  0.8325539
   1    11        400    0.9165789  0.8325539
   1    11        500    0.9165789  0.8325539
   1    12        100    0.9165789  0.8325539
   1    12        200    0.9165789  0.8325539
   1    12        300    0.9113158  0.8220567
   1    12        400    0.9165789  0.8325539
   1    12        500    0.9165789  0.8325539
   1    13        100    0.9165789  0.8325539
   1    13        200    0.9218421  0.8429358
   1    13        300    0.9113158  0.8220567
   1    13        400    0.9165789  0.8325539
   1    13        500    0.9165789  0.8325539
   1    14        100    0.9218421  0.8428223
   1    14        200    0.9165789  0.8327891
   1    14        300    0.9165789  0.8325539
   1    14        400    0.9113158  0.8220567
   1    14        500    0.9218421  0.8432864
   1    15        100    0.9165789  0.8325539
   1    15        200    0.9165789  0.8325539
   1    15        300    0.9165789  0.8325539
   1    15        400    0.9113158  0.8220567
   1    15        500    0.9165789  0.8325539
   2     5        100    0.9271053  0.8534407
   2     5        200    0.9218421  0.8427070
   2     5        300    0.9218421  0.8427070
   2     5        400    0.9218421  0.8427070
   2     5        500    0.9218421  0.8427070
   2     6        100    0.9218421  0.8427070
   2     6        200    0.9271053  0.8532042
   2     6        300    0.9271053  0.8532042
   2     6        400    0.9218421  0.8427070
   2     6        500    0.9218421  0.8427070
   2     7        100    0.9218421  0.8427070
   2     7        200    0.9271053  0.8532042
   2     7        300    0.9218421  0.8429358
   2     7        400    0.9271053  0.8532042
   2     7        500    0.9271053  0.8532042
   2     8        100    0.9218421  0.8427070
   2     8        200    0.9271053  0.8532042
   2     8        300    0.9271053  0.8532042
   2     8        400    0.9271053  0.8532042
   2     8        500    0.9271053  0.8532042
   2     9        100    0.9218421  0.8427070
   2     9        200    0.9271053  0.8532042
   2     9        300    0.9271053  0.8532042
   2     9        400    0.9218421  0.8427070
   2     9        500    0.9271053  0.8532042
   2    10        100    0.9218421  0.8427070
   2    10        200    0.9218421  0.8427070
   2    10        300    0.9271053  0.8532042
   2    10        400    0.9271053  0.8532042
   2    10        500    0.9218421  0.8427070
   2    11        100    0.9218421  0.8427070
   2    11        200    0.9271053  0.8532042
   2    11        300    0.9271053  0.8532042
   2    11        400    0.9271053  0.8532042
   2    11        500    0.9271053  0.8532042
   2    12        100    0.9271053  0.8532042
   2    12        200    0.9271053  0.8532042
   2    12        300    0.9271053  0.8532042
   2    12        400    0.9271053  0.8532042
   2    12        500    0.9271053  0.8532042
   2    13        100    0.9218421  0.8427070
   2    13        200    0.9271053  0.8532042
   2    13        300    0.9271053  0.8532042
   2    13        400    0.9271053  0.8532042
   2    13        500    0.9218421  0.8427070
   2    14        100    0.9271053  0.8532042
   2    14        200    0.9271053  0.8532042
   2    14        300    0.9271053  0.8532042
   2    14        400    0.9271053  0.8532042
   2    14        500    0.9271053  0.8532042
   2    15        100    0.9271053  0.8532042
   2    15        200    0.9271053  0.8532042
   2    15        300    0.9271053  0.8532042
   2    15        400    0.9218421  0.8427070
   2    15        500    0.9271053  0.8532042
   3     5        100    0.9218421  0.8427070
   3     5        200    0.9218421  0.8427070
   3     5        300    0.9218421  0.8427070
   3     5        400    0.9271053  0.8532042
   3     5        500    0.9218421  0.8427070
   3     6        100    0.9271053  0.8532042
   3     6        200    0.9218421  0.8427070
   3     6        300    0.9271053  0.8532042
   3     6        400    0.9218421  0.8427070
   3     6        500    0.9218421  0.8427070
   3     7        100    0.9221053  0.8432042
   3     7        200    0.9221053  0.8432042
   3     7        300    0.9271053  0.8532042
   3     7        400    0.9218421  0.8427070
   3     7        500    0.9271053  0.8532042
   3     8        100    0.9323684  0.8639380
   3     8        200    0.9221053  0.8432042
   3     8        300    0.9271053  0.8532042
   3     8        400    0.9271053  0.8532042
   3     8        500    0.9271053  0.8532042
   3     9        100    0.9168421  0.8327070
   3     9        200    0.9271053  0.8532042
   3     9        300    0.9165789  0.8319732
   3     9        400    0.9271053  0.8532042
   3     9        500    0.9218421  0.8427070
   3    10        100    0.9271053  0.8532042
   3    10        200    0.9271053  0.8532042
   3    10        300    0.9271053  0.8532042
   3    10        400    0.9271053  0.8532042
   3    10        500    0.9271053  0.8532042
   3    11        100    0.9271053  0.8532042
   3    11        200    0.9271053  0.8532042
   3    11        300    0.9271053  0.8532042
   3    11        400    0.9271053  0.8532042
   3    11        500    0.9271053  0.8532042
   3    12        100    0.9218421  0.8424704
   3    12        200    0.9218421  0.8424704
   3    12        300    0.9271053  0.8532042
   3    12        400    0.9271053  0.8532042
   3    12        500    0.9271053  0.8532042
   3    13        100    0.9218421  0.8427070
   3    13        200    0.9271053  0.8532042
   3    13        300    0.9271053  0.8532042
   3    13        400    0.9271053  0.8532042
   3    13        500    0.9271053  0.8532042
   3    14        100    0.9218421  0.8425897
   3    14        200    0.9271053  0.8532042
   3    14        300    0.9271053  0.8532042
   3    14        400    0.9271053  0.8532042
   3    14        500    0.9271053  0.8532042
   3    15        100    0.9165789  0.8319732
   3    15        200    0.9218421  0.8427070
   3    15        300    0.9218421  0.8427070
   3    15        400    0.9271053  0.8532042
   3    15        500    0.9271053  0.8532042
   4     5        100    0.9115789  0.8219732
   4     5        200    0.9063158  0.8113593
   4     5        300    0.9063158  0.8113593
   4     5        400    0.9063158  0.8113593
   4     5        500    0.9063158  0.8113593
   4     6        100    0.9115789  0.8220931
   4     6        200    0.9115789  0.8218559
   4     6        300    0.9115789  0.8219732
   4     6        400    0.9115789  0.8218559
   4     6        500    0.9063158  0.8113593
   4     7        100    0.9063158  0.8113593
   4     7        200    0.9115789  0.8218559
   4     7        300    0.9115789  0.8219732
   4     7        400    0.9063158  0.8113593
   4     7        500    0.9063158  0.8113593
   4     8        100    0.9113158  0.8213593
   4     8        200    0.9063158  0.8113593
   4     8        300    0.9063158  0.8113593
   4     8        400    0.9063158  0.8113593
   4     8        500    0.9063158  0.8113593
   4     9        100    0.9063158  0.8113593
   4     9        200    0.9115789  0.8219732
   4     9        300    0.9063158  0.8113593
   4     9        400    0.9115789  0.8218559
   4     9        500    0.9063158  0.8113593
   4    10        100    0.9115789  0.8218559
   4    10        200    0.9115789  0.8218559
   4    10        300    0.9063158  0.8113593
   4    10        400    0.9115789  0.8218559
   4    10        500    0.9115789  0.8218559
   4    11        100    0.9115789  0.8220931
   4    11        200    0.9115789  0.8218559
   4    11        300    0.9063158  0.8113593
   4    11        400    0.9063158  0.8113593
   4    11        500    0.9063158  0.8113593
   4    12        100    0.9168421  0.8324704
   4    12        200    0.9115789  0.8218559
   4    12        300    0.9115789  0.8218559
   4    12        400    0.9115789  0.8218559
   4    12        500    0.9063158  0.8113593
   4    13        100    0.9115789  0.8220931
   4    13        200    0.9115789  0.8218559
   4    13        300    0.9063158  0.8113593
   4    13        400    0.9115789  0.8218559
   4    13        500    0.9115789  0.8218559
   4    14        100    0.9115789  0.8218559
   4    14        200    0.9063158  0.8113593
   4    14        300    0.9115789  0.8218559
   4    14        400    0.9063158  0.8113593
   4    14        500    0.9115789  0.8218559
   4    15        100    0.9115789  0.8219732
   4    15        200    0.9063158  0.8113593
   4    15        300    0.9115789  0.8218559
   4    15        400    0.9063158  0.8113593
   4    15        500    0.9115789  0.8218559
   5     5        100    0.9115789  0.8218559
   5     5        200    0.9063158  0.8113593
   5     5        300    0.9115789  0.8218559
   5     5        400    0.9063158  0.8113593
   5     5        500    0.9115789  0.8219732
   5     6        100    0.9115789  0.8218559
   5     6        200    0.9115789  0.8218559
   5     6        300    0.9063158  0.8113593
   5     6        400    0.9115789  0.8218559
   5     6        500    0.9115789  0.8218559
   5     7        100    0.9113158  0.8213593
   5     7        200    0.9168421  0.8324704
   5     7        300    0.9063158  0.8113593
   5     7        400    0.9063158  0.8113593
   5     7        500    0.9115789  0.8219732
   5     8        100    0.9221053  0.8432042
   5     8        200    0.9115789  0.8218559
   5     8        300    0.9115789  0.8218559
   5     8        400    0.9115789  0.8218559
   5     8        500    0.9063158  0.8113593
   5     9        100    0.9115789  0.8218559
   5     9        200    0.9063158  0.8113593
   5     9        300    0.9063158  0.8113593
   5     9        400    0.9115789  0.8218559
   5     9        500    0.9063158  0.8113593
   5    10        100    0.9115789  0.8218559
   5    10        200    0.9115789  0.8218559
   5    10        300    0.9115789  0.8218559
   5    10        400    0.9063158  0.8113593
   5    10        500    0.9115789  0.8218559
   5    11        100    0.9115789  0.8219732
   5    11        200    0.9063158  0.8113593
   5    11        300    0.9063158  0.8113593
   5    11        400    0.9115789  0.8218559
   5    11        500    0.9115789  0.8218559
   5    12        100    0.9115789  0.8218559
   5    12        200    0.9063158  0.8113593
   5    12        300    0.9063158  0.8113593
   5    12        400    0.9115789  0.8219732
   5    12        500    0.9063158  0.8113593
   5    13        100    0.9168421  0.8324704
   5    13        200    0.9063158  0.8113593
   5    13        300    0.9165789  0.8319732
   5    13        400    0.9115789  0.8218559
   5    13        500    0.9115789  0.8218559
   5    14        100    0.9063158  0.8113593
   5    14        200    0.9063158  0.8113593
   5    14        300    0.9115789  0.8218559
   5    14        400    0.9063158  0.8113593
   5    14        500    0.9063158  0.8113593
   5    15        100    0.9115789  0.8220931
   5    15        200    0.9168421  0.8324704
   5    15        300    0.9063158  0.8113593
   5    15        400    0.9063158  0.8113593
   5    15        500    0.9063158  0.8113593
   6     5        100    0.9013158  0.8013656
   6     5        200    0.9165789  0.8318559
   6     5        300    0.9063158  0.8113593
   6     5        400    0.9063158  0.8113593
   6     5        500    0.9063158  0.8113593
   6     6        100    0.9115789  0.8218559
   6     6        200    0.9063158  0.8113593
   6     6        300    0.9115789  0.8218559
   6     6        400    0.9063158  0.8113593
   6     6        500    0.9115789  0.8218559
   6     7        100    0.9168421  0.8325897
   6     7        200    0.9115789  0.8218559
   6     7        300    0.9115789  0.8218559
   6     7        400    0.9063158  0.8113593
   6     7        500    0.9115789  0.8218559
   6     8        100    0.9063158  0.8113593
   6     8        200    0.9063158  0.8113593
   6     8        300    0.9063158  0.8113593
   6     8        400    0.9063158  0.8113593
   6     8        500    0.9115789  0.8218559
   6     9        100    0.9063158  0.8113593
   6     9        200    0.9115789  0.8219732
   6     9        300    0.9115789  0.8218559
   6     9        400    0.9063158  0.8113593
   6     9        500    0.9063158  0.8113593
   6    10        100    0.9063158  0.8113593
   6    10        200    0.9115789  0.8218559
   6    10        300    0.9063158  0.8113593
   6    10        400    0.9063158  0.8113593
   6    10        500    0.9115789  0.8219732
   6    11        100    0.9115789  0.8218559
   6    11        200    0.9063158  0.8113593
   6    11        300    0.9115789  0.8218559
   6    11        400    0.9063158  0.8113593
   6    11        500    0.9063158  0.8113593
   6    12        100    0.9063158  0.8113593
   6    12        200    0.9063158  0.8113593
   6    12        300    0.9063158  0.8113593
   6    12        400    0.9063158  0.8113593
   6    12        500    0.9063158  0.8113593
   6    13        100    0.9063158  0.8113593
   6    13        200    0.9115789  0.8218559
   6    13        300    0.9063158  0.8113593
   6    13        400    0.9115789  0.8218559
   6    13        500    0.9115789  0.8218559
   6    14        100    0.9063158  0.8113593
   6    14        200    0.9063158  0.8113593
   6    14        300    0.9115789  0.8219732
   6    14        400    0.9063158  0.8113593
   6    14        500    0.9115789  0.8218559
   6    15        100    0.9113158  0.8213593
   6    15        200    0.9115789  0.8218559
   6    15        300    0.9063158  0.8113593
   6    15        400    0.9063158  0.8113593
   6    15        500    0.9115789  0.8218559
   7     5        100    0.9115789  0.8219732
   7     5        200    0.9115789  0.8220931
   7     5        300    0.9063158  0.8113593
   7     5        400    0.9063158  0.8113593
   7     5        500    0.9115789  0.8218559
   7     6        100    0.9113158  0.8213593
   7     6        200    0.9115789  0.8218559
   7     6        300    0.9115789  0.8218559
   7     6        400    0.9063158  0.8113593
   7     6        500    0.9063158  0.8113593
   7     7        100    0.9063158  0.8113593
   7     7        200    0.9063158  0.8113593
   7     7        300    0.9115789  0.8218559
   7     7        400    0.9115789  0.8218559
   7     7        500    0.9063158  0.8113593
   7     8        100    0.9063158  0.8113593
   7     8        200    0.9168421  0.8324704
   7     8        300    0.9115789  0.8218559
   7     8        400    0.9115789  0.8219732
   7     8        500    0.9115789  0.8218559
   7     9        100    0.9115789  0.8218559
   7     9        200    0.9063158  0.8113593
   7     9        300    0.9115789  0.8218559
   7     9        400    0.9063158  0.8113593
   7     9        500    0.9063158  0.8113593
   7    10        100    0.9115789  0.8218559
   7    10        200    0.9165789  0.8318559
   7    10        300    0.9063158  0.8113593
   7    10        400    0.9063158  0.8113593
   7    10        500    0.9115789  0.8218559
   7    11        100    0.9063158  0.8113593
   7    11        200    0.9063158  0.8113593
   7    11        300    0.9115789  0.8218559
   7    11        400    0.9115789  0.8218559
   7    11        500    0.9063158  0.8113593
   7    12        100    0.9063158  0.8113593
   7    12        200    0.9115789  0.8218559
   7    12        300    0.9063158  0.8113593
   7    12        400    0.9063158  0.8113593
   7    12        500    0.9063158  0.8113593
   7    13        100    0.9168421  0.8324704
   7    13        200    0.9115789  0.8218559
   7    13        300    0.9063158  0.8113593
   7    13        400    0.9115789  0.8218559
   7    13        500    0.9063158  0.8113593
   7    14        100    0.9115789  0.8219732
   7    14        200    0.9063158  0.8113593
   7    14        300    0.9063158  0.8113593
   7    14        400    0.9115789  0.8218559
   7    14        500    0.9063158  0.8113593
   7    15        100    0.9063158  0.8113593
   7    15        200    0.9115789  0.8218559
   7    15        300    0.9063158  0.8113593
   7    15        400    0.9063158  0.8113593
   7    15        500    0.9063158  0.8113593
   8     5        100    0.9063158  0.8113593
   8     5        200    0.9168421  0.8324704
   8     5        300    0.9115789  0.8218559
   8     5        400    0.9063158  0.8113593
   8     5        500    0.9115789  0.8218559
   8     6        100    0.9115789  0.8219732
   8     6        200    0.9115789  0.8218559
   8     6        300    0.9115789  0.8219732
   8     6        400    0.9063158  0.8113593
   8     6        500    0.9063158  0.8113593
   8     7        100    0.9168421  0.8324704
   8     7        200    0.9115789  0.8218559
   8     7        300    0.9063158  0.8113593
   8     7        400    0.9115789  0.8218559
   8     7        500    0.9063158  0.8113593
   8     8        100    0.9168421  0.8324704
   8     8        200    0.9063158  0.8113593
   8     8        300    0.9115789  0.8218559
   8     8        400    0.9115789  0.8218559
   8     8        500    0.9115789  0.8218559
   8     9        100    0.9165789  0.8318559
   8     9        200    0.9115789  0.8218559
   8     9        300    0.9063158  0.8113593
   8     9        400    0.9063158  0.8113593
   8     9        500    0.9063158  0.8113593
   8    10        100    0.9115789  0.8218559
   8    10        200    0.9115789  0.8218559
   8    10        300    0.9115789  0.8219732
   8    10        400    0.9115789  0.8218559
   8    10        500    0.9063158  0.8113593
   8    11        100    0.9063158  0.8113593
   8    11        200    0.9168421  0.8324704
   8    11        300    0.9063158  0.8113593
   8    11        400    0.9063158  0.8113593
   8    11        500    0.9063158  0.8113593
   8    12        100    0.9063158  0.8113593
   8    12        200    0.9168421  0.8324704
   8    12        300    0.9115789  0.8219732
   8    12        400    0.9115789  0.8218559
   8    12        500    0.9063158  0.8113593
   8    13        100    0.9063158  0.8113593
   8    13        200    0.9063158  0.8113593
   8    13        300    0.9115789  0.8218559
   8    13        400    0.9115789  0.8218559
   8    13        500    0.9115789  0.8218559
   8    14        100    0.9115789  0.8220931
   8    14        200    0.9115789  0.8218559
   8    14        300    0.9063158  0.8113593
   8    14        400    0.9115789  0.8218559
   8    14        500    0.9115789  0.8218559
   8    15        100    0.9115789  0.8219732
   8    15        200    0.9115789  0.8219732
   8    15        300    0.9115789  0.8218559
   8    15        400    0.9115789  0.8218559
   8    15        500    0.9115789  0.8218559
   9     5        100    0.9063158  0.8113593
   9     5        200    0.9115789  0.8218559
   9     5        300    0.9115789  0.8219732
   9     5        400    0.9115789  0.8219732
   9     5        500    0.9115789  0.8218559
   9     6        100    0.9063158  0.8113593
   9     6        200    0.9115789  0.8218559
   9     6        300    0.9168421  0.8324704
   9     6        400    0.9063158  0.8113593
   9     6        500    0.9063158  0.8113593
   9     7        100    0.9165789  0.8318559
   9     7        200    0.9115789  0.8218559
   9     7        300    0.9063158  0.8113593
   9     7        400    0.9063158  0.8113593
   9     7        500    0.9115789  0.8218559
   9     8        100    0.9115789  0.8218559
   9     8        200    0.9115789  0.8218559
   9     8        300    0.9063158  0.8113593
   9     8        400    0.9063158  0.8113593
   9     8        500    0.9115789  0.8218559
   9     9        100    0.9165789  0.8319732
   9     9        200    0.9063158  0.8113593
   9     9        300    0.9063158  0.8113593
   9     9        400    0.9115789  0.8218559
   9     9        500    0.9063158  0.8113593
   9    10        100    0.9113158  0.8212420
   9    10        200    0.9063158  0.8113593
   9    10        300    0.9063158  0.8113593
   9    10        400    0.9063158  0.8113593
   9    10        500    0.9063158  0.8113593
   9    11        100    0.9063158  0.8113593
   9    11        200    0.9063158  0.8113593
   9    11        300    0.9115789  0.8218559
   9    11        400    0.9063158  0.8113593
   9    11        500    0.9115789  0.8218559
   9    12        100    0.9063158  0.8113593
   9    12        200    0.9115789  0.8218559
   9    12        300    0.9115789  0.8218559
   9    12        400    0.9063158  0.8113593
   9    12        500    0.9063158  0.8113593
   9    13        100    0.9063158  0.8113593
   9    13        200    0.9115789  0.8218559
   9    13        300    0.9063158  0.8113593
   9    13        400    0.9115789  0.8218559
   9    13        500    0.9115789  0.8218559
   9    14        100    0.9168421  0.8327070
   9    14        200    0.9063158  0.8113593
   9    14        300    0.9063158  0.8113593
   9    14        400    0.9115789  0.8218559
   9    14        500    0.9063158  0.8113593
   9    15        100    0.9115789  0.8219732
   9    15        200    0.9115789  0.8218559
   9    15        300    0.9115789  0.8219732
   9    15        400    0.9115789  0.8218559
   9    15        500    0.9063158  0.8113593
  10     5        100    0.9063158  0.8113593
  10     5        200    0.9168421  0.8324704
  10     5        300    0.9063158  0.8113593
  10     5        400    0.9063158  0.8113593
  10     5        500    0.9063158  0.8113593
  10     6        100    0.9168421  0.8324704
  10     6        200    0.9115789  0.8218559
  10     6        300    0.9115789  0.8219732
  10     6        400    0.9115789  0.8219732
  10     6        500    0.9063158  0.8113593
  10     7        100    0.9115789  0.8218559
  10     7        200    0.9063158  0.8113593
  10     7        300    0.9115789  0.8218559
  10     7        400    0.9063158  0.8113593
  10     7        500    0.9063158  0.8113593
  10     8        100    0.9115789  0.8219732
  10     8        200    0.9115789  0.8218559
  10     8        300    0.9063158  0.8113593
  10     8        400    0.9063158  0.8113593
  10     8        500    0.9063158  0.8113593
  10     9        100    0.9115789  0.8218559
  10     9        200    0.9115789  0.8218559
  10     9        300    0.9115789  0.8218559
  10     9        400    0.9115789  0.8218559
  10     9        500    0.9115789  0.8218559
  10    10        100    0.9115789  0.8218559
  10    10        200    0.9063158  0.8113593
  10    10        300    0.9063158  0.8113593
  10    10        400    0.9115789  0.8218559
  10    10        500    0.9063158  0.8113593
  10    11        100    0.9115789  0.8218559
  10    11        200    0.9115789  0.8218559
  10    11        300    0.9063158  0.8113593
  10    11        400    0.9115789  0.8218559
  10    11        500    0.9063158  0.8113593
  10    12        100    0.9063158  0.8113593
  10    12        200    0.9115789  0.8218559
  10    12        300    0.9115789  0.8218559
  10    12        400    0.9063158  0.8113593
  10    12        500    0.9063158  0.8113593
  10    13        100    0.9113158  0.8213593
  10    13        200    0.9115789  0.8218559
  10    13        300    0.9063158  0.8113593
  10    13        400    0.9063158  0.8113593
  10    13        500    0.9063158  0.8113593
  10    14        100    0.9063158  0.8113593
  10    14        200    0.9168421  0.8324704
  10    14        300    0.9063158  0.8113593
  10    14        400    0.9063158  0.8113593
  10    14        500    0.9063158  0.8113593
  10    15        100    0.9115789  0.8218559
  10    15        200    0.9168421  0.8324704
  10    15        300    0.9168421  0.8325897
  10    15        400    0.9115789  0.8218559
  10    15        500    0.9115789  0.8218559

Accuracy was used to select the optimal model using the largest value.
The final values used for the model were mtry = 3, maxnodes = 8 and ntree = 100.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the final model on the test set</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_set)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate model performance</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(test_predictions, test_set<span class="sc">$</span>transport_mode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction Vehicle Walk
   Vehicle      43    6
   Walk          0   33
                                          
               Accuracy : 0.9268          
                 95% CI : (0.8475, 0.9727)
    No Information Rate : 0.5244          
    P-Value [Acc &gt; NIR] : 2.187e-15       
                                          
                  Kappa : 0.8523          
                                          
 Mcnemar's Test P-Value : 0.04123         
                                          
            Sensitivity : 1.0000          
            Specificity : 0.8462          
         Pos Pred Value : 0.8776          
         Neg Pred Value : 1.0000          
             Prevalence : 0.5244          
         Detection Rate : 0.5244          
   Detection Prevalence : 0.5976          
      Balanced Accuracy : 0.9231          
                                          
       'Positive' Class : Vehicle         
                                          </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable Importance Plot</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model<span class="sc">$</span>finalModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/random%20forest-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="model-development" class="level4" data-number="4.2.1">
<h4 data-number="4.2.1" class="anchored" data-anchor-id="model-development"><span class="header-section-number">4.2.1</span> Model development</h4>
<p>The dataset containing GPS points (posmo_simple) and trajectory information (trajectories_all_sf) was loaded. Each GPS point was associated with a specific transport mode (transport_mode). Additional features were engineered, including the length of trajectories, duration of trips, mean speed, and acceleration. Points were grouped by transport_mode_id, and trajectories were converted into LINESTRING geometries to facilitate analysis. Initially, a Random Forest model was trained with default parameters to establish a baseline for comparison. A 10-fold cross-validation setup was used to ensure robust model training and evaluation. To optimize the model’s performance, several hyperparameters were tuned: mtry (the number of variables randomly sampled as candidates at each split), maxnodes (the maximum number of terminal nodes), and ntree (the number of trees in the forest). Using the optimal parameters identified during this tuning process, the final Random Forest model was trained, resulting in improved classification performance.</p>
</section>
<section id="model-evaluation" class="level4" data-number="4.2.2">
<h4 data-number="4.2.2" class="anchored" data-anchor-id="model-evaluation"><span class="header-section-number">4.2.2</span> Model evaluation</h4>
<p>The model was evaluated on the test set, and the results were summarized using a confusion matrix and associated statistics. The confusion matrix provided a detailed breakdown of the model’s predictions: True Positives (Vehicle) - 45 instances, False Positives (Vehicle) - 5 instances, True Negatives (Walk) - 76 instances, and False Negatives (Walk) - 3 instances. The model achieved an accuracy of 93.8%, indicating that it correctly classified 93.8% of the instances. The 95% confidence interval for accuracy ranged from 88.15% to 97.28%, demonstrating high reliability. The No Information Rate (NIR) was 62.79%, significantly lower than the model’s accuracy, highlighting its effectiveness. The p-value for accuracy greater than NIR was less than 2e-16, indicating statistical significance. Other performance metrics included a Kappa value of 0.8684, reflecting strong agreement between predicted and actual classifications, and a McNemar’s Test p-value of 0.7237, suggesting no significant difference in marginal proportions. The sensitivity (recall) was 93.75%, and the specificity was 93.83%. The Positive Predictive Value (PPV) was 90.00%, and the Negative Predictive Value (NPV) was 96.20%. The model exhibited balanced performance, with a balanced accuracy of 93.79%.</p>
</section>
<section id="variable-importance" class="level4" data-number="4.2.3">
<h4 data-number="4.2.3" class="anchored" data-anchor-id="variable-importance"><span class="header-section-number">4.2.3</span> Variable importance</h4>
<p>The Random Forest model’s variable importance plot revealed insightful information regarding feature significance. The Mean Decrease in Accuracy metric indicated how much the model’s accuracy decreased when each variable was excluded. The most influential features were speed_m_s (speed in meters per second), length (length of the trajectory), acc_m2_s (acceleration), and time_duration (duration of the trip). The Mean Decrease in Gini metric showed the total decrease in node impurity (Gini impurity) when a variable was used for splitting. The ranking was similar to the Mean Decrease in Accuracy, with speed_m_s and length being the most critical features, followed by acc_m2_s and time_duration. These plots indicated that speed_m_s and length were the most crucial features for classifying the transport mode, while acc_m2_s and time_duration also contributed but to a lesser extent.</p>
</section>
<section id="summary-of-random-forest" class="level4" data-number="4.2.4">
<h4 data-number="4.2.4" class="anchored" data-anchor-id="summary-of-random-forest"><span class="header-section-number">4.2.4</span> Summary of random forest</h4>
<p>The Random Forest model shows strong performance in classifying transport modes between “Vehicle” and “Walk”. The high accuracy, Kappa, sensitivity, and specificity values indicate that the model is robust and reliable for this classification task. The variable importance plots highlight that speed and length (distance) are the most influential features, followed by acceleration and trip duration.</p>
</section>
</section>
<section id="spatial-context" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="spatial-context"><span class="header-section-number">4.3</span> Spatial context</h3>
<p><span class="citation" data-cites="hong_evaluating_2023">Hong, Stüdeli, and Raubal (<a href="#ref-hong_evaluating_2023" role="doc-biblioref">2023</a>)</span> combines labeled GPS trajectories with geospatial context features (road network, water, green space, residential areas) for a preciser travel mode detection by machine learning. Here we utilize walkway network and digital elevation model to (1) fix the walking trips; (2) examine the correlation between gradients (slope) and walking speed.</p>
<section id="map-matching" class="level4" data-number="4.3.1">
<h4 data-number="4.3.1" class="anchored" data-anchor-id="map-matching"><span class="header-section-number">4.3.1</span> Map matching</h4>
<p>Raw GPS coordinates complexity of urban road network <span class="citation" data-cites="HE2019122318">He et al. (<a href="#ref-HE2019122318" role="doc-biblioref">2019</a>)</span>. The objective is to accurately align GPS points collected during walks with the corresponding walkways on a map, ensuring spatial accuracy and continuity. We match <code>walk_sf</code> (point features containing GPS points collected during walks) with <code>walkway_sf</code> (a geoPackage file containing the linestrings), representing the walkways in Zurich. Both simple features are projected in the CH1903+ / LV95 CRS. A 10-meter buffer is created around each GPS point to identify intersecting line strings within a reasonable proximity (i.e., the width of walking streets in reality). This buffer helps in reducing the search space for potential matches. Linestrings that intersect with each buffer are identified by spatial joining. This step narrows down the linestrings that are potential matches for each GPS point. For each GPS point, the nearest intersecting linestring is determined based on the shortest distance. The snapping function ensures that each point is aligned to the closest point on the nearest linestring. Finally, the snapped points are converted into a single geometry column and integrated into a new sf object.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the walkway network</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>walkway_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"foot_zurich.gpkg"</span>, <span class="at">layer =</span> <span class="st">"taz_mm.tbl_routennetz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `taz_mm.tbl_routennetz' from data source 
  `D:\UZH\GEO880_Modul_CMA\semester_project\CMA_Semesterproject_24FS\foot_zurich.gpkg' 
  using driver `GPKG'
Simple feature collection with 40292 features and 11 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 2676247 ymin: 1241672 xmax: 2689662 ymax: 1254307
Projected CRS: CH1903+ / LV95</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert walk points to sf object</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>walk_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(walk, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lv95_x"</span>, <span class="st">"lv95_y"</span>), <span class="at">crs =</span> <span class="dv">2056</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both sf objects have the same CRS</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>walkway_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(walkway_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(walk_sf))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a buffer around each point</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>buffered_points <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(walk_sf, <span class="at">dist =</span> <span class="dv">10</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Find intersecting lines for each point</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>intersections <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(buffered_points, walkway_sf)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to find the nearest linestring for each point within the buffer</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>find_nearest_line <span class="ot">&lt;-</span> <span class="cf">function</span>(point, lines) {</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure CRS match</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">st_crs</span>(point) <span class="sc">!=</span> <span class="fu">st_crs</span>(lines)) {</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    lines <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(lines, <span class="at">crs =</span> <span class="fu">st_crs</span>(point))</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(lines) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">st_geometry</span>(point))</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(point, lines)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  nearest_line_idx <span class="ot">&lt;-</span> <span class="fu">which.min</span>(distances)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  nearest_line <span class="ot">&lt;-</span> lines[nearest_line_idx, ]</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  nearest_point <span class="ot">&lt;-</span> <span class="fu">st_nearest_points</span>(point, nearest_line)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(nearest_point, <span class="st">"POINT"</span>)[<span class="dv">2</span>]  <span class="co"># Take the second point which is on the linestring</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to each point in walk_sf</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>walk_snapped <span class="ot">&lt;-</span> walk_sf <span class="sc">%&gt;%</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">snapped_geometry =</span> <span class="fu">list</span>(<span class="fu">find_nearest_line</span>(geometry, walkway_sf[intersections[[<span class="fu">cur_group_id</span>()]], ]))</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert snapped_geometry to a single geometry column</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>snapped_geometries <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">do.call</span>(c, <span class="fu">lapply</span>(walk_snapped<span class="sc">$</span>snapped_geometry, st_geometry)), <span class="at">crs =</span> <span class="fu">st_crs</span>(walk_sf))</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new sf object with the snapped geometries</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>walk_snapped_sf <span class="ot">&lt;-</span> walk_snapped <span class="sc">%&gt;%</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> snapped_geometries) <span class="sc">%&gt;%</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>snapped_geometry)</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Create LINESTRING by grouping by transport_mode_id</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>walk_snapped_line <span class="ot">&lt;-</span> walk_snapped_sf <span class="sc">%&gt;%</span> </span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span> </span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>)</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of lines to sample</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>number_of_lines_to_sample <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample lines with the same transport_mode_id from both collections</span></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>sampled_walk_line <span class="ot">&lt;-</span> walk_line <span class="sc">%&gt;%</span></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(number_of_lines_to_sample) <span class="sc">%&gt;%</span></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">"original"</span>)</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>sampled_walk_snapped_line <span class="ot">&lt;-</span> walk_snapped_line <span class="sc">%&gt;%</span></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(transport_mode_id) <span class="sc">%&gt;%</span></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(number_of_lines_to_sample) <span class="sc">%&gt;%</span></span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">"snapped"</span>)</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the sampled lines into a single sf object</span></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>combined_lines <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sampled_walk_line, sampled_walk_snapped_line)</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a><span class="co"># use 1 as an example</span></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>sample_combine <span class="ot">&lt;-</span> combined_lines <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode_id <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the lines on the same map with different colors</span></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(sample_combine, <span class="at">zcol =</span> <span class="st">"source"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-aeaf64042e3c66eea1ab" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-aeaf64042e3c66eea1ab">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["line",430]},{"method":"addPolylines","args":[[[[{"lng":[8.55329500840338,8.552976008403249,8.55301300840328,8.55301300840328,8.55301300840328,8.55301300840328,8.55301300840328,8.55301300840328,8.552526008402898,8.552636008403004,8.553111008403384,8.553159008403425,8.553177008403406,8.553278008403494,8.553375008403558,8.553182008403384,8.553188008403419,8.553190008403423,8.553188008403417,8.55318900840342,8.553263008403322,8.553384008403398,8.553604008403612,8.553636008403625,8.553699008403655,8.553663008403607,8.55370700840359,8.553645008403505,8.5536610084035,8.553687008403484,8.553652008403427,8.553769008403533,8.553776008403508,8.553844008403532,8.553783008403496,8.553877008403555,8.554011008403656,8.55410100840375,8.554198008403823,8.55424200840385,8.554292008403896,8.554416008404012,8.554448008404039,8.554564008404169,8.554689008404281,8.554763008404358,8.554738008404351,8.554804008404444,8.554846008404519,8.554928008404628,8.554974008404713,8.55497400840475,8.554990008404804,8.555067008404878,8.555064008404925,8.555069008404976,8.555018008404957,8.555163008405087,8.555106008405037,8.555003008404963,8.554881008404873,8.554771008404748,8.554659008404624,8.554577008404545,8.554485008404439,8.554285008404248,8.554146008404102,8.553895008403869,8.553770008403729,8.553732008403665,8.553514008403397,8.553503008403373,8.553484008403395,8.553372008403302,8.553299008403265,8.553295008403278,8.553269008403269,8.553250008403275,8.553173008403244,8.553095008403201,8.553081008403204,8.553036008403195,8.553177008403351,8.55330100840351,8.553334008403567,8.553360008403622,8.553457008403724,8.553605008403887,8.553729008404025,8.553779008404103,8.553817008404163,8.553964008404339,8.554062008404465,8.554121008404536,8.55425600840471,8.554288008404779,8.554343008404855,8.554399008404921,8.554550008405098,8.554684008405237,8.554793008405374,8.55483000840545,8.554883008405517,8.554909008405577,8.55498600840567,8.555115008405823,8.555217008405943,8.55531500840606,8.555464008406224,8.555518008406285,8.555487008406287,8.55547900840627,8.555526008406353,8.555728008406566,8.555841008406695,8.555942008406824,8.556009008406917,8.55607300840699,8.556064008406988,8.555958008406865,8.555886008406766,8.555823008406682,8.555730008406551,8.555572008406365,8.555571008406343,8.555502008406259,8.555414008406148,8.555299008406003,8.555178008405871,8.555100008405772,8.555027008405684,8.554941008405562,8.554844008405441,8.55472300840529,8.55462700840517,8.554540008405057,8.554442008404946,8.554421008404896,8.55435300840481,8.554244008404677,8.554154008404561,8.554037008404428,8.553951008404304,8.553831008404165,8.553753008404053,8.553665008403907,8.553498008403734,8.553431008403656,8.553361008403561,8.553243008403436,8.553176008403346,8.553150008403279,8.553122008403248],"lat":[47.37540001016032,47.37482501016022,47.37485301016024,47.37485301016024,47.37485301016024,47.37485301016024,47.37485301016024,47.37485301016024,47.37455301016029,47.3745370101602,47.3748050101602,47.3748280101602,47.3749470101602,47.37499501016019,47.3750720101602,47.37503701016023,47.37494701016022,47.37493801016023,47.37494101016022,47.3749410101602,47.3754770101603,47.37561201016036,47.37561601016031,47.37567901016031,47.37577601016032,47.37582201016036,47.3760120101604,47.37608601016044,47.37616801016047,47.37628001016048,47.37634701016054,47.3763990101605,47.37647301016055,47.37662701016055,47.37654101016054,47.37665701016056,47.37674201016057,47.37673401016048,47.37678501016052,47.37684401016053,47.37685601016052,47.3768700101605,47.37688601016045,47.37683001016044,47.37684801016038,47.37685401016036,47.37677001016034,47.37669401016029,47.37657901016024,47.3764770101602,47.37636101016015,47.37623201016011,47.37610601016006,47.37611501016002,47.37595501016001,47.37580801015994,47.37570401015993,47.37573101015987,47.37571801015994,47.37562501015992,47.37555701015989,47.37560701015998,47.37565501016002,47.37564401016002,47.37569501016007,47.37570801016015,47.37573301016018,47.37571301016028,47.37577401016034,47.37584501016035,47.37602601016047,47.37606901016046,47.37594901016046,47.37588201016047,47.37579401016046,47.37572801016042,47.37566601016043,47.37559801016043,47.37545401016038,47.3753590101604,47.37528901016037,47.37519901016033,47.37512701016023,47.37499901016017,47.37492301016019,47.37480901016011,47.3748070101601,47.37473601016001,47.37468801015998,47.37458501015989,47.37449601015985,47.37439301015981,47.37430401015977,47.37426801015972,47.37412101015962,47.37399301015957,47.37392001015954,47.37387001015951,47.37377601015946,47.3737570101594,47.37366401015935,47.37352801015926,47.37347601015924,47.37337001015915,47.37329601015917,47.37322101015912,47.37314301015904,47.373082010159,47.37301601015891,47.37297701015892,47.37287901015888,47.3729000101589,47.37279101015881,47.37275001015879,47.37268601015875,47.37258501015864,47.37248901015864,47.37243901015862,47.37243001015856,47.37250201015864,47.37257901015867,47.37266701015873,47.37279301015875,47.37289401015888,47.37295401015887,47.37301701015892,47.37309801015891,47.37320101015904,47.37324901015909,47.37333401015917,47.37339801015918,47.37349601015922,47.37359801015929,47.3737110101594,47.37379801015942,47.37387301015948,47.37394201015952,47.37402801015961,47.37409001015958,47.37418901015965,47.37426901015971,47.37433401015976,47.37446301015984,47.37454501015991,47.37465501015997,47.37484801016004,47.3748860101601,47.37493201016012,47.37500901016018,47.37505401016021,47.37513901016029,47.37527401016033,47.37527501016033]}]],[[{"lng":[8.55329500840338,8.552976008403249,8.55301300840328,8.55301300840328,8.55301300840328,8.55301300840328,8.55301300840328,8.55301300840328,8.552520390677314,8.552629679522894,8.553111008403384,8.553159008403425,8.553243936788549,8.553246738962075,8.553367013900322,8.553177988002105,8.553247945824687,8.553255051240859,8.553252196825305,8.553252561283074,8.5531662813786,8.553391902773612,8.553610670242499,8.553576062304593,8.553699008403655,8.553727123002547,8.553693524775444,8.553585071232174,8.55364657315523,8.5536964690396,8.553693486910182,8.55380909650923,8.553861288608759,8.553844008403532,8.553783008403496,8.553993960842243,8.554070735337481,8.554109586270991,8.554195345515803,8.554246457177729,8.554294335265759,8.554423786858134,8.55444854105451,8.554549222298684,8.554684935000711,8.554744335666461,8.554717945274117,8.554819521708163,8.554839982395668,8.554889644186378,8.554941978451465,8.554995691912101,8.555002499146282,8.555052563346905,8.555072256513098,8.555084859216491,8.555123536494449,8.555174781414069,8.555125372037615,8.555003008404963,8.554819579861112,8.554709403385951,8.554599199011008,8.554549847328548,8.554451464422824,8.554274893242443,8.554133717675743,8.553895008403869,8.553770008403729,8.55376539383651,8.553554802714448,8.553521939187753,8.553492758117084,8.553332286224995,8.553274334060603,8.553327902879643,8.553283672624103,8.553237332832721,8.553135674462544,8.553073954362581,8.553104134690299,8.553034637999135,8.553179518142731,8.553323564745234,8.553318160538662,8.55340840521893,8.553445174365617,8.553616952055439,8.55369485405806,8.553785205716464,8.553822711706543,8.553949362333084,8.554053118051517,8.554128720649389,8.554245875964362,8.55434523699433,8.554414104721626,8.554422550851887,8.554551050077343,8.554679271631331,8.554779932567511,8.554845540593227,8.554899191826097,8.554981314463992,8.555058187625292,8.555153021795348,8.55524096952538,8.555315802929115,8.555451927194964,8.555534346350106,8.555513655071348,8.555496439663655,8.555587614206068,8.555723974444165,8.555842614248725,8.555948985541159,8.556028013174076,8.556077155074901,8.556080622569356,8.555968560830678,8.555888265216776,8.555814167676761,8.555731832213594,8.555572357657521,8.555567791202003,8.555501359156654,8.555416182421943,8.555306846698286,8.555195450852789,8.555110629118685,8.555042025373826,8.554945534999957,8.554842619323361,8.554724109464303,8.554631923941452,8.554549966181815,8.554431721127473,8.55440035744307,8.554333466591995,8.554226511868348,8.55413942057416,8.55405350196232,8.553932313191973,8.553831875984187,8.553726638614789,8.553670788214145,8.553473219411034,8.55341698858847,8.553337847202547,8.553259353678854,8.553170423575201,8.553140453264387,8.553129406742698],"lat":[47.37540001016032,47.37482501016022,47.37485301016024,47.37485301016024,47.37485301016024,47.37485301016024,47.37485301016024,47.37485301016024,47.37455022062783,47.37453363995742,47.3748050101602,47.3748280101602,47.37498143858965,47.37497892496994,47.37506785604214,47.37503424032798,47.37497784238386,47.37497146864614,47.37497402912922,47.37497370220138,47.37550903099122,47.37559310967762,47.37561993642056,47.37565069615497,47.37577601016032,47.37590020722676,47.37599233343126,47.37610967916505,47.37617507497829,47.37627526653037,47.37630684497125,47.37637890922434,47.37644279512531,47.37662701016055,47.37654101016054,47.37661557354745,47.37670167375033,47.37672821711443,47.37678680854687,47.37685614174013,47.37685443871899,47.37689160321224,47.37688748879999,47.3768054340998,47.37684034636707,47.37682377578467,47.37676688725828,47.37669325824958,47.37657774114106,47.37646893103462,47.37635426496835,47.37623657649778,47.3761086569348,47.37611196817325,47.37595675792469,47.3758113295934,47.37572610960888,47.3757335048464,47.37572206523854,47.37562501015992,47.37549432595789,47.37554414574409,47.37559397794694,47.37561629372103,47.37566078024521,47.37569749183692,47.37572044098467,47.37571301016028,47.37577401016034,47.37588572847631,47.37604479355469,47.37607772667842,47.37599247417587,47.3758898687225,47.37580306748686,47.37571586322589,47.37566059510725,47.37560269086622,47.37546636929392,47.37536010812057,47.37527976379109,47.37519955807625,47.37512842861981,47.3750103894559,47.37491485792556,47.37483390577364,47.37480092266836,47.3747420355143,47.37467077994235,47.37458813658579,47.3744989473681,47.37438546742558,47.37429887134292,47.37427181613435,47.37411615772837,47.37402041697253,47.37395405822527,47.37382594031403,47.37377897630422,47.37375474169163,47.37365774807322,47.3735354498948,47.37348376182406,47.37340464390658,47.3733305831291,47.37323921808497,47.37315448721611,47.37308239072459,47.37301022443834,47.37298480863903,47.37289177352693,47.37290835947945,47.37282051844753,47.37274807828894,47.37268677666219,47.37258777157936,47.37249670430034,47.3724406889495,47.37243673645326,47.37250596594274,47.37257731690925,47.3726626615593,47.37279388070252,47.37289417741595,47.37295247451352,47.373016700257,47.37309904786795,47.37320475156485,47.37325736341119,47.37333909646085,47.37340520184982,47.37349817796617,47.37359734492094,47.37371153746258,47.37380036423885,47.37387792428039,47.37393708358461,47.3740178189888,47.37408036634361,47.37418037567185,47.37426181110347,47.37434214969846,47.37445357879891,47.37454544783724,47.37464170710508,47.37485088735652,47.37487350455741,47.37492493740947,47.37499732573434,47.37506324821056,47.37513585371606,47.37526904509146,47.37527885450844]}]]],null,"sample_combine - source",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"line","stroke":true,"color":["#4B0055","#FDE333"],"weight":2,"opacity":[0.9,0.9],"fill":false,"fillColor":["#4B0055","#FDE333"],"fillOpacity":[1,1],"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>transport_mode_id&emsp;<\/th><td>1&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>length&emsp;<\/th><td>1794.687 [m]&emsp;<\/td><\/tr><tr><td>4<\/td><th>time_duration&emsp;<\/th><td>1644&emsp;<\/td><\/tr><tr><td>5<\/td><th>speed_m_s&emsp;<\/th><td>1.091659&emsp;<\/td><\/tr><tr><td>6<\/td><th>source&emsp;<\/th><td>original&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>transport_mode_id&emsp;<\/th><td>1&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_LINESTRING&emsp;<\/td><\/tr><tr><td>3<\/td><th>length&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>time_duration&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>5<\/td><th>speed_m_s&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>6<\/td><th>source&emsp;<\/th><td>snapped&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["original","snapped"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":3,"opacity":1,"fill":false,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[8.552520390677314,47.37243001015856,8.556080622569356,47.37689160321224,true,"sample_combine - source","Zoom to sample_combine - source","<strong> sample_combine - source <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"sample_combine - source",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#FDE333"],"labels":["original","snapped"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"sample_combine - source","extra":null,"layerId":null,"className":"info legend","group":"sample_combine - source"}]}],"limits":{"lat":[47.37243001015856,47.37689160321224],"lng":[8.552520390677314,8.556080622569356]},"fitBounds":[47.37243001015856,8.552520390677314,47.37689160321224,8.556080622569356,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
</section>
<section id="gradient-calculation" class="level4" data-number="4.3.2">
<h4 data-number="4.3.2" class="anchored" data-anchor-id="gradient-calculation"><span class="header-section-number">4.3.2</span> Gradient calculation</h4>
<p>Built environment can also influence pedestrian’s walking behavior. In this section, we detect whether we are “uphill” or “downhill” during walking, and examine the correlation between gradient and walking speed. Data here is Shuttle Radar Topography Mission (SRTM, 30m).</p>
<div class="cell">
<details class="code-fold">
<summary>require DEM (example, not run)</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the boundary of Switzerland</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">type =</span> <span class="st">"countries"</span>, <span class="at">country =</span> <span class="st">"Switzerland"</span>,<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get elevation, zoom here means 30 meter resolution</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">get_elev_raster</span>(<span class="at">locations =</span> map, <span class="at">z =</span> <span class="dv">12</span>, <span class="at">clip =</span> <span class="st">"locations"</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the raster DEM to a TIFF file</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(d, <span class="at">filename =</span> <span class="st">"switzerland_dem_30m.tif"</span>, <span class="at">format =</span> <span class="st">"GTiff"</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>posmo_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(posmo_df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the TIFF file back later</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>dem_raster <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">raster</span>(<span class="st">"switzerland_dem_30m.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here we define a function to calculate gradient: change of elevation / step length.</p>
<div class="cell">
<details class="code-fold">
<summary>calculate gradient</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>posmo_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(posmo_df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the TIFF file back later</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>dem_raster <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">raster</span>(<span class="st">"switzerland_dem_30m.tif"</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>dem_df <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(dem_raster, <span class="fu">st_coordinates</span>(posmo_sf))</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>walk_trip_dem <span class="ot">&lt;-</span> <span class="fu">cbind</span>(posmo_sf, dem_df)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert coordinates to LV95 (Swiss coordinate system)</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(walk_trip_dem, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>coordinates_lv95 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(coordinates, <span class="dv">2056</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>walk_trip_dem<span class="sc">$</span>lv95_x <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">1</span>]</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>walk_trip_dem<span class="sc">$</span>lv95_y <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(coordinates_lv95)[,<span class="dv">2</span>]</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances and speeds between consecutive points</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now) {</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>diff_ele <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>walk_trip_dem <span class="ot">&lt;-</span> walk_trip_dem <span class="sc">|&gt;</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">stepMean =</span> </span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">distance_by_element</span>(geometry, <span class="fu">lag</span>(geometry, <span class="dv">6</span>))</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">timeMean =</span> </span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">difftime_secs</span>(datetime, <span class="fu">lag</span>(datetime, <span class="dv">6</span>))</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">speedMean =</span> stepMean<span class="sc">/</span>timeMean) <span class="sc">|&gt;</span> </span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">acc =</span> (speedMean <span class="sc">-</span> <span class="fu">lag</span>(speedMean, <span class="dv">6</span>))<span class="sc">/</span>timeMean)<span class="sc">|&gt;</span> </span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">gradient =</span> (dem_df <span class="sc">-</span> <span class="fu">lag</span>(dem_df, <span class="dv">6</span>))<span class="sc">/</span>stepMean)</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="co"># analyze walk trip</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>walk_trip_dem_filterd <span class="ot">&lt;-</span> walk_trip_dem <span class="sc">|&gt;</span> <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Walk"</span>)</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="co"># pearson correlation test</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(walk_trip_dem_filterd<span class="sc">$</span>speedMean, walk_trip_dem_filterd<span class="sc">$</span>gradient, <span class="at">method =</span> <span class="st">"spearman"</span>, <span class="at">exact =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  walk_trip_dem_filterd$speedMean and walk_trip_dem_filterd$gradient
S = 5.2659e+11, p-value &lt; 2.2e-16
alternative hypothesis: true rho is not equal to 0
sample estimates:
        rho 
-0.06854535 </code></pre>
</div>
<details class="code-fold">
<summary>calculate gradient</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot correlation</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> walk_trip_dem_filterd, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> gradient, <span class="at">y =</span> speedMean)) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"#0f993d"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  smplot2<span class="sc">::</span><span class="fu">sm_statCorr</span>(<span class="at">corr_method =</span> <span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/read%20DEM-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here we find the effect of gradient (slope) on walking speed is negative with a significant p value. We argue walking trajectories can be enriched with other semantic contents for data exploration.</p>
</section>
</section>
</section>
<section id="discussion" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="discussion"><span class="header-section-number">5</span> Discussion</h2>
<p>We argue speed and acceleration are two main factors of walking detection, which accords with the conclusion from <span class="citation" data-cites="berjisian2022evaluation">Berjisian and Bigazzi (<a href="#ref-berjisian2022evaluation" role="doc-biblioref">2022</a>)</span>. The reason is that walking is a typical slow-speed physical activity with a huge variation with vehicle in average speed and acceleration. We compare the characters of rule-based and random forest detection methods. First, rule-based detection is easy to understand and apply with certain rules. We can also apply sensitivity analysis to find the optimal value for each parameter.</p>
<p>Our study also has several limitations. Our raw GPS data lack an attribute in signal accuracy, which is a primary factor in evaluating data quality and detecting outdoor trips <span class="citation" data-cites="muller2022analyzing">Müller et al. (<a href="#ref-muller2022analyzing" role="doc-biblioref">2022</a>)</span>. We only utilized GPS data generated from one participant, so our framework of walking detection could not apply for big data contributed by a mixed group.</p>
<p>We simplify potential travel modes into two types (i.e, walking and vehicle), so our framework is not applicable for cycling and transit (i.e., tram, train, and bus etc.) detection. We do not resample data set because the counts of walking and vehicle trajectories are close, but in that case our workflow does not apply to an unbalanced dataset. For map matching, we only consider geometrical relations (i.e., points to segments) and ignore temporal magnitude <span class="citation" data-cites="HE2019122318">He et al. (<a href="#ref-HE2019122318" role="doc-biblioref">2019</a>)</span>. The complexity of our algorithm here is not optimal and we also lack quantitative validation for map matching, which needs more explorations in the future.</p>
</section>
<section id="conclusion" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">6</span> Conclusion</h2>
<p>We conclude our study by answering following research questions:</p>
<p>Q1: How can we rebuild (heuristic) rule-based walking detection methods under point-based segmentation in R?</p>
<p>A1: We usually first adjust the algorithm by the temporal interval according with our target data. Common attributes include speed, time, and step length for trip detection. Then we set rules for trip points to generate walking points and filter points data into trajectories.</p>
<p>Q2: How do we evaluate the performance of walking detection methods?</p>
<p>A2: We use the parameters for supervised classification to evaluate a detection method. Common attributes here are accuracy, precision, sensitivity, recall, and F score.</p>
<p>Q3: How do we match GPS points to a complex road network by topological method?</p>
<p>Q3: We use topographical method here, i.e., matching points by geometric relationship (shortest distance). This method is comprehensive and actionable, but we lack a detailed validation, which can be conducted later.</p>
<p>Q4: Does supervised classification (random forest) perform better than rule-based (heuristic) method in walking detection?</p>
<p>A4: For model evaluation, yes, but it doesn’t mean machine learning is always the obest way for walking detection. The accuracy of rule based detection can also reach to 85% with the optimal parameters. The obvious disadvantage of random forest is it can be time consuming when developing. It is also difficult to interpret our result, especially when attributes here are abundant.</p>
<p>Q5: How to combine other semantic contexts on trajectories?</p>
<p>A5: As trajectories contain spatial-temporal attributes, it is applicable to combine semantic context with spatial/temporal attributes of trajectories. Here we extract the elevation data by points in trajectories. We will conduct a temporal analysis for walking trajectories in the future.</p>
<p>To summarize, our study provide a reproducible framework of detecting walking trips from daily GPS data generated by smartphone application. This procedure can conduce to an accurate walking identification and a better understanding of pedestrian behavior.</p>
<section id="wordcount" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="wordcount"><span class="header-section-number">6.1</span> Wordcount</h3>
<!-- after installing the wordcountadding, remove the line "#| eval: false" -->
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>wordcountaddin<span class="sc">::</span><span class="fu">text_stats</span>(<span class="st">"index.qmd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">koRpus</th>
<th style="text-align: left;">stringi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Word count</td>
<td style="text-align: left;">3251</td>
<td style="text-align: left;">3139</td>
</tr>
<tr class="even">
<td style="text-align: left;">Character count</td>
<td style="text-align: left;">20955</td>
<td style="text-align: left;">21016</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sentence count</td>
<td style="text-align: left;">249</td>
<td style="text-align: left;">Not available</td>
</tr>
<tr class="even">
<td style="text-align: left;">Reading time</td>
<td style="text-align: left;">16.3 minutes</td>
<td style="text-align: left;">15.7 minutes</td>
</tr>
</tbody>
</table>
</div>
</div>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-berjisian2022evaluation" class="csl-entry" role="listitem">
Berjisian, Elmira, and Alexander Bigazzi. 2022. <span>“Evaluation of Methods to Distinguish Trips from Activities in Walking and Cycling GPS Data.”</span> <em>Transportation Research Part C: Emerging Technologies</em> 137: 103588.
</div>
<div id="ref-cho2011identifying" class="csl-entry" role="listitem">
Cho, Gi-Hyoug, Daniel A Rodriguez, and Kelly R Evenson. 2011. <span>“Identifying Walking Trips Using GPS Data.”</span> <em>Med Sci Sports Exerc</em> 43 (2): 365–72.
</div>
<div id="ref-gong2012gps" class="csl-entry" role="listitem">
Gong, Hongmian, Cynthia Chen, Evan Bialostozky, and Catherine T Lawson. 2012. <span>“A GPS/GIS Method for Travel Mode Detection in New York City.”</span> <em>Computers, Environment and Urban Systems</em> 36 (2): 131–39.
</div>
<div id="ref-HE2019122318" class="csl-entry" role="listitem">
He, Mujun, Linjiang Zheng, Wei Cao, Jing Huang, Xu Liu, and Weining Liu. 2019. <span>“An Enhanced Weight-Based Real-Time Map Matching Algorithm for Complex Urban Networks.”</span> <em>Physica A: Statistical Mechanics and Its Applications</em> 534: 122318. https://doi.org/<a href="https://doi.org/10.1016/j.physa.2019.122318">https://doi.org/10.1016/j.physa.2019.122318</a>.
</div>
<div id="ref-hong_evaluating_2023" class="csl-entry" role="listitem">
Hong, Ye, Emanuel Stüdeli, and Martin Raubal. 2023. <span>“Evaluating Geospatial Context Information for Travel Mode Detection.”</span> <em>Journal of Transport Geography</em> 113: 103736. <a href="https://doi.org/10.1016/j.jtrangeo.2023.103736">https://doi.org/10.1016/j.jtrangeo.2023.103736</a>.
</div>
<div id="ref-HUANG2019297" class="csl-entry" role="listitem">
Huang, Haosheng, Yi Cheng, and Robert Weibel. 2019. <span>“Transport Mode Detection Based on Mobile Phone Network Data: A Systematic Review.”</span> <em>Transportation Research Part C: Emerging Technologies</em> 101: 297–312. https://doi.org/<a href="https://doi.org/10.1016/j.trc.2019.02.008">https://doi.org/10.1016/j.trc.2019.02.008</a>.
</div>
<div id="ref-jiaqi2018transport" class="csl-entry" role="listitem">
Jiaqi, Kimberley Chin. 2018. <span>“Transport Mode Detection Using Cellular Signaling Data (Case Study of Graz and Vienna, Austria).”</span> Geographisches Institut der Universit<span>ä</span>t Z<span>ü</span>rich.
</div>
<div id="ref-montini2014trip" class="csl-entry" role="listitem">
Montini, Lara, Nadine Rieser-Schüssler, Andreas Horni, and Kay W Axhausen. 2014. <span>“Trip Purpose Identification from GPS Tracks.”</span> <em>Transportation Research Record</em> 2405 (1): 16–23.
</div>
<div id="ref-muller2022analyzing" class="csl-entry" role="listitem">
Müller, Sandrine R, Joseph B Bayer, Morgan Quinn Ross, Jerry Mount, Clemens Stachl, Gabriella M Harari, Yung-Ju Chang, and Huyen TK Le. 2022. <span>“Analyzing GPS Data for Psychological Research: A Tutorial.”</span> <em>Advances in Methods and Practices in Psychological Science</em> 5 (2): 25152459221082680.
</div>
<div id="ref-Roy2020Classifying" class="csl-entry" role="listitem">
Roy, Avipsa, Daniel Fuller, Kevin Stanley, and Trisalyn Nelson. 2020. <span>“Classifying Transport Mode from Global Positioning Systems and Accelerometer Data: A Machine Learning Approach.”</span> <em>Findings</em>, September. <a href="https://doi.org/10.32866/001c.14520">https://doi.org/10.32866/001c.14520</a>.
</div>
<div id="ref-SADEGHIAN2022159" class="csl-entry" role="listitem">
Sadeghian, Paria, Xiaoyun Zhao, Arman Golshan, and Johan Håkansson. 2022. <span>“A Stepwise Methodology for Transport Mode Detection in GPS Tracking Data.”</span> <em>Travel Behaviour and Society</em> 26: 159–67. https://doi.org/<a href="https://doi.org/10.1016/j.tbs.2021.10.004">https://doi.org/10.1016/j.tbs.2021.10.004</a>.
</div>
<div id="ref-XIAO201514" class="csl-entry" role="listitem">
Xiao, Guangnian, Zhicai Juan, and Chunqin Zhang. 2015. <span>“Travel Mode Detection Based on GPS Track Data and Bayesian Networks.”</span> <em>Computers, Environment and Urban Systems</em> 54: 14–22. https://doi.org/<a href="https://doi.org/10.1016/j.compenvurbsys.2015.05.005">https://doi.org/10.1016/j.compenvurbsys.2015.05.005</a>.
</div>
<div id="ref-s18113741" class="csl-entry" role="listitem">
Yang, Xue, Kathleen Stewart, Luliang Tang, Zhong Xie, and Qingquan Li. 2018. <span>“A Review of GPS Trajectories Classification Based on Transportation Mode.”</span> <em>Sensors</em> 18 (11). <a href="https://doi.org/10.3390/s18113741">https://doi.org/10.3390/s18113741</a>.
</div>
<div id="ref-yun2018spatiotemporal" class="csl-entry" role="listitem">
Yun, Hee Jeong, Dong Jin Kang, and Myong Jae Lee. 2018. <span>“Spatiotemporal Distribution of Urban Walking Tourists by Season Using GPS-Based Smartphone Application.”</span> <em>Asia Pacific Journal of Tourism Research</em> 23 (11): 1047–61.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
